var GM=[];function typeWriter(e,a){var s=0;null==a&&(a="get informed, be in control");s<a.length&&(document.getElementById(e).innerHTML+=a.charAt(s),s++,setTimeout(typeWriter,50))}function convertUTCDateToLocalDate(e){var a=new Date(e.getTime()-1e3*(60*e.getTimezoneOffset()));return a}function isEven(e){return!(e%2)}function wait(e){for(var a=new Date().getTime(),i=a;i<a+e;)i=new Date().getTime()}var DateSelectOptions={format:"yyyy/mm/dd",todayBtn:!0,clearBtn:!0,orientation:"bottom auto",calendarWeeks:!0,autoclose:!0,todayHighlight:!0,toggleActive:!0};$(function(){$(".input-group.date").datepicker(DateSelectOptions)});function formatNumber(e){return e.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1,")}function ToggleCSSFooter(e){let a=getComputedStyle(document.body);var i=a.getPropertyValue("--usedfooterheight"),s=a.getPropertyValue("--emptyfooterheight");"1"==e?document.documentElement.style.setProperty("--footerspace",i):document.documentElement.style.setProperty("--footerspace",s)}function download(e,i,s){var l=document.createElement("a"),a=new Blob([e],{type:s});l.href=URL.createObjectURL(a),l.download=i,l.click()}function distance(e,i,s,l){var d=.017453292519943295,r=Math.cos,o=.5-r((s-e)*d)/2+r(e*d)*r(s*d)*(1-r((l-i)*d))/2;return 12742*Math.asin(Math.sqrt(o))}function round(e,a){return+(Math.round(e+"e"+a)+"e-"+a)}function TimeToSeconds(e){for(var a=e.split(":"),i=0,l=1;0<a.length;)i+=l*parseInt(a.pop(),10),l*=60;return i}function SecondsToTime(e){const a=Math.floor(e/3600),i=Math.floor(e%3600/60),l=Math.round(e%60);return[a,9<i?i:a?"0"+i:i||"0",9<l?l:"0"+l].filter(Boolean).join(":")}var dateFormat=function(){var e=function(e,a){for(e+="",a=a||2;e.length<a;)e="0"+e;return e};return function(a,i,l){var r=dateFormat;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(a)||/\d/.test(a)||(i=a,a=void 0),a=a?new Date(a):new Date,isNaN(a))throw SyntaxError("invalid date");i=(r.masks[i]||i||r.masks["default"])+"","UTC:"==i.slice(0,4)&&(i=i.slice(4),l=!0);var c=l?"getUTC":"get",n=a[c+"Date"](),d=a[c+"Day"](),p=a[c+"Month"](),m=a[c+"FullYear"](),f=a[c+"Hours"](),v=a[c+"Minutes"](),u=a[c+"Seconds"](),s=a[c+"Milliseconds"](),g=l?0:a.getTimezoneOffset(),o={d:n,dd:e(n),ddd:r.i18n.dayNames[d],dddd:r.i18n.dayNames[d+7],m:p+1,mm:e(p+1),mmm:r.i18n.monthNames[p],mmmm:r.i18n.monthNames[p+12],yy:(m+"").slice(2),yyyy:m,h:f%12||12,hh:e(f%12||12),H:f,HH:e(f),M:v,MM:e(v),s:u,ss:e(u),l:e(s,3),L:e(99<s?Math.round(s/10):s),t:12>f?"a":"p",tt:12>f?"am":"pm",T:12>f?"A":"P",TT:12>f?"AM":"PM",Z:l?"UTC":((a+"").match(/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g)||[""]).pop().replace(/[^-+\dA-Z]/g,""),o:(0<g?"-":"+")+e(100*Math.floor(Math.abs(g)/60)+Math.abs(g)%60,4),S:["th","st","nd","rd"][3<n%10?0:(10!=n%100-n%10)*n%10]};return i.replace(/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,function(e){return e in o?o[e]:e.slice(1,e.length-1)})}}();dateFormat.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},dateFormat.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(e,a){return dateFormat(this,e,a)};function ShowVehicleInfo(e,a){var i=$("#VehicleDetails"),s="";i.html(""),openVehDet(),rFMS_Trip.clearLayers(),rFMS_Trigger.clearLayers(),rFMS_Markers.clearLayers(),ShowLatestLayer(),$.ajax({url:window.location.origin+"/scripts/GetVehicleDetails.php?id="+e,dataType:"JSON",success:function(l){"a"!=a&&(s+="<div class=\"vehicleDetailsCard h-100\">"),s+="\t<div class=\"card-header py-0 text-primary\">",$LP=l[0].LicensePlate?"<span class=\"VehicleListInfo dark\"></b> <small> ("+l[0].LicensePlate+")</small></span>":"",s+=null==l[0].TrailerName?"<div class=\"vehicleCard "+l[0].Type+"_background\"></div><span class=\"page-title\"><strong>"+l[0].customerVehicleName+"</strong></span>":"<div class=\"vehicleCard "+l[0].Type+"_background Trailer_background\"></div><span class=\"page-title\"><strong>"+l[0].customerVehicleName+" ( + "+l[0].TrailerName+"</strong></span> )",s+="\t\t<button class=\" closebtn close\" onclick=\"closeVehDet()\"><span class=\"text-primary\" aria-hidden = \"true\"><i class=\"fad fa-times-circle text-primary\"></i></span></button>",s+="\t</div>",s+="\t<div class=\"card-body p-0\">",s+="\t\t<div class=\"col-12 p-0 border-bottom\">","*"==$SelectedGroup&&(s+="\t\t\t<div class=\"col-12 StatusLine \"><i class=\"fad fa-fw fa-building fa-fw \"></i><i class=\"fas fa-fw\"></i> <span> "+l[0].name+"</b></span></div>"),s+="\t\t\t<div class=\"col-12 StatusLine \" id=\"VLAddress\"></div>",s+="\t\t\t<div class=\"d-flex StatusLine col-12 \">",s+="\t\t\t\t<div class=\"col-6 p-0 \"><i class=\"fad fa-tachometer-alt fa-fw\"></i><i class=\"fas fa-fw\"></i> "+(l[0].OdoMeter/1e3).toFixed(0)+"</b> km</div>",s+="\t\t\t\t<div class=\"ml-auto p-0   \">"+l[0].grossCombinationVehicleWeight+" kg <i class=\"fas fa-fw\"></i><i class=\"fad fa-weight-hanging fa-fw\"></i></div>",s+="\t\t\t</div>","a"==a&&(s+="\t\t\t<div class=\"d-flex StatusLine col-12\">",s+="\t\t\t\t<div class=\"col-6 p-0 \"><i class=\"fad fa-gas-pump fa-fw  \"></i><i class=\"fas fa-fw\"></i> "+l[0].FuelLevel+"</b> %</div>",s+="\t\t\t\t<div class=\"ml-auto p-0 \">"+l[0].CatalystFuelLevel+" % <i class=\"fas fa-fw\"></i><i class=\"fad fa-gas-pump fa-fw text-primary\"></i></div>",s+="\t\t\t</div>"),s+="\t\t\t<div class=\"d-flex StatusLine col-12\">",s+="\t\t\t\t<div class=\"col-6 p-0 \"><i class=\"fad fa-gas-pump fa-fw  \"></i><i class=\"fas fa-fw\"></i> "+l[0].FuelLevel+"</b> %</div>",s+="\t\t\t\t<div class=\"ml-auto p-0 \"> "+l[0].currentSpeed+" km/u <i class=\"fas fa-fw\"></i><i class=\"fad fa-tachometer-fast fa-fw\"></i></div>",s+="\t\t\t</div>",s+="\t\t\t<div class=\"d-flex StatusLine col-12\">",s+=0<Count_warning(l[0])?"\t\t\t<div class=\"col-6 p-0\"><i class=\"fad fa-exclamation-triangle fa-fw text-danger\"></i><i class=\"fas fa-fw\"></i> <b>"+Count_warning(l[0])+" warning lamps</b></div>":"\t\t\t<div class=\"col-6 p-0 \"><i class=\"fad fa-exclamation-triangle fa-fw  \"></i><i class=\"fas fa-fw\"></i> 0 warning lamps</b></div>",s+="\t\t\t\t<div class=\"ml-auto p-0 \"> "+dateFormat(l[0].LastActivity+" UTC","yyyy-mm-dd HH:MM ")+" <i class=\"fas fa-fw\"></i><i class=\"fad fa-history fa-fw\"></i></div>",s+="\t\t\t</div>",0<l[0].DamageCount&&(s+="\t\t\t<div class=\"d-flex StatusLine col-12\">",s+="\t\t\t\t<div class=\"col-12 p-0\"><i class=\"fad fa-tools text-danger fa-fw\"></i><i class=\"fas fa-fw\"></i> <b>"+l[0].DamageCount+" damages</b></div>",s+="\t\t\t</div>"),s+="\t\t</div>",!0==a&&(s+="<div class=\"panel-group\" id=\"accordion\" role=\"tablist\" aria-multiselectable=\"false\">",s+="\t<div class=\"panel panel-default p-0\" id=\"AccordionDriverOne\"></div>",s+="\t<div class=\"panel panel-default p-0\" id=\"AccordionDriverTwo\"></div>",s+="\t<div class=\"panel panel-default p-0\">",s+="\t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingFour\">",s+="\t\t\t<div class=\"card-header p-0 pr-3 py-1\">",s+=" \t\t\t<div role=\"button\" class=\"\" data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapseFour\" aria-expanded=\"true\" aria-controls=\"collapseFour\">",s+="\t\t\t\t\t<div class=\"d-flex\">",s+="\t\t\t\t\t\t<div class=\"col-11 StatusLine\"><i class=\"fad fa-route fa-fw\"></i><i class=\"fad fa-fw\"></i>Today trips <span class=\"badge badge-primary\" id=\"TripCounter\"> - </span></div> ",s+="\t\t\t\t\t\t<div class=\"col-1 ml-auto StatusLine\"><i class=\"fa\" aria-hidden=\"true\"> </i></div>",s+="\t\t\t\t\t</div>",s+=" \t\t\t</div>",s+="\t\t\t</div>",s+="\t \t</div>",s+="\t\t<div id=\"collapseFour\" class=\"panel-collapse collapse show\" role=\"tabpanel\" aria-labelledby=\"headingFour\">",s+="\t\t\t<div class=\"panel-body rounded-0\">",s+="\t\t\t\t<div id=\"TripsCol\"></div>",s+="\t\t\t</div>",s+="\t\t</div>",s+="\t</div></div>"),i.append(s),Convert2Address([l[0].last_Latitude,l[0].last_Longitude,"VLAddress"]),"a"!=a&&(ReadTodayVehicleTrips(e,"TripsCol"),LatestVehicleDriver(l[0]),map.setView([l[0].last_Latitude,l[0].last_Longitude],16))},error:function(){SessionAlert("Your application-session has expired... <br><br>returning to login-page!")}})}function ShowVehicleCard(e,a){var i=$("#"+a),s="",l="",d="";!0==e.status.alert,!0==e.status.driving&&(l="<i class=\"fas fa-play fa-fw drive\" ></i>",$title="Driving"),!0==e.status.paused&&(l="<i class=\"fas fa-pause fa-fw work\" ></i>",d="alert- ",$title="Work / Paused"),!0==e.status.stopped&&(l="<i class=\"fas fa-stop fa-fw rest\" ></i>",$title="Rest / Stopped"),0<e.DamageCount&&(d="alert-danger "),$trailer=null==e.TrailerName?"<i class=\"fad fa-truck fa-fw fa-flip-horizontal\" ></i><i class=\"fad fa-fw\"></i>":"<i class=\"fad fa-truck fa-fw fa-flip-horizontal\" ></i><i class=\"fad fa-trailer fa-fw fa-flip-horizontal\" ></i><i class=\"fad fa-fw\"></i>",ShowLatestLayer(),s+="<div class=\"col-12 col-md-6 col-lg-4 mb-3\">",s+="\t<a onclick=\"map.flyTo(["+e.last_Latitude+","+e.last_Longitude+"],13);\" class=\"DashTile pointer\" title=\"click to show on map\">",s+="\t<div class=\"card  p-0 shadow-sm\">",s+="\t\t<div class=\"card-header d-flex text-primary "+d+"\"><div>"+$trailer+""+e.customerVehicleName+"</div><div class=\"ml-auto\" title =\""+$title+"\"> "+l+"</div></div>",s+="\t\t<div class=\"card-body p-1\">",s+="\t\t\t<div class=\"col-12 py-2 \">",!e.Driver||(s+="\t\t\t<div class=\"StatusLine text-primary\"><i class=\"fad fa-user fa-fw \" ></i><i class=\"fad fa-fw\"></i><b>"+e.Driver+"</b> [ "+e.RemainingDriveToday+" ] </div>"),s+="\t\t\t</div>",s+="\t\t\t<div class=\"col-12 py-2 d-flex StatusLine\">",!e.LicensePlate||(s+="\t\t\t<div class=\"StatusLine mr-3\"><span class=\"VehicleLicensePlate\">"+e.LicensePlate+"</span></div>"),0<Count_warning(e)&&(s+="\t\t\t\t<div class=\"mr-3\"><i class=\"fad fa-exclamation-triangle fa-fw text-danger\" title=\" Display Warnings \"></i></i> <b>"+Count_warning(e)+"</b></div>"),0<e.DamageCount&&(s+="\t\t\t\t<div class=\"mr-3\"><i class=\"fad fa-tools text-danger fa-fw\" title=\" Severe damage(s) \"></i><b>"+e.DamageCount+"</b></div>"),"hide"!=e.Maintenance&&(s+="\t\t\t\t<div class=\"mr-3\"><i class=\"fad fa-wrench text-"+e.Maintenance+"\" title=\" Due for maintenace \"></i></div>"),s+="\t\t\t</div>",s+="\t\t\t<div class=\"col-12 py-2 gray\" id=\"VLAddress"+e.id+"\"></div>",s+="\t\t\t<div class=\"col-12 py-2 gray\" id=\"VLAddress"+e.id+"\"><i class=\"fad fa-clock fa-fw \"></i><i class=\"fa fa-fw \"></i>"+dateFormat(e.LastActivity,"yyyy-mm-dd HH:MM ")+"</div>",s+="\t\t</div>\t</a></div>",i.append(s),Convert2Address([e.last_Latitude,e.last_Longitude,"VLAddress"+e.id])}function LatestVehicleUnit(e){var a="";a+="\t<div class=\"panel panel-default p-0\">",a+="\t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingFive\">",a+="\t\t\t<div class=\"card-header p-0 pr-3 py-1\">",a+=" \t\t\t<div role=\"button\" data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapseFive\" aria-expanded=\"true\" aria-controls=\"collapseFive\">",a+="\t\t\t\t\t<div class=\"d-flex\">",a+="\t\t\t\t\t\t<div class=\"col-11 StatusLine\"><i class=\"fas fa-cogs fa-fw\"></i><i class=\"fas fa-fw\"></i> Vehicle Unit</div>",a+="\t\t\t\t\t\t<div class=\"col-1 ml-auto StatusLine\"><i class=\"fas\" aria-hidden=\"true\"> </i></div>",a+="\t\t\t\t\t</div>",a+=" \t\t\t</div>",a+="\t\t\t</div>",a+="\t \t</div>",a+="\t\t<div id=\"collapseFive\" class=\"panel-collapse collapse\" role=\"tabpanel\" aria-labelledby=\"headingFive\">",a+="\t\t\t<div class=\"panel-body  card rounded-0\">",a+="\t\t\t\t<div class=\" \"><div id=\"LVSU\"></div></div>",a+="\t\t\t</div>",a+="\t\t</div>",a+="\t</div>";var i=$("#accordion");i.append(a);var s=$("#LVSU");s.html(""),s.append("<div class=\"d-flex StatusLine\"><div class=\"px-2 align-middle\">VIN </div><div class=\"ml-auto px-2 StatusValue\"><b>"+e.VIN+"</b></div></div><div class=\"d-flex StatusLine\"><div class=\"px-2 align-middle\">Unit Number</div><div class=\"ml-auto px-2 StatusValue\"><b>"+e.OBU_Serial+"</b></div></div><div class=\"d-flex StatusLine\"><div class=\"px-2 align-middle\">Unit Software version</div><div class=\"ml-auto px-2 StatusValue\"><b>"+e.obu_sw_version+"</b></div></div><div class=\"d-flex StatusLine\"><div class=\"px-2 align-middle\">Activation (year-week)</div><div class=\"ml-auto px-2 StatusValue\"><b>"+e.firstregistrationdate+"</b></div></div><div class=\"d-flex StatusLine\"><div class=\"px-2 align-middle\">Number of Axles</div><div class=\"ml-auto px-2 StatusValue\"><b>"+e.numberofaxles+"</b></div></div><div class=\"d-flex StatusLine\"><div class=\"px-2 align-middle\">Series</div><div class=\"ml-auto px-2 StatusValue\"><b>"+e.series+"</b></div></div><div class=\"d-flex StatusLine\"><div class=\"px-2 align-middle\">Engine Power</div><div class=\"ml-auto px-2 StatusValue\"><b>"+e.enginepower+"</b></div></div>")}function ShowVehicleRD(e){$("#VehicleDamage").DataTable({ajax:{url:window.location.origin+"/scripts/GetVehicleDamages.php?id="+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,ordering:!1,footer:!1,scrollCollapse:!0,paging:!1,bInfo:!1,buttons:{buttons:[]},columns:[{data:"createdDateTime",title:"date",className:"dt-left"},{data:"severity",title:"",className:"dt-center",visible:!0,width:"2%",render:function(e){return"0"==e?"<i class=\"fas fa-exclamation-triangle fa-fw text-danger\"></i>":"<i class=\"fas fa-clipboard-list fa-fw text-warning\"></i>"}},{data:"cat_name",title:"category",className:"dt-left",visible:!0,width:"60%",render:function(e,a,i){return e+" [ <small >"+i.title+"</small> ] "}},{data:"driver",title:"driver",className:"dt-left",visible:!0},{data:"description",title:"description",className:"dt-left",visible:!1}],fnDrawCallback:function(){$("#VehicleDamage thead").remove()}})}function ShowDriverRD(e){$("#tableDriverDamages").DataTable({ajax:{url:window.location.origin+"/scripts/GetDriverDamages.php?id="+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,ordering:!1,footer:!1,scrollCollapse:!0,paging:!1,bInfo:!1,buttons:{buttons:[]},columns:[{data:"createdDateTime",title:"date",className:"dt-left"},{data:"severity",title:"",className:"dt-center",visible:!0,width:"2%",render:function(e){return"0"==e?"<i class=\"fas fa-exclamation-triangle fa-fw text-danger\"></i>":"<i class=\"fas fa-clipboard-list fa-fw text-warning\"></i>"}},{data:"cat_name",title:"category",className:"dt-left",visible:!0,width:"60%",render:function(e,a,i){return e+" [ <small >"+i.title+"</small> ] "}},{data:"driver",title:"driver",className:"dt-left",visible:!0},{data:"description",title:"description",className:"dt-left",visible:!1}],fnDrawCallback:function(){$("#tableDriverDamages thead").remove()}})}function ShowTrailerRD(e){$LInfo=$("#DriverDamage"),ShowSpinnerSmall("DriverDamage");var a="";$.ajax({url:window.location.origin+"/scripts/GetTrailerDamages.php?id="+e,dataType:"JSON",success:function(e){$.each(e,function(e,i){a+=1==i.severity?"<div class=\"notice notice-damage-danger pb-1 \">":"<div class=\"notice notice-damage pb-1 \">",a+="\t<div class=\"col-12 d-flex no-padding px-1 pt-2\">",a+="\t\t<div class=\"col-4 TripListName no-padding primary pr-3\"> <b>"+dateFormat(i.createdDateTime,"yyyy-mm-dd")+"</b></div>",a+="\t\t<div class=\"col-8 mr-auto TripListName no-padding pr-3\"><B>"+i.cat_name+" </B>/ "+i.title+"</div>",a+="\t</div>",a+="\t<div class=\"col-12 d-flex no-padding px-1 pt-2\">",a+="\t\t<div class=\"col-4 mr-auto TripListNameS no-padding \"><i class=\"fad fa-user\"></i> "+i.customerVehicleName+" </div>",a+="\t\t<div class=\"col-8 TripListNameS no-padding \"> <i class=\"fad fa-file-alt\"></i> "+i.description+"</div>",a+="\t</div></div>"}),a+="</div></div>",$LInfo.append(a)}})}function ShowTrailerActivity(e){$("#tableDriverActivity").DataTable({ajax:{url:window.location.origin+"/scripts/GetTrailerActivity.php?id="+e,dataSrc:""},autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},ordering:!1,footer:!1,scrollCollapse:!0,paging:!1,buttons:{buttons:[]},columns:[{data:"date",title:"date",className:"dt-left"},{data:"customerVehicleName",title:"vehicle",className:"dt-center"},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"vehicle_edit.php?id="+i.VehicleId+"\" class=\"btn \"><i class=\"fad fa-truck\"><i></a>"}},{data:"driver",title:"driver",className:"dt-center"},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"driver_edit.php?id="+i.DriverId+"\" class=\"btn \"><i class=\"fad fa-user\"><i></a>"}},{data:"amountTrips",title:"#trips",className:"dt-center"},{data:"Distance",title:"distance",className:"dt-center"},{data:"Duration",title:"duration",className:"dt-center"},{data:"DriveTime",title:"driving",className:"dt-center"},{data:"FuelUsage",title:"fuel usage",className:"dt-center"},{data:"FuelUsed",title:"fuel used",className:"dt-center"}]})}function ShowDriverActivity(e){e=null==e?"":"?id="+e;$("#tableDriverActivity").DataTable({ajax:{url:window.location.origin+"/scripts/GetDriverActivity.php"+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,ordering:!1,footer:!1,scrollCollapse:!0,paging:!1,bInfo:!1,buttons:{buttons:[]},columns:[{data:"date",title:"date",className:"dt-left"},{title:"vehicle",bSortable:!1,mRender:function(e,a,i){return i.customerVehicleName?"<a href=\"vehicle_edit.php?id="+i.VehicleId+"\" class=\"underline \"> "+i.customerVehicleName+" </a>":""}},{data:"amountTrips",title:"#trips",className:"dt-center"},{data:"Distance",title:"distance",className:"dt-center"},{data:"Duration",title:"duration",className:"dt-center"},{data:"DriveTime",title:"driving",className:"dt-center"},{data:"FuelUsage",title:"fuel usage",className:"dt-center"},{data:"FuelUsed",title:"fuel used",className:"dt-center"},{data:"has_PDC",render:function(e){return"1"==e?"<i class=\"fas fa-check rest\"></i>":" - "},title:"PDC",visible:!0,width:"2%",className:"dt-center"}]})}function ShowVehicleActivity(e){var a=a=$("#tableVehicleActivity").DataTable({ajax:{url:window.location.origin+"/scripts/GetVehicleActivity.php?id="+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,ordering:!1,footer:!1,scrollCollapse:!0,paging:!0,bInfo:!1,lengthMenu:[[5,-1],[5,"All"]],buttons:{buttons:[]},columns:[{data:"date",title:"date",className:"dt-left"},{title:"Driver",bSortable:!1,mRender:function(e,a,i){return i.driver?"<a href=\"driver_edit.php?id="+i.DriverId+"\" class=\"underline\">"+i.driver+" </a>":""}},{data:"amountTrips",title:"#trips",className:"dt-center"},{data:"Distance",title:"distance",className:"dt-center"},{data:"Duration",title:"duration",className:"dt-center"},{data:"DriveTime",title:"driving",className:"dt-center"},{data:"FuelUsage",title:"fuel usage",className:"dt-center"},{data:"FuelUsed",title:"fuel used",className:"dt-center"},{data:"has_PDC",render:function(e){return"1"==e?"<i class=\"fas fa-check rest\"></i>":" - "},title:"PDC",visible:!0,width:"2%",className:"dt-center"}]})}function ShowVehicleMaintenanceHistory(e){table=$("#tableVehicleMaintenance").DataTable({ajax:{url:window.location.origin+"/scripts/getVehicleMaintenanceReports.php?id="+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,ordering:!1,footer:!1,scrollCollapse:!0,paging:!1,bInfo:!1,buttons:{buttons:[]},columns:[{data:"createdDate",title:"date",className:"dt-left"},{data:"actual_vehicle_milage",title:"odo-meter",className:"dt-left"},{data:"dealer",title:"dealer",className:"dt-left"},{data:"description",title:"info",className:"dt-left"},{data:"damages",title:"repairs",className:"dt-center"},{data:"checked",render:function(e){return"1"==e?"<i class=\"fas fa-check rest\"></i>":" - "},title:"Checked",visible:!0,width:"2%",className:"dt-center"}]})}function LatestVehicleDriver(e){if(0<e.DriverId){var a=$("#AccordionDriverOne"),i=$("#AccordionDriverTwo"),s="";if(s+="\t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingOne\">",s+=" \t\t<div role=\"button\" data-toggle=\"collapse\"  class=\"collapsed\" data-parent=\"#accordion\" href=\"#collapseOne\" aria-expanded=\"true\" aria-controls=\"collapseOne\">",s+="\t\t\t<div class=\"card-header p-0 pr-3 py-1\">",s+="\t\t\t\t<div class=\"d-flex\">",s+="\t\t\t\t\t<div class=\"col-11\" id=\"Driver1\"> - </div>",s+="\t\t\t\t\t<div class=\"col-1 ml-auto StatusLine \"><i class=\"fa\" aria-hidden=\"true\"></i></div>",s+=" \t\t\t</div>",s+=" \t\t</div>",s+="\t \t</div>",s+="\t\t<div id=\"collapseOne\" class=\"panel-collapse collapse\" role=\"tabpanel\" aria-labelledby=\"headingOne\">",s+="\t\t\t<div class=\"panel-body border-bottom rounded-0\">",s+="\t\t\t\t<div class=\"p-3\"><div id=\"DTM1\"></div><div id=\"TripDT1\" class=\"rFMSDriverGraph \"></div></div>",s+="\t\t\t</div>",s+="\t\t</div>",a.html(s),ShowPlaceholder("Driver1","single"),ReadDriverDetails(e.DriverId,"Driver1","DTM1","TripDT1"),ShowDriveTime(e.DriverId,"TripDT1","DTM1"),!!e.Driver2_ID){var s="";s+="\t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingTwo\">",s+=" \t\t<div role=\"button\" data-toggle=\"collapse\"  class=\"collapsed\" data-parent=\"#accordion\" href=\"#collapseTwo\" aria-expanded=\"true\" aria-controls=\"collapseTwo\">",s+="\t\t\t\t<div class=\"card-header p-0 pr-3 py-1\">",s+="\t\t\t\t\t<div class=\"d-flex\">",s+="\t\t\t\t\t\t<div class=\"col-11\" id=\"Driver2\" > - </div>",s+="\t\t\t\t\t\t<div class=\"col-1 ml-auto StatusLine\"><i class=\"fa\" aria-hidden=\"true\"></i></div>",s+=" \t\t\t\t</div>",s+=" \t\t\t</div>",s+="\t\t \t</div>",s+="\t \t</div>",s+="\t\t<div id=\"collapseTwo\" class=\"panel-collapse collapse\" role=\"tabpanel\" aria-labelledby=\"headingTwo\">",s+="\t\t\t<div class=\"panel-bodyborder-bottom rounded-0\">",s+="\t\t\t\t<div class=\"p-2 \"><div id=\"DTM2\"></div><div id=\"TripDT2\" class=\"rFMSDriverGraph \"></div></div>",s+="\t\t\t</div>",s+="\t\t</div>",i.html(s),ShowPlaceholder("Driver2","single"),ReadDriverDetails(e.DriverId2,"Driver2","DTM2","TripDT2"),ShowDriveTime(e.DriverId2,"TripDT2","DTM2")}}}function seconds2time(e){e/=1e3;var a=Math.floor(e/3600),i=Math.floor(a/24),s=Math.floor((e-3600*a)/60),e=round(e/1e3,2)-3600*a-60*s,l="";return l+=0==a?"0:":a+":",(0!=s||""!==l)&&(s=10>s&&""!==l?"0"+s:s+"",l+=s),l}function InitializeMAP(){osmUrl="https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",osmAttrib=" <a href=\"http://openstreetmap.org\">OpenStreetMap</a>",osm=new L.TileLayer(osmUrl,{attribution:osmAttrib}),HERETruck=L.tileLayer("https://{s}.{base}.maps.cit.api.here.com/maptile/2.1/{type}/{mapID}/normal.traffic.day/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",{attribution:"<a href=\"http://developer.here.com\">HERE</a>",subdomains:"1234",mapID:"newest",app_id:"Ch87ydlyXjsmnI5AcXho",app_code:"z2HsXPK48vhNPwyfcFr5ew",base:"base",maxZoom:20,type:"trucktile",language:"eng",format:"png",size:"256"}),HERESatelite=L.tileLayer("https://{s}.{base}.maps.api.here.com/maptile/2.1/{type}/{mapID}/hybrid.day/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",{attribution:"<a href=\"http://developer.here.com\">HERE</a>",subdomains:"1234",mapID:"newest",app_id:"Ch87ydlyXjsmnI5AcXho",app_code:"z2HsXPK48vhNPwyfcFr5ew",base:"aerial",maxZoom:20,type:"trucktile",language:"eng",format:"png",size:"256"}),HERE=L.tileLayer("https://{s}.{base}.maps.cit.api.here.com/maptile/2.1/{type}/{mapID}/normal.traffic.day/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",{attribution:"<a href=\"http://developer.here.com\">HERE</a>",subdomains:"1234",mapID:"newest",app_id:"Ch87ydlyXjsmnI5AcXho",app_code:"z2HsXPK48vhNPwyfcFr5ew",base:"traffic",maxZoom:20,type:"traffictile",language:"eng",format:"png8",size:"256"}),HEREGrey=L.tileLayer("https://{s}.{base}.maps.cit.api.here.com/maptile/2.1/{type}/{mapID}/reduced.day/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",{attribution:"<a href=\"http://developer.here.com\">HERE</a>",subdomains:"1234",mapID:"newest",app_id:"Ch87ydlyXjsmnI5AcXho",app_code:"z2HsXPK48vhNPwyfcFr5ew",base:"traffic",maxZoom:20,type:"traffictile",language:"eng",format:"png8",size:"256"}),TomTom=L.tileLayer("https://{s}.api.tomtom.com/map/1/tile/basic/{style}/{z}/{x}/{y}.{ext}?key={apikey}",{attribution:"<a href=\"https://tomtom.com\" target=\"_blank\">&copy;  1992 - 2021 TomTom.</a>",subdomains:"abcd",apikey:"qlmH59sLZa3TDpqBwQRxFh4wRNz0zpuw",style:"main",maxZoom:22,language:"eng",ext:"png",size:"256"}),TomTomTraffic=L.tileLayer("https://{s}.api.tomtom.com/traffic/map/4/tile/flow/{style}/{z}/{x}/{y}.{ext}?key={apikey}",{attribution:"<a href=\"https://tomtom.com\" target=\"_blank\">&copy;  1992 - 2021 TomTom.</a>",subdomains:"abcd",apikey:"qlmH59sLZa3TDpqBwQRxFh4wRNz0zpuw",style:"absolute",maxZoom:22,language:"eng",ext:"png",size:"256"}),TomTomIncidents=L.tileLayer("https://{s}.api.tomtom.com/traffic/map/4/tile/incidents/{style}/{z}/{x}/{y}.{ext}?key={apikey}",{attribution:"<a href=\"https://tomtom.com\" target=\"_blank\">&copy;  1992 - 2021 TomTom.</a>",subdomains:"abcd",apikey:"qlmH59sLZa3TDpqBwQRxFh4wRNz0zpuw",style:"s3",maxZoom:22,language:"eng",ext:"png",size:"256"}),rFMS_Markers=new L.FeatureGroup,rFMS_Demo=new L.FeatureGroup,rFMS_Trip=new L.FeatureGroup,rFMS_Trigger=new L.FeatureGroup,rFMS_Latest=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),rFMS_Dealers=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0}),rFMS_Trip_Delay=new L.FeatureGroup,map=L.map("map",{center:[46,8.65],zoomSnap:.25,minZoom:2,maxZoom:18,zoom:5,fadeAnimation:!1,zoomAnimation:!1}),map.addLayer(HEREGrey);var e={"HERE Traffic":HERE,"HERE Truck":HERETruck,"HERE Greyscale":HEREGrey,"HERE Satellite":HERESatelite,TomTom:TomTom,OpenStreetMap:osm},a={"TomTom Traffic":TomTomTraffic,"TomTom Incidents":TomTomIncidents,Vehicles:rFMS_Latest,Trip:rFMS_Trip,Dealers:rFMS_Dealers};L.control.layers(e,a,{position:"topleft"}).addTo(map)}function ShowDBMarkers(e){for(var a=L.icon({iconUrl:"../images/timer.png",iconSize:[14,14],iconAnchor:[7,7],tooltipAnchor:[0,-10]}),s=L.icon({iconUrl:"../images/timerdelayed.png",iconSize:[16,16],iconAnchor:[8,8],tooltipAnchor:[0,-26]}),l=L.icon({iconUrl:"../images/circlegreen.png",iconSize:[16,16],iconAnchor:[8,8],tooltipAnchor:[0,-26]}),d=L.icon({iconUrl:"../images/StartMarker.png",iconSize:[,36],iconAnchor:[18,36],tooltipAnchor:[0,-26]}),r=L.icon({iconUrl:"../images/EndMarker.png",iconSize:[,36],iconAnchor:[18,36],tooltipAnchor:[0,-26]}),o=L.icon({iconUrl:"../images/triparrow.png",iconSize:[16,16],iconAnchor:[8,8],tooltipAnchor:[0,-8]}),c=L.icon({iconUrl:"../images/TellTale.png",iconSize:[20,20],iconAnchor:[10,10],tooltipAnchor:[0,-10]}),n=0;n<e.length;++n){$str="",$icon=a,p="",$str1="",$CardColor="",$txtcolor="text-secondary";var p=e[n].triggerInfo;if(0!=e[n].GNSS_latitude){var m=new Date(e[n].createdDateTime),f=Date.parse(e[n].receivedDateTime)-Date.parse(e[n].createdDateTime);"TELL_TALE"==e[n].triggerType&&(p.includes("RED")&&($icon=c,$CardColor="alert-danger",$txtcolor="text-danger",e[n].triggerInfo=p.replace("->RED"," <i class=\"fad fa-engine-warning text-danger\"></i> ")),p.includes("YELLOW")&&($icon=c,$CardColor="alert-warning",$txtcolor="text-light"),$str1=" <BR><span class=\""+$txtcolor+"\"><b> "+e[n].triggerInfo+" </b></span>"),"DISTANCE_TRAVELLED"==e[n].triggerType&&($icon=o),"DRIVER_1_WORKING_STATE_CHANGED"==e[n].triggerType&&($str1="<BR><span class=\""+$txtcolor+"\"><b> "+e[n].driver1Id_WSC+" </b></span>",e[n].triggerType="TachoStatus"),$str+="<div class=\" card\"><div class=\"card-header "+$CardColor+" p-2 py-1 \"><b>"+e[n].triggerType+"</b>"+$str1+"</div><div class=\"card-body p-2\">",$str+="<div class=\"_StatusLine\"><i class=\"fad fa-clock tooltipicon\"></i> "+dateFormat(m,"dd-mm-yyyy h:MM TT")+"</div>",$str+="<div class=\"_StatusLine\"><i class=\"fad fa-digital-tachograph tooltipicon\"></i> "+round(e[n].hrTotalVehicleDistance/1e3,0)+" km</div>",$str+="<div class=\"_StatusLine\"><i class=\"fad fa-tachometer-alt tooltipicon\"></i> "+e[n].wheelBasedSpeed+" km/u</div>",15<=f/1e3/60&&($str+="<div class=\"StatusLine text-danger \"><i class=\"fad fa-history tooltipicon text-danger\"></i><strong> "+seconds2time(f)+" </strong>hh:mm</div>",$icon=s),L.marker([e[n].GNSS_latitude,e[n].GNSS_longitude],{rotationAngle:e[n].GNSS_heading,icon:$icon,draggable:!1}).bindTooltip($str,{direction:"top",opacity:1}).addTo(rFMS_Markers)}}map.addLayer(rFMS_Markers),map.removeLayer(rFMS_Trip),map.removeLayer(rFMS_Trip_Delay),map.addLayer(rFMS_Trigger),map.fitBounds(rFMS_Markers.getBounds(),{padding:[0,50]})}function ShowTripLayer(){map.removeLayer(rFMS_Latest),map.removeLayer(rFMS_Markers),map.addLayer(rFMS_Trip)}function ShowMarkerLayer(){map.removeLayer(rFMS_Latest),map.addLayer(rFMS_Markers),map.removeLayer(rFMS_Trip)}function ShowLatestLayer(){map.removeLayer(rFMS_Markers),map.removeLayer(rFMS_Trip),map.addLayer(rFMS_Latest)}function ShowDBTrips(e){var a=[],i=L.icon({iconUrl:"../images/triparrow.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,-8]}),s=L.icon({iconUrl:"../images/StartMarker.png",iconSize:[,32],iconAnchor:[16,32],tooltipAnchor:[0,-36]}),l=0,d="",r="",o=0,c=0,n=0,p=!1,m=0,f=!1,v=$("#VehicleInfo"),u=$("#TripReport");u.html("");var g=0;u.append("<div><i class='fad fa-circle-notch fa-2x fa-pulse primary'></i></div>");for(var h,b=0;b<e.length;++b){if(h=new Date(e[b].createdDateTime),c=Date.parse(e[b].receivedDateTime)-Date.parse(e[b].createdDateTime),c>g&&(g=c),c=c/1e3/60,15<=c&&(p=!0),0!=e[b].GNSS_latitude&&a.push([e[b].GNSS_latitude,e[b].GNSS_longitude]),"DISTANCE_TRAVELLED"==e[b].triggerType&&L.marker([e[b].GNSS_latitude,e[b].GNSS_longitude],{rotationAngle:e[b].GNSS_heading,icon:i,draggable:!1}).bindTooltip("<div class=\"leafletpopup rounded\"><div class=\"card-header StatusLine p-2 py-1 \"><b>"+e[b].triggerType+"</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fad fa-clock tooltipicon\"></i> "+dateFormat(h,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fad fa-tachometer-alt tooltipicon\"></i> "+(e[b].hrTotalVehicleDistance/1e3).toFixed(0)+" km</div></div></div>",{direction:"top",opacity:1}).addTo(rFMS_Trip),"IGNITION_ON"==e[b].triggerType&&(L.marker([e[b].GNSS_latitude,e[b].GNSS_longitude],{icon:s,draggable:!1}).bindTooltip("<div class=\"leafletpopup rounded\"><div class=\"card-header StatusLine p-2 py-1\"><b>"+e[b].triggerType+"</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fas fa-clock tooltipicon\"></i> "+dateFormat(h,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fas fa-tachometer-alt tooltipicon\"></i> "+(e[b].hrTotalVehicleDistance/1e3).toFixed(0)+" km</div></div></div>",{direction:"top",opacity:1}).on("click",function(){ZoomMarker([e[b].GNSS_latitude,e[b].GNSS_longitude])}).addTo(rFMS_Trip),n=0,f=!0),"IGNITION_OFF"==e[b].triggerType&&!0==f||b==e.length-1){l=e[b].hrTotalVehicleDistance/1e3-e[o].hrTotalVehicleDistance/1e3,d="1 "+e[b].driver1Id_TDI.substr(0,16)+" ",r="2 "+e[b].driver2Id_TDI.substr(0,16)+" ",m=new Date(e[b].createdDateTime)-new Date(e[o].createdDateTime);var y=new Date(e[b].createdDateTime),T=new Date(e[o].createdDateTime);if(!0==p){p=!1;var D=new L.Polyline(a,{color:"red",weight:4}).addTo(rFMS_Trip).bindTooltip("<div class=\"leafletpopup card rounded\"><div class=\"card-header StatusLine p-2 py-1\"><b>Trip</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fas fa-flag tooltipicon\"></i> "+dateFormat(T,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fas fa-route  tooltipicon\"></i> "+round(l,2)+" km</div><div class=\"StatusLine\"><i class=\"fas fa-clock tooltipicon\"></i> "+seconds2time(m)+" hh:mm</div><div class=\"StatusLine text-danger\"><i class=\"fas fa-history tooltipicon\"></i> "+round(g/1e3/60,1)+" min</div><div class=\"StatusLine\"><i class=\"fas fa-user  tooltipicon\"></i> "+d+"</div><div class=\"StatusLine\"><i class=\"fas fa-flag-checkered  tooltipicon\"></i> "+dateFormat(y,"dd-mm-yyyy h:MM TT")+"</div></div></div>",{direction:"top",opacity:1,offset:[0,-26]}).on("click",function(a){var e=a.target;this.openTooltip(),e.setStyle({color:"orange",opacity:1,weight:6})}).on("mouseover",function(a){var e=a.target;e.setStyle({color:"orange",opacity:1,weight:6})}).on("mouseout",function(e){var a=e.target;a.setStyle({color:"red",opacity:1,weight:4})})}else var D=new L.Polyline(a,{color:"#00529c",weight:4}).addTo(rFMS_Trip).bindTooltip("<div class=\"leafletpopup card rounded\"><div class=\"card-header p-2 py-1 StatusLine\"><b>Trip</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fas fa-flag tooltipicon\"></i> "+dateFormat(T,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fas fa-route  tooltipicon\"></i> "+round(l,2)+" km</div><div class=\"StatusLine\"><i class=\"fas fa-clock tooltipicon\"></i> "+seconds2time(m)+" hh:mm</div><div class=\"StatusLine\"><i class=\"fas fa-user  tooltipicon\"></i> "+d+"</div><div class=\"StatusLine\"><i class=\"fas fa-flag-checkered  tooltipicon\"></i> "+dateFormat(y,"dd-mm-yyyy h:MM TT")+"</div></div></div>",{direction:"top",opacity:1,offset:[0,-26]}).on("click",function(a){var e=a.target;this.openTooltip(),e.setStyle({color:"#18e039",opacity:1,weight:8})}).on("mouseover",function(a){var e=a.target;e.setStyle({color:"#18e039",opacity:1,weight:8})}).on("mouseout",function(e){var a=e.target;a.setStyle({color:"#00529c",opacity:1,weight:6})});o=b,a=[],l=0,p=!1,c=0,n=0,L.marker([e[b].GNSS_latitude,e[b].GNSS_longitude],{icon:s,draggable:!1}).bindTooltip("<div class=\"leafletpopup card rounded\"><div class=\"card-header StatusLine p-2 py-1\"><b>"+e[b].triggerType+"</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fas fa-clock tooltipicon\"></i> "+dateFormat(h,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fas fa-tachometer-alt tooltipicon\"></i> "+(e[b].hrTotalVehicleDistance/1e3).toFixed(0)+" km</div></div></div>",{direction:"top",opacity:1}).addTo(rFMS_Trip),f=!0}if("IGNITION_ON"==e[b].triggerType&&!0==f||b==e.length-1){l=e[b].hrTotalVehicleDistance/1e3-e[o].hrTotalVehicleDistance/1e3,d="1 "+e[b].driver1Id_TDI.substr(0,16)+" ",r="2 "+e[b].driver2Id_TDI.substr(0,16)+" ",m=new Date(e[b].createdDateTime)-new Date(e[o].createdDateTime);var y=new Date(e[b].createdDateTime),T=new Date(e[o].createdDateTime);if(!0==p){p=!1;var D=new L.Polyline(a,{color:"red",weight:4}).addTo(rFMS_Trip).bindTooltip("<div class=\"leafletpopup rounded\"><div class=\"card-header StatusLine p-2 py-1 \"><b>Trip</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fas fa-flag tooltipicon\"></i> "+dateFormat(T,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fas fa-route  tooltipicon\"></i> "+round(l,2)+" km</div><div class=\"StatusLine\"><i class=\"fas fa-clock tooltipicon\"></i> "+seconds2time(m)+" hh:mm</div><div class=\"StatusLine text-danger\"><i class=\"fas fa-history tooltipicon\"></i> "+round(g/1e3/60,1)+" minutes</div><div class=\"StatusLine\"><i class=\"fas fa-user  tooltipicon\"></i> "+d+"</div><div class=\"StatusLine\"><i class=\"fas fa-flag-checkered  tooltipicon\"></i> "+dateFormat(y,"dd-mm-yyyy h:MM TT")+"</div></div></div>",{direction:"top",opacity:1,offset:[0,-26]}).on("click",function(a){var e=a.target;this.openTooltip(),e.setStyle({color:"orange",opacity:1,weight:6})}).on("mouseover",function(a){var e=a.target;e.setStyle({color:"orange",opacity:1,weight:6})}).on("mouseout",function(e){var a=e.target;a.setStyle({color:"red",opacity:1,weight:4})})}else var D=new L.Polyline(a,{color:"#00529c",weight:4}).addTo(rFMS_Trip).bindTooltip("<div class=\"leafletpopup card rounded\"><div class=\"card-header StatusLine p-2 py-1 \"><b>Trip</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fas fa-flag tooltipicon\"></i> "+dateFormat(T,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fas fa-route  tooltipicon\"></i> "+round(l,2)+" km</div><div class=\"StatusLine\"><i class=\"fas fa-clock tooltipicon\"></i> "+seconds2time(m)+" hh:mm</div><div class=\"StatusLine\"><i class=\"fas fa-user  tooltipicon\"></i> "+d+"</div><div class=\"StatusLine\"><i class=\"fas fa-flag-checkered  tooltipicon\"></i> "+dateFormat(y,"dd-mm-yyyy h:MM TT")+"</div></div></div>",{direction:"top",opacity:1,offset:[0,-26]}).on("click",function(a){var e=a.target;this.openTooltip(),e.setStyle({color:"#18e039",opacity:1,weight:6})}).on("mouseover",function(a){var e=a.target;e.setStyle({color:"#18e039",opacity:1,weight:6})}).on("mouseout",function(e){var a=e.target;a.setStyle({color:"#00529c",opacity:1,weight:4})});o=b,a=[],l=0,p=!1,c=0,n=0,L.marker([e[b].GNSS_latitude,e[b].GNSS_longitude],{icon:s,draggable:!1}).bindTooltip("<div class=\"leafletpopup card rounded\"><div class=\"card-header StatusLine p-2 py-1\"><b>"+e[b].triggerType+"</b></div><div class=\"card-body p-2\"> <div class=\"StatusLine\"><i class=\"fas fa-clock tooltipicon\"></i> "+dateFormat(h,"dd-mm-yyyy h:MM TT")+"</div><div class=\"StatusLine\"><i class=\"fas fa-tachometer-alt tooltipicon\"></i> "+(e[b].hrTotalVehicleDistance/1e3).toFixed(0)+" km</div></div></div>",{direction:"top",opacity:1}).addTo(rFMS_Trip),f=!1}}u.html(""),map.addLayer(rFMS_Trip),map.fitBounds(rFMS_Trip.getBounds(),{paddingBottomRight:[40,40]})}function ShowLastMarkers(e){map.removeLayer(rFMS_Trip),rFMS_Trip.clearLayers();var a=L.icon({iconUrl:"../images/triparrow.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,-8]});PolyArray=[],$.ajax({type:"GET",url:window.location.origin+"/scripts/GetLastMarkers.php?id="+e,dataType:"json",success:function(e){$.each(e,function(e,i){0!=i.GNSS_latitude&&(PolyArray.push([i.GNSS_latitude,i.GNSS_longitude]),L.marker([i.GNSS_latitude,i.GNSS_longitude],{rotationAngle:i.GNSS_heading,icon:a,draggable:!1}).addTo(rFMS_Trip))});new L.Polyline(PolyArray,{color:"var(--secondary)",weight:3,dashArray:"10, 10",dashOffset:"0"}).addTo(rFMS_Trip);map.addLayer(rFMS_Trip),map.fitBounds(rFMS_Trip.getBounds(),{paddingBottomRight:[40,40]})},error:function(){SessionAlert("Your Session has expired... <br><br>returning to login-page!")}})}function ShowTripMap(e){var a=window.location.href;ShowPlaceholder("TripDetailsTimeline","graph"),ShowPlaceholder("TripDriveTimeGraph","graph");var i=a.split("/").pop();$.ajax({type:"GET",url:window.location.origin+"/scripts/GetLastTripMarkers.php?tripno="+e,dataType:"json",success:function(e){"map.php"==i&&(ShowDBMarkers(e),ShowDBTrips(e)),"tripsdb.php"==i&&(ReadTimeLineMarkers(e),ShowTripDriveTime(e,"TripDriveTimeGraph")),"tripdb.php"==i&&(rFMS_Trip.clearLayers(),rFMS_Markers.clearLayers(),ShowDBMarkers(e),ShowDBTrips(e),ReadTimeLineMarkers(e),ShowTripDriveTime(e,"TripDriveTimeGraph"))},error:function(){SessionAlert("Your Session has expired... <br><br>returning to login-page!")}})}function ShowDealersOnMap(){map.removeLayer(rFMS_Dealers),rFMS_Dealers.clearLayers();var e=L.AwesomeMarkers.icon({icon:"fad fa-tools",markerColor:"special",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-32],popupAnchor:[,-32]});$.ajax({type:"GET",url:window.location.origin+"/scripts/GetDealers.php",dataType:"json",success:function(a){$.each(a,function(a,i){0!=i.adr_gps_latitude&&L.marker([parseFloat(i.adr_gps_latitude),parseFloat(i.adr_gps_longitude)],{icon:e,draggable:!1}).bindTooltip(ShowDealerTooltip(i),{direction:"top",opacity:1}).on("click",function(){ShowDealerInfo(i.id)}).addTo(rFMS_Dealers)})},error:function(){SessionAlert("Your Session has expired... <br><br>returning to login-page!")}})}function ShowDealerTooltip(e){var a="<div class=\"card VehicleDetails \">";return a+="\t<div class=\"card-header\"> "+e.name+"</div>",a+="\t<div class=\"card-body py-1\">",a+="\t\t<div class=\"StatusLine\">"+e.adr_city+" / "+e.cnt_description+"</div>",a+="\t\t<div class=\"StatusLine d-flex\">","1"==e.its_24hours&&(a+="\t\t<div class=\"badge border m-1 p-2\"><b>ITS 24h</b></div> "),"1"==e.its_trailer&&(a+="\t\t<div class=\"badge border m-1 p-2\"><b>ITS Trailer</b></div> "),"1"==e.its_bus&&(a+="\t\t<div class=\"badge border m-1 p-2\"><b>ITS BUS</b></div> "),a+="\t\t</div>",a+="</div></div>",a}function ShowDealerOpeninghours(e){var a=$("#DealerOpening");a.html("");var i=["","Mon","Tue","Wed","Thu","Fri","Sat","Sun"];if(""!=e){var s="",l="",d="",r="",o="<div class=\"py-1\">";a.append(o);for(var c,n=0;n<e.length;++n)c="",e[n].dep_code==s?(l+="\t\t<div class=\"row\">",l+="\t\t\t<div class=\"col-5\"></div>",l+="\t\t\t<div class=\"DealerInfo col text-right\"> "+i[e[n].day_id_from]+" - "+i[e[n].day_id_to]+"</div>",l+="\t\t\t<div class=\"DealerInfo col text-left\"> "+e[n].oph_time_from_1+" - "+e[n].oph_time_to_1+"</div>",l+="\t\t</div>",r.append(l)):(d="OI_"+e[n].dep_code,o="<div class=\"card mb-2 \">",o+="\t<div class=\"card-header p-2\">",o+="\t\t<div class=\"row\">",o+="\t\t\t<div class=\"col-5 card-title\">"+e[n].dep_description+"</div>",o+="\t\t\t<div class=\"DealerInfo col text-right\"> "+i[e[n].day_id_from]+" - "+i[e[n].day_id_to]+"</div>",o+="\t\t\t<div class=\"DealerInfo col text-left\"> "+e[n].oph_time_from_1+" - "+e[n].oph_time_to_1+"</div>",o+="\t\t</div>",o+="\t</div>",o+="</div>",a.append(o),s=e[n].dep_code,l="",r=$("#"+d),r.html(""));o="</div>",a.append(o)}}function ShowDealerPerson(e){var a=$("#DealerPersonel");if(a.html(""),""!=e){for(var i="<div class=\"row py-1 px-3\">",s=0;s<e.length;++s)i+="\t<div class=\"card mb-2 col px-0 contact\">",i+="\t\t<div class=\"card-header\">"+e[s].per_name+" <small>"+e[s].dep_description+"</small></div>",i+="\t\t<div class=\"card-body py-1\">",i+="\t\t\t<div class=\"DealerInfo\">"+e[s].fud_description+"</div>",""!=e[s].per_phone&&(i+="\t\t<div class=\"DealerInfo\"><a href=\"callto:"+e[s].per_phone+" \" > <i class=\"fad fa-phone fa-fw\"> </i> "+e[s].per_phone+"</a></div>"),""!=e[s].per_email&&(i+="\t\t<div class=\"DealerInfo\"><a href=\"mailto:"+e[s].per_email+" \" > <i class=\"fad fa-envelope fa-fw\"> </i> "+e[s].per_email+"</a></div>"),i+="</div></div>";i+="</div>",a.append(i)}}function ShowDealerBusiness(e){var a=$("#DealerServices");a.html("");for(var i="<div class=\"dealerfeatures row py-1 px-3\">",s=[{BusinessCode:"NH",BusinessName:"Night Heater Service"},{BusinessCode:"TA",BusinessName:"Tacho Repair"},{BusinessCode:"LI",BusinessName:"Lubrication/Inspection (MOT)"},{BusinessCode:"IS",BusinessName:"ITS"},{BusinessCode:"PPFS",BusinessName:"PACCAR Parts Fleet Services"},{BusinessCode:"TL",BusinessName:"Tail Lift Repair"},{BusinessCode:"AV",BusinessName:"Bus Audio/Video Repair"},{BusinessCode:"SR",BusinessName:"Service"},{BusinessCode:"SS",BusinessName:"Service Support"},{BusinessCode:"PA",BusinessName:"Parts Sales"},{BusinessCode:"PS",BusinessName:"Paint Shop"},{BusinessCode:"TS",BusinessName:"Truck Sales"},{BusinessCode:"BS",BusinessName:"Body Shop"},{BusinessCode:"TR",BusinessName:"Trailer Repair"},{BusinessCode:"RE",BusinessName:"Truck Rental"},{BusinessCode:"UT",BusinessName:"Used Trucks"},{BusinessCode:"CU",BusinessName:"Cool Unit/Airco Repair"},{BusinessCode:"CR",BusinessName:"Chassis Repair"},{BusinessCode:"BC",BusinessName:"Touringcar & Bus"},{BusinessCode:"TY",BusinessName:"Tyre Service"},{BusinessCode:"TR",BusinessName:"Trailer Repair"},{BusinessCode:"AT",BusinessName:"AT"},{BusinessCode:"GS",BusinessName:"Petrol Station"},{BusinessCode:"WB",BusinessName:"Wash Bay"}],l=0;l<e.length;++l)$service=jQuery.grep(s,function(a){return a.BusinessCode==e[l].bus_code}),i+="<div class=\"card servicebadge\">"+$service[0].BusinessName+"</div> ";i+="</div>",a.append(i)}function ShowDealerAddress(e){for(var a=$("#DealerAddress"),i="<div class=\"col-12\">",s=0;s<e.length;++s)i+="<div class=\" mb-2 py-1 px-3 \">",i+="\t<div class=\"pb-1\">"+e[s].adr_address_1+"</div>",i+="\t<div class=\"pb-1\">"+e[s].adr_postalcode+" "+e[s].adr_city+"</div>",i+="\t<div class=\"pb-1 \">"+e[s].cnt_description+"</div>",i+="</div>";i+="</div>",a.append(i)}function ShowDealerName(e){var a=$("#dealername");a.append("<span class=\"page-title\"><i class=\" fa fa-tools fa-fw\"></i> "+e.name+"</span>")}function ShowDealerCommunications(e){var a=$("#DealerAddress");if(null!=e){var i="<div class=\"col-12\"></div>";i+="<div class=\"col-12\">";for(var s=0;s<e.length;++s)i+="<div class=\"mb-2 card p-0\">",i+="\t<div class=\"card-header p-2\">",""!=e[s].cmm_phone&&(i+="\t<div class=\"pb-1 text-primary\"><a href=\"callto:"+e[s].cmm_phone+"\"><i class=\"fad fa-phone fa-fw text-primary\"></i> "+e[s].cmm_phone+"</a></div>"),""!=e[s].cmm_email1&&(i+="\t<div class=\"pb-1 text-primary\"><a href=\"mailto:"+e[s].cmm_email1+"?subject=rFMS Connect-Request\"><i class=\"fad fa-envelope fa-fw text-primary\"></i> "+e[s].cmm_email1+"</a></div>"),i+="\t</div>",i+="</div>";i+="</div>",a.append(i)}}function ShowDealerInfo(e,a){if(1!=a){var i=$("#VehicleDetails"),s="";i.html(""),openVehDet();var l=$("#Not_Sidebar");l.html(""),s+="<div class=\"vehicleDetailsCard  h-100\">",s+="\t\t<div class=\"card-header w-100 text-primary py-0\" id=\"dealername\">",s+="\t\t \t<button class=\" closebtn close\" onclick=\"closeVehDet()\"><span class=\"text-primary\" aria-hidden = \"true\"><i class=\"fad fa-times-circle text-primary\"></i></span></button>",s+="\t\t</div>",s+="\t\t<div class=\"card-body p-1 border-bottom\" id=\"DealerAddress\"></div>",s+="\t\t<div class=\"panel-group\" id=\"accordion\" role=\"tablist\" aria-multiselectable=\"true\">",s+="\t\t\t<div class=\"panel panel-default p-0\">",s+="\t\t\t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingOne\">",s+="\t\t\t\t\t<div class=\"panel-title\">",s+=" \t\t\t\t\t<a role=\"button\" data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapseOne\" aria-expanded=\"true\" aria-controls=\"collapseOne\">",s+="\t\t\t\t\t\t\t<div class=\"d-flex card-header px-0\">",s+="\t\t\t\t\t\t\t\t<div class=\"col-11\">Services</div>",s+="\t\t\t\t\t\t\t\t<div class=\"col-1 ml-auto\"><i class=\"fa\" aria-hidden=\"true\"> </i></div>",s+="\t\t \t\t\t\t\t</div>",s+=" \t\t\t\t\t</a>",s+=" \t\t\t\t</div>",s+="\t \t\t\t</div>",s+="\t\t\t\t<div id=\"collapseOne\" class=\"panel-collapse collapse\" role=\"tabpanel\" aria-labelledby=\"headingOne\">",s+="\t\t\t\t\t<div class=\"panel-body border-bottom\">",s+="\t\t\t\t\t\t<div class=\"px-3\" id=\"DealerServices\"></div>",s+="\t\t\t\t\t</div>",s+="\t\t\t\t</div>",s+="\t\t\t</div>",s+="\t\t\t<div class=\"panel panel-default p-0\">",s+="\t\t\t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingTwo\">",s+="\t\t\t\t\t<div class=\"panel-title\">",s+=" \t\t\t\t\t<a role=\"button\" data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapseTwo\" aria-expanded=\"true\" aria-controls=\"collapseTwo\">",s+="\t\t\t\t\t\t\t<div class=\"d-flex card-header px-0\">",s+="\t\t\t\t\t\t\t\t<div class=\"col-11\">Personel</div>",s+="\t\t\t\t\t\t\t\t<div class=\"col-1 ml-auto\"><i class=\"fa\" aria-hidden=\"true\"> </i></div>",s+=" \t\t\t\t\t\t</div>",s+=" \t\t\t\t\t</a>",s+=" \t\t\t\t</div>",s+="\t \t\t\t</div>",s+="\t\t\t\t<div id=\"collapseTwo\" class=\"panel-collapse collapse\" role=\"tabpanel\" aria-labelledby=\"headingTwo\">",s+="\t\t\t<div class=\"panel-body border-bottom\">",s+="\t\t\t\t<div class=\"px-3\" id=\"DealerPersonel\"></div>",s+="\t\t\t</div>",s+="\t\t</div>",s+="\t</div>",s+="\t<div class=\"panel panel-default p-0\">",s+="\t\t<div class=\"panel-heading\" role=\"tab\" id=\"headingThree\">",s+="\t\t\t<div class=\"panel-title\">",s+=" \t\t\t<a role=\"button\" data-toggle=\"collapse\" data-parent=\"#accordion\" href=\"#collapseThree\" aria-expanded=\"true\" aria-controls=\"collapseThree\">",s+="\t\t\t\t\t<div class=\"d-flex card-header px-0 \">",s+="\t\t\t\t\t\t<div class=\"col-11\">Openinghours</div>",s+="\t\t\t\t\t\t<div class=\"col-1 ml-auto\"><i class=\"fa\" aria-hidden=\"true\"> </i></div>",s+=" \t\t\t\t</div>",s+=" \t\t\t</a>",s+=" \t\t</div>",s+="\t \t</div>",s+="\t\t<div id=\"collapseThree\" class=\"panel-collapse collapse\" role=\"tabpanel\" aria-labelledby=\"headingThree\">",s+="\t\t\t<div class=\"panel-body \">",s+="\t\t\t\t<div class=\"px-3\" id=\"DealerOpening\"></div>",s+="\t\t\t</div>",s+="\t\t</div>",s+="\t</div>",s+="</div>",i.append(s)}$.ajax({url:window.location.origin+"/scripts/GetDealerInfo.php?id="+e,type:"GET",dataType:"JSON",success:function(e){$.each(e,function(e,i){ShowDealerName(i),ShowDealerAddress(i.Address),ShowDealerCommunications(i.Communication),ShowDealerBusiness(i.CompanyBusiness),ShowDealerPerson(i.Person),ShowDealerOpeninghours(i.Openinghour),1!=a&&($loc=i.Address[0],map.setView([$loc.adr_gps_latitude,$loc.adr_gps_longitude],18))})},error:function(){SessionAlert("Your Session has expired... <br><br>returning to login-page!")}})}function LoadLatest(e){var a=document.getElementById("groups").value;""!=a&&(rFMS_Latest.clearLayers(),"1"==e&&(rFMS_Trip.clearLayers(),ShowLatestLayer()),$.ajax({url:window.location.origin+"/scripts/GetVehiclesMap.php",dataType:"JSON",success:function(a){return $.each(a,function(e,a){GM.push(a)}),ShowLatest(e)},error:function(){SessionAlert("Your Session has expired... <br><br>returning to login-page!")}}))}function ShowLatest(e){const a=document.getElementById("filtername").value;var i=[];$s0=!0==document.getElementsByName("filter")[0].checked?GM.filter(e=>e.status.driving==document.getElementsByName("filter")[0].checked):[],$s1=!0==document.getElementsByName("filter")[1].checked?GM.filter(e=>e.status.paused==document.getElementsByName("filter")[1].checked):[],$s2=!0==document.getElementsByName("filter")[2].checked?GM.filter(e=>e.status.stopped==document.getElementsByName("filter")[2].checked):[],$s3=!0==document.getElementsByName("filter")[3].checked?GM.filter(e=>e.status.alert==document.getElementsByName("filter")[3].checked):[],$s4=!0==document.getElementsByName("filter")[4].checked?GM.filter(e=>e.status.nolocation==document.getElementsByName("filter")[4].checked):[],$s5=!0==document.getElementsByName("filter")[5].checked?GM.filter(e=>e.status.delayed==document.getElementsByName("filter")[5].checked):[],$s7=!0==document.getElementsByName("filter")[7].checked?GM.filter(e=>e.status.drivingtoday==document.getElementsByName("filter")[7].checked):[];let s=i.concat($s0,$s1,$s2,$s3,$s4,$s5,$s7);s=s.map(JSON.stringify),s=new Set(s);let l=Array.from(s,JSON.parse);i=[];var d=l.filter(e=>{let i=e.customerVehicleName.toLowerCase().includes(a.toLowerCase());return i}),r=l.filter(e=>{let i=e.LicensePlate.toLowerCase().includes(a.toLowerCase());return i}),o=l.filter(e=>{let i=e.driver.toLowerCase().includes(a.toLowerCase());return i});s=i.concat(d,r,o),s=s.map(JSON.stringify),s=new Set(s),l=Array.from(s,JSON.parse),$s0=$s1=$s2=$s3=$s4=$s5=$s7=d=r=$f2=o=i=s=[];var c=L.AwesomeMarkers.icon({icon:"",markerColor:"green",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-22]}),n=L.AwesomeMarkers.icon({icon:"",markerColor:"lightblue",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-22]}),p=L.AwesomeMarkers.icon({icon:"",markerColor:"blue",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-22]}),m=L.AwesomeMarkers.icon({icon:"",markerColor:"red",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-22]}),f=L.AwesomeMarkers.icon({icon:"",markerColor:"orange",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-22]});UpdateCounter("","VehicleDetails"),UpdateCounter("","TotalVehicles"),rFMS_Latest.clearLayers();var v=0,u=0,g=0,h=0,b=0,y=0,T=0,D=0,x=$("#VehicleInfoD");x.html(""),$InActive="",$Damaged="",$.each(l,function(e,a){v++,!a.status.driving||(VStatusClass="<i class='fas fa-play fa-fw'></i>",LIcon=c,g++,VI_Notice="primary",VI_Icon="VehicleListIconOk",VStatus=".. Driving"),!a.status.paused||(VStatusClass="<i class='fas fa-pause fa-fw'></i>",a.last_Heading=0,LIcon=n,h++,VI_Notice="stopped",VI_Icon="VehicleListIconStopped",VStatus=".. Idling"),!a.status.stopped||(VStatusClass="<i class='fas fa-stop fa-fw'></i>",a.last_Heading=0,LIcon=p,b++,VI_Notice="stopped",VI_Icon="VehicleListIconStopped",VStatus=".. Stopped"),!a.status.alert||(VStatusClass="<i class='fas fa-exclamation-triangle fa-fw'></i>",LIcon=f,T++,VI_Notice="danger",VI_Icon="VehicleListIconError",VStatus=".. text-warning"),!a.status.delayed||(VStatusClass="<i class='fas fa-history fa-fw'></i>",LIcon=m,u++,VI_Notice="danger",VI_Icon="VehicleListIconDelayed",VStatus=".. delayed"),!a.status.nolocation||(VStatusClass="<i class='far fa-question-circle fa-fw'></i>",y++,VI_Notice="warning",VI_Icon="VehicleListIconError",VStatus=".. location not updated"),!a.status.drivingtoday?$InActive=" text-secondary":D++,0<a.DamageCount?($Damaged=" alert-danger",$DamageIcon="<i class=\"fad fa-tools fa-fw\"></i>"):($Damaged="",$DamageIcon=""),$TN=a.TrailerName?"<span > / "+a.TrailerName+"</span>":"",!0==a.status.nolocation?x.append("<a onclick=\"ShowVehicleInfo(`"+a.id+"`,true);\" class=\"w-100 VL_list \" title=\""+a.LastActivity+"\" ><div class=\"VehicleListing "+$InActive+""+$Damaged+"\"><div class=\"d-flex align-items-center\"><div class=\""+VI_Icon+"\">"+VStatusClass+""+$DamageIcon+"</div><div class=\"VehicleListName\"> "+a.customerVehicleName+" "+$TN+"<br/><span class=\"VehicleListInfo small\"></b>"+a.driver+"</span></div></div></div></a>"):($str="<a onclick=\"ShowVehicleInfo(`"+a.id+"`,true);\" class=\" w-100 VL_list\" title=\""+a.LastActivity+"\">",$str+="\t<div class=\"VehicleListing "+$InActive+""+$Damaged+"\">",$str+="\t\t<div class=\"d-flex align-items-center\">",$str+="\t\t\t<div class=\""+VI_Icon+"\">"+VStatusClass+""+$DamageIcon+"</div>",$str+="\t\t\t<div class=\"VehicleListName\"> "+a.customerVehicleName+" "+$TN,null!=a.driver&&($str+="\t\t\t\t<br/><span class=\"VehicleListInfo small\"></b>"+a.driver+"</span>"),$str+="</div>",$str+="\t\t</div>",$str+="\t</div></a>",x.append($str),L.marker([a.last_Latitude,a.last_Longitude],{rotationAngle:a.last_Heading,icon:LIcon,draggable:!1}).bindTooltip(ShowLatestTooltip(a),{direction:"top",opacity:1}).on("click",function(){ShowVehicleInfo(a.id,!0),ShowLastMarkers(a.id)}).addTo(rFMS_Latest))}),map.addLayer(rFMS_Latest),map.addLayer(rFMS_Trigger),"1"==e&&(map.fitBounds(rFMS_Latest.getBounds(),{padding:[40,40]}),$("#LatestTabs a[href=\"#ShowInfo\"]").tab("show")),UpdateCounter(v,"CTTO"),UpdateCounter(g,"CTDR"),UpdateCounter(b,"CTST"),UpdateCounter(h,"CTID"),UpdateCounter(T,"CTAL"),UpdateCounter(y,"CTNL"),UpdateCounter(u,"CTDE"),UpdateCounter(D,"CTDT")}function ShowDashboard(e,a){var i=L.AwesomeMarkers.icon({icon:"",markerColor:"green",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-32]}),s=L.AwesomeMarkers.icon({icon:"",markerColor:"lightblue",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-32]}),l=L.AwesomeMarkers.icon({icon:"",markerColor:"blue",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-32]}),d=L.AwesomeMarkers.icon({icon:"",markerColor:"red",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-32]}),r=L.AwesomeMarkers.icon({icon:"",markerColor:"orange",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-32]}),o=L.AwesomeMarkers.icon({icon:"question",markerColor:"orange",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-32]}),c=L.AwesomeMarkers.icon({icon:"",markerColor:"white",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-32]});"1"==e&&(ShowPlaceholder("VehiclesStats"),ShowPlaceholder("CountedDrivers"),ShowPlaceholder("CountedTellTales"),ShowPlaceholder("CountedDelayed"),ShowPlaceholder("SevereDamages"),ShowPlaceholder("RedTellTales"),ShowPlaceholder("DashboardVehicles","table")),$.ajax({url:window.location.origin+"/scripts/GetVehiclesDashboard.php",dataType:"JSON",method:"GET",cache:!1,success:function(c){var n=0,p=0,m=0,f=0,v=0,u=0,g=0,h=0,b=0,y=0,T=0,D=0,x=0,S=0;CountedActive=0;var N=$("#VehicleInfoD");N.html("");var C=$("#DashboardVehicles");C.html(""),rFMS_Latest.clearLayers(),DashboardVehicleList(c),$.each(c,function(e,c){n++;new Date(c.LastActivity);!0==c.status.driving&&(VStatusClass="<i class='fas fa-play '></i>",LIcon=i,h++,CountedActive++,VI_Notice="primary",VI_Icon="VehicleListIconOk",VStatus=".. Driving"),!0==c.status.paused&&(VStatusClass="<i class='fas fa-pause '></i>",LIcon=s,b++,CountedActive++,c.last_Heading=0,VI_Notice="stopped",VI_Icon="VehicleListIconStopped",VStatus=".. Idling"),!0==c.status.stopped&&(VStatusClass="<i class='fas fa-stop '></i>",LIcon=l,b++,c.last_Heading=0,VI_Notice="stopped",VI_Icon="VehicleListIconStopped",VStatus=".. Stopped"),!0==c.status.alert&&(VStatusClass="<i class='fas fa-exclamation'></i>",LIcon=r,T++,VI_Notice="text-warning",VI_Icon="VehicleListIconError",VStatus=".. text-warning"),!0==c.status.delayed&&(VStatusClass="<i class='fas fa-history'></i>",LIcon=d,g++,VI_Notice="text-danger",VI_Icon="VehicleListIconDelayed",VStatus=".. delayed"),!0==c.status.nolocation&&(VStatusClass="<i class='far fa-question-circle'></i>",LIcon=o,y++,VI_Notice="text-warning",VI_Icon="VehicleListIconError",VStatus=".. location not updated");!0==c.status.drivingtoday&&(D++,!c.Driver1_ID||p++,!c.Driver2_ID||m++,!c.status.overspeeding||u++);0>TimeToSeconds(c.RemainingDriveToday)&&f++,0<c.DamageCount&&v++;1e3>c.serviceDistance/1e3&&0!=c.serviceDistance/1e3&&S++,15e3>c.serviceDistance/1e3&&1e3<c.serviceDistance/1e3&&x++,$LP=c.LicensePlate?"<span class=\"VehicleListInfo\"></b><small>("+c.LicensePlate+")</small></span>":"",VStatusText=c.Driver1_ID?c.Lastname?c.Surname+" "+c.Lastname:c.Driver1_ID:"",!1==c.status.nolocation&&L.marker([c.last_Latitude,c.last_Longitude],{rotationAngle:c.last_Heading,icon:LIcon,draggable:!1}).bindTooltip(ShowDashboardTooltip(c),{direction:"top",opacity:1}).addTo(rFMS_Latest),(a="cards")&&ShowVehicleCard(c,"DashCards")}),map.addLayer(rFMS_Latest),"1"==e&&0<rFMS_Latest.getLayers().length&&map.fitBounds(rFMS_Latest.getBounds(),{padding:[40,40]});var w=100*(D/n);ReadTripCounter("CountedTrips"),ReadRedTellTales(),UpdateCounter("<i class=\"fad fa-truck fa-fw text-primary\"></i> <span title=\"active today\">"+D+"</span> of <span title=\"Total vehicles\">"+n+"</span><small> ( "+w.toFixed(0)+" %) </small>","VehiclesStats"),0<v?UpdateCounter(" <div class=\"badge badge-pill border p-2 normalFont shadow-sm\"> <i class=\"fad fa-tools fa-fw \"></i> "+v+"</b></span> </div> ","SevereDamages"):UpdateCounter("","SevereDamages"),UpdateCounter(" <i class=\"fad fa-wrench fa-fw text-warning\"></i><span class=\"\"> "+x+"</span>","CountedMDue"),UpdateCounter(" <i class=\"fad fa-wrench fa-fw text-danger\"></i><span class=\"\"> "+S+"</span>","CountedMOverDue"),UpdateCounter(" <a href=\"#\" title=\"# vehicles with an active telltale \"><i class=\"fad fa-exclamation-triangle fa-fw text-warning\"></i> "+T+"</a>","CountedTellTales"),UpdateCounter(" <div class=\"row\"> <div class=\"col text-primary\"><a href=\"#\" title=\"# drivers\"><i class=\"fad fa-user fa-fw text-primary\"> </i> "+p+" </a><span class=\"mx-2\"></span> <a href=\"#\" title=\"# second Drivers\"><i class=\"far fa-user fa-fw gray\"></i><i class=\"fad fa-user text-primary\"></i> "+m+" </a></div>","CountedDrivers"),0<u?UpdateCounter(" <div class=\"badge badge-pill border p-2 normalFont shadow-sm\" > <i class=\"fad fa-tachometer-alt fa-fw \"></i> "+u+"</b></span> </div> ","SpeedingDrivers"):UpdateCounter("","SpeedingDrivers"),0<f?UpdateCounter(" <div class=\"badge badge-pill border p-2 normalFont shadow-sm\" > <i class=\"fad fa-user-clock fa-fw \"></i> "+f+"</b></span> </div> ","DriversEXT"):UpdateCounter("","DriversEXT"),UpdateCounter(" <i class=\"fad fa-broadcast-tower fa-fw text-primary\"></i> "+g,"CountedDelayed"),UpdateCounter(y,"NoLocationVehicles"),"1"==e&&0<S&&Notiflix.Notify.Warning("There are <b>"+S+"</b> vehicles with overdue maintenance"),0<f&&Notiflix.Notify.Warning("There are "+f+" drivers exceeding drivingtime"),SessionAlert("Your Session has expired... <br><br>returning to login-page!")},error:function(){SessionAlert("Your Session has expired... <br><br>returning to login-page!")}})}function UpdateCounter(e,a){var i=$("#"+a);i.html(""),i.append(e)}function ShowSpinner(e){var a=$("#"+e);a.html(""),a.append("<div class='loader'></div>")}function ShowSpinnerSmall(e){var a=$("#"+e);a.html(""),a.append("<div class='sloader'></div>")}function ShowPlaceholder(e,a){var i=$("#"+e),s="<div class=\"ph-item\"><div class=\"ph-col-12\"><div class=\"ph-row\"><div class=\"ph-col-12 big\"></div></div></div></div>";if("graph"==a)var s="<div class=\"ph-item\"><div class=\"ph-col-12\"><div class=\"ph-picture\"></div></div></div>";if("single"==a)var s="<div class=\"ph-item\"><div class=\"ph-col-12\"><div class=\"ph-row\"><div class=\"ph-col-12 big\"></div></div></div></div>";if("stats"==a)var s="<div class=\"ph-item\"><div class=\"ph-col-12\"><div class=\"ph-row\"><div class=\"ph-col-2 big\"></div><div class=\"ph-col-8 empty\"></div><div class=\"ph-col-2\"></div><div class=\"ph-col-10 big empty\"></div><div class=\"ph-col-2 \"></div><div class=\"ph-col-2 big\"></div><div class=\"ph-col-8 empty\"></div><div class=\"ph-col-2\"></div></div></div></div>";if("table"==a){for(var s="<div class=\"ph-item mt-2\"><div class=\"ph-col-12\">",l=0;5>l;++l){s+="<div class=\"ph-row mb-2\">";for(var d=0;5>d;++d)s+="<div class=\"ph-col-1\"></div><div class=\"ph-col-1 empty\"></div>";s+="<div class=\"ph-col-2 mr-0\"></div></div>"}s+="</div></div\">"}if("trips"==a){for(var s="<div class=\"ph-item mt-3\"><div class=\"ph-col-12\">",l=0;5>l;++l)s+="\t<div class=\"ph-row\"><div class=\"ph-col-2 big\"></div><div class=\"ph-col-1 empty\"></div><div class=\"ph-col-6 big\"></div><div class=\"ph-col-1 empty\"></div><div class=\"ph-col-2 big\"></div><div class=\"ph-col-1 empty\"></div></div>";s+="</div></div\">"}if("sumreport"==a){for(var s="<div class=\"ph-item\">\t<div class=\"ph-col-12\"><div class=\"ph-row mb-2\">",d=0;6>d;++d)s+="<div class=\"ph-col-1 big\"></div><div class=\"ph-col-1 empty\"></div>";s+="</div></div></div\">"}i.html(""),i.append(s)}function DashboardVehicleList(e){var a=$("#DashboardVehicles").DataTable({oLanguage:{sProcessing:"<div class='animated-background' id='tableloader'></div>"},processing:!0,paging:!0,bInfo:!1,lengthMenu:[[8,-1],[8,"All"]],bLengthChange:!1,language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},autoWidth:!1,destroy:!0,order:[[4,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,responsive:!0,buttons:{buttons:[]},data:e,columns:[{data:"tripActive",render:function(e){return"1"==e?"<i class=\"fad fa-play iconbox drive \"></i>":"<i class=\"fad fa-stop iconbox rest\"></i>"},title:" ",visible:!0,width:"1%",className:"dt-center"},{data:"customerVehicleName",title:"Vehicle",className:"dt-left ",render:function(e,a,i){return"<a href=\"pages/vehicle_edit.php?id="+i.id+"\" class=\"underline \"> "+i.customerVehicleName+" </a>"}},{data:"TrailerName",title:"Trailer",className:"dt-left",render:function(e,a,i){return i.TrailerName?"<a href=\"pages/trailer_edit.php?id="+i.TrailerId+"\" class=\"underline \"> "+i.TrailerName+" </a>":""}},{data:"Driver",title:"Driver",defaultContent:"",className:"dt-left ",render:function(e,a,i){return i.Driver?"<a href=\"pages/driver_edit.php?id="+i.DriverId+"\" class=\"underline \"> "+i.Driver+" </a>":""}},{data:"RemainingDriveToday",title:"Rem.Drive",defaultContent:"",className:"dt-center"},{data:"TotDistanceToday",title:"km Today",defaultContent:"",className:"dt-center "},{data:"LastActivity",title:"Last Contact UTC",defaultContent:"",className:"dt-left",visible:!1},{data:"LowTire",orderable:!1,render:function(e){return"1"<=e?"<i class=\"fad fa-tire-pressure-warning\"></i><span class=\"text-danger\"><b> "+e+" </b></span>":"<i class=\"fad fa-tire-pressure-warning hide\"></i>"},title:"",defaultContent:"",className:"dt-center"},{data:"LowOil",orderable:!1,render:function(e){return"1"<=e?"<i class=\"fad fa-oil-can text-danger\"></i><span class=\"text-danger\"><b> "+e+" </b></span>":"<i class=\"fad fa-oil-can hide\"></i>"},title:"",defaultContent:"",className:"dt-center"},{data:"LowBattery",orderable:!1,render:function(e){return"1"<=e?"<i class=\"fad fa-car-batterydanger\"></i><span class=\"text-danger\"><b> "+e+" </b></span>":"<i class=\"fad fa-car-battery hide\"></i>"},title:"",defaultContent:"",className:"dt-center"},{data:"DamageCount",orderable:!1,render:function(e){return"1"<=e?"<i class=\"fad fa-tools text-danger\"></i><span class=\"text-danger\"><b> "+e+" </b></span>":"<i class=\"fad fa-tools hide\"></i>"},title:"",defaultContent:"",className:"dt-center"},{data:"CountWarning",orderable:!1,render:function(e){return 0<e?"<i class=\"fad fa-exclamation-triangle text-warning\"></i>":"<i class=\"fad fa-exclamation-triangle hide\"></i>"},title:"",defaultContent:"",className:"dt-center"},{data:"currentSpeed",orderable:!1,render:function(e){return 85<e?"<i class=\"fad fa-tachometer-alt text-warning\"></i>":"<i class=\"fad fa-tachometer-alt hide\"></i>"},title:"",defaultContent:"",className:"dt-center"},{data:"Maintenance",orderable:!1,render:function(e){return"<i class=\"fad fa-wrench text-"+e+"\"></i>"},title:"",defaultContent:"",className:"dt-center"}]});$("#DashboardVehicles").off("click"),$("#DashboardVehicles").on("click","tr",function(){var e=a.row(this).data();map.flyTo([e.last_Latitude,e.last_Longitude],13)})}function ShowLatestTooltip(e){var a="";$LP="";var i=convertUTCDateToLocalDate(new Date(e.LastActivity)),s="",l="";return null!=e.TrailerName&&($LP="<span class=\"VehicleListInfo\"></b>("+e.TrailerName+")</span>"),0<e.DamageCount&&(s=" alert-danger text-danger",l="<br><i class=\"fad fa-tools fa-fw\"></i> "+e.DamageCount),a+="<div class=\"card leafletpopup\"><div class=\"card-header text-primary p-2 py-1"+s+"\"><b>"+e.customerVehicleName+"</b> "+$LP+" "+l+"</div> <div class=\"card-body p-2\">",null!=e.driver&&(a+="<span class=\"TooltipLine\"><i class=\"fad fa-user fa-fw\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt\"> "+e.driver+"</span></br>",!!e.RemainingDriveToday&&(a+="<span class=\"TooltipLine\"><i class=\"fad fa-user-clock fa-fw\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt\"> "+e.RemainingDriveToday+" </span></span></br>"),!!e.RemainingRestToday&&(a+="<span class=\"TooltipLine\"><i class=\"fad fa-utensils fa-fw\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt\"> "+e.RemainingRestToday+" </span></span></br>")),-1<e.currentSpeed&&(a+="<span class=\"TooltipLine\"><i class=\"fad fa-tachometer-alt fa-fw\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt\"> "+e.currentSpeed+" km/u</span></span></br>"),a+=null==e.FuelLevel?"<span class=\"TooltipLine\"><i class=\"fas fa-gas-pump fa-fw\"></i><i class=\"fa fa-fw\"></i>  %</span></span></br>":"<span class=\"\"><i class=\"fad fa-gas-pump fa-fw\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt\"> "+e.FuelLevel+" %</span></span></br>",a+=0<e.CountWarning?"<span class=\"TooltipLine\"><i class=\"fad fa-exclamation-triangle fa-fw text-danger\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt \"> "+e.CountWarning+" warning lamps</span></span></br>":"<span class=\"TooltipLine\"><i class=\"fad fa-exclamation-triangle fa-fw\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt\"> no warning lamps</span></span></br>",a+=!0==e.status.delayed?"<span class=\" text-danger\"><i class=\"fad fa-history text-danger fa-fw\"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt text-danger\"> <strong>"+dateFormat(i,"yyyy-mm-dd HH:MM ")+"</span></span></br></div></div>":"<span class=\"TooltipLine\"><i class=\"fad fa-clock fa-fw \"></i><i class=\"fa fa-fw\"></i><span class=\"tooltiptxt \"> <strong>"+dateFormat(i,"yyyy-mm-dd HH:MM ")+"</span></span></br></div></div>",a}function ShowDashboardTooltip(e){var a="",i=e.TrailerName,s=new Date(e.LastActivity);return a+="<div class=\"leafletpopup rounded\">",a+=null==e.TrailerName?"\t<div class=\"card-header p-2\"><i class=\"fad fa-truck-moving fa-fw\"></i><i class=\"fad fa-fw\"></i><b> "+e.customerVehicleName+"</b> </div>":"\t<div class=\"card-header p-2\"> <i class=\"fad fa-trailer fa-fw\"></i><i class=\"fad fa-truck-moving fa-fw\"></i><b> "+e.customerVehicleName+" / "+e.TrailerName+"</b></div>",a+="\t<div class=\"card-body p-2 small\">","*"==$SelectedGroup&&(a+="<div class=\"StatusLine\"><i class=\"fad fa-building fa-fw\"></i><i class=\"fad fa-fw\"></i> "+e.name+"</div>"),a+="<div class=\"StatusLine\"><i class=\"fad fa-user fa-fw\"></i><i class=\"fad fa-fw\"></i> "+e.Driver+" ( "+e.RemainingDriveToday+" )</div>",a+="</div></div>",a}function ZoomMarker(e,a){map.flyto([e,a],16)}function ShowLatestButtons(){var e=[L.easyButton({id:"01",position:"bottomright",type:"replace",leafletClasses:!0,states:[{stateName:"get-center",onClick:function(){closeVehDet(),LoadLatest()},title:"Refresh data",icon:"fad fa-sync text-primary"}]}),L.easyButton({id:"00",position:"topright",type:"replace",leafletClasses:!0,states:[{stateName:"get-center",onClick:function(e,a){closeVehDet(),a.fitBounds(rFMS_Latest.getBounds(),{padding:[40,40]}),rFMS_Trip.clearLayers(),ShowLatestLayer()},title:"Fit Zoom",icon:"fas fa-expand-arrows-alt text-primary"}]})];L.easyBar(e).addTo(map)}function ShowDBButtons(){var e=[L.easyButton({id:"4",position:"topright",type:"replace",leafletClasses:!0,states:[{stateName:"get-center",onClick:function(){ShowMarkerLayer()},title:"Trip markers",icon:"fad fa-map-marker-alt text-primary"}]}),L.easyButton({id:"2",position:"topright",type:"replace",leafletClasses:!0,states:[{stateName:"get-center",onClick:function(){ShowTripLayer()},title:"Showing Trips",icon:"fad fa-route text-primary"}]}),L.easyButton({id:"1",position:"topright",type:"replace",leafletClasses:!0,states:[{stateName:"get-center",onClick:function(e,a){a.fitBounds(rFMS_Trip.getBounds(),{padding:[40,40]})},title:"Zoom-Fit",icon:"fad fa-expand-arrows-alt text-primary"}]})];L.easyBar(e).addTo(map)}function Convert2Address(e){var a=$("#"+e[2]);a.html(""),$.ajax({url:"https://reverse.geocoder.api.here.com/6.2/reversegeocode.json?prox="+e[0]+","+e[1]+"&mode=retrieveAddresses&gen=9&language=en&maxresults=1&app_id=Ch87ydlyXjsmnI5AcXho&app_code=z2HsXPK48vhNPwyfcFr5ew",type:"GET",dataType:"json",success:function(e){a.append("<i class=\"fad fa-map-marked-alt fa-fw \"></i><i class=\"fas fa-fw\"></i> "),a.append(e.Response.View[0].Result[0].Location.Address.Label)},error:function(){a.append("no service available to retrieve location")}})}function ReadDriverDetails(e,a){var i=$("#"+a),s="";$.ajax({url:window.location.origin+"/scripts/GetDriverDashboard.php?id="+e,type:"GET",dataType:"json",success:function(e){i.html(""),$.each(e,function(e,l){"DR_"+l.DriverId;s+="<div class=\"d-flex StatusLine navbar-light\">",s+="Driver1"==a?"<div class=\"p-0\"><i class=\"fad fa-user fa-fw\"></i><i class=\"fad fa-fw\"></i>"+l.Driver+"</div>":"<div class=\"p-0\"><i class=\"far fa-user fa-fw\"></i><i class=\"fad fa-user fa-fw \"></i>"+l.Driver+"</div>",s+="<div class=\"ml-auto p-0\"><i class=\"fad fa-user-clock \"></i> <span id=\"1\">"+l.RemainingDriveToday+"</span></div>",s+="</div>",i.append(s)})},error:function(){i.append("<div class=\"d-flex StatusLine navbar-light\"><div class=\"p-2 align-middle\">Driver <i class=\"fad fa-user primary\"></i></div><div class=\"ml-auto p-2 StatusValue\"> - </div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Tachograph Status </div><div class=\"ml-auto p-2 StatusValue\"><b> - </b></div></div>")}})}function ReadRedTellTales(){var e=$("#RedTellTales");e.html("");var a="";$.ajax({url:window.location.origin+"/scripts/CountTodayRedAlerts.php",type:"GET",dataType:"json",success:function(i){e.html(""),0<i.length&&($countActive=i[1].CountedRed,$countAlerts=parseInt(i[0].CountedRed)+parseInt(i[1].CountedRed),a+="<div class=\"badge badge-pill border p-2 normalFont shadow-sm\">",a+="\t\t<i class=\"fad fa-exclamation-triangle fa-fw text-danger\"></i> "+$countActive+" <span class=\"grey\"><small>active </small> </span>"+$countAlerts+"<span class=\"grey\"><small> total today</small> </span> </div> ",a+="</div></div>"),e.append(a),0<$countAlerts&&Notiflix.Notify.Failure("# Vehicles with Red Warning lights : <b>"+$countAlerts)},error:function(){SessionAlert("Your Session has expired... <br><br>returning to login-page!")}})}function ReadTodayVehicleTrips(e,a,i){var s=$("#"+a);ShowPlaceholder(a,"trips");var l=new Date,d=new Date;$.ajax({url:window.location.origin+"/scripts/GetVehicleTodayTrips.php?id="+e,type:"GET",dataType:"json",success:function(e){var l="";UpdateCounter("",a),UpdateCounter(e.length,"TripCounter"),s.append(l);var r=new Date;r.setHours(0,0,0,0),r="";var o=$("#TripsCol");$.each(e,function(e,a){if(a.StartDate=convertUTCDateToLocalDate(new Date(a.StartDate)),a.EndDate=convertUTCDateToLocalDate(new Date(a.EndDate)),a.driver=null==a.driver?"":"<i class=\"fad fa-user tiny\"></i> "+a.driver,!0==a.TripDelayed)s=" ";else var s="";if(0!=a.TripActive){var c=new Date-new Date(a.StartDate),n=new Date(a.StartDate+" UTC")-new Date(r+" UTC");6e4<n&&(l="\t<div class=\"TripBreakLine d-flex\">",l+="\t\t<div class=\"mx-auto badge TripBreakText text-secondary\">stopped <i class=\"fad fa-clock fa-fw\"></i> "+dateFormat(n,"HH:MM ")+"</div>",l+="\t</div>",o.append(l)),l="<a href=\"javascript:ShowTripMap("+a.Trip_NO+");\">",l+="\t<div class=\"TripListingActive\">",l+="\t\t<div class=\"col-12 d-flex p-1 "+s+"\">",l+="\t\t\t<div class=\"col-3 TripListName p-0 pr-3 \"><i class=\"fad fa-flag fa-fw \"></i> <b>"+dateFormat(a.StartDate,"HH:MM ")+"</b></div>",l+="\t\t\t<div class=\"mr-auto TripListNameS p-0 pr-3\"> "+a.driver+" </div>",l+="\t\t\t<div class=\"ml-auto TripListName \"><b>"+dateFormat(d,"HH:MM ")+"</b> <i class=\"fas fa-flip-horizontal fa-wind fa-sm fa-fw \" ></i><i class=\"fas fa-truck-moving\"></i></div>",l+="\t\t</div>",!0==i&&(l+="\t\t<div class=\"col-12 d-flex p-1\">",l+="\t\t\t<div class=\"col-4 mr-auto TripListNameS no-padding \"><i class=\"fas fa-route fa-fw \"></i> "+$Distance+" km </div>",l+="\t\t\t<div class=\"col-3 text-right TripListNameS no-padding \"> "+dateFormat(c,"UTC:HH:MM ")+" <i class=\"far fa-clock fa-fw \"></i></div>",l+="\t\t</div>"),l+="\t</div></a>",o.append(l),r=a.EndDate,l=""}else if(-1<a.Distance){var n=new Date(a.StartDate+" UTC")-new Date(r+" UTC");6e4<n&&(l="\t<div class=\"TripBreakLine d-flex\">",l+="\t\t<div class=\"mx-auto badge TripBreakText text-secondary\">stopped <i class=\"fad fa-clock fa-fw\"></i> "+dateFormat(n,"HH:MM ")+"</div>",l+="\t</div>",o.append(l)),l="<a href=\"javascript:ShowTripMap("+a.Trip_NO+");\">",l+="\t<div class=\"TripListing\">",l+="\t\t<div class=\"col-12 d-flex p-1 "+s+" \">",l+="\t\t\t<div class=\"col-3 TripListName p-0 pr-3 \"><i class=\" fad fa-fw fa-flag\"></i> <b>"+dateFormat(a.StartDate,"HH:MM ")+"</b></div>",l+="\t\t\t<div class=\"mr-auto TripListNameS p-0 pr-3\">"+a.driver+" </div>",l+="\t\t\t<div class=\"ml-auto TripListName  p-0 \"><b>"+dateFormat(a.EndDate,"HH:MM ")+"<i class=\" fad fa-flag-checkered fa-fw \"></b></i></div>",l+="\t\t</div>",!0==i&&(l+="\t\t<div class=\"col-12 d-flex p-1 \">",l+="\t\t\t<div class=\"col-3 TripListNameS p-0 pr-3 \"><i class=\"fas fa-route fa-fw \"></i> "+a.Distance+" </div>",l+=0<a.FuelUsage?"\t\t\t<div class=\"col-3 TripListNameS p-0 pr-3 \"> <i class=\"fas fa-tint tiny fa-fw \"></i> "+a.FuelUsage+" </div>":"\t\t\t<div class=\"col-3 TripListNameS p-0 pr-3\">  </div>",l+=0<a.FuelUsed?"\t\t\t<div class=\"col-3 TripListNameS\" no-padding > <i class=\"fas fa-gas-pump fa-fw tiny \"></i> "+a.FuelUsed+" </div>":"\t\t<div class=\"col-3 TripListNameS p-0 pr-3\">  </div>",l+="\t\t\t<div class=\"ml-auto text-right TripListNameS p-0\"> "+a.Duration+" <i class=\"fad fa-clock fa-fw \"></i></div>",l+="</div>"),l+="</div></a>",o.append(l),r=a.EndDate}})},error:function(){$TInfo.append("<div class=\"col-12 notice notice-danger\" >No Trips of today available</div>"),UpdateCounter("",a)}})}function ReadTodayDriverTrips(e,a,i){var s=$("#"+i),l="";$.ajax({url:window.location.origin+"/scripts/GetDriverTrips.php?id="+a+"&date="+e,type:"GET",dataType:"json",success:function(a){s.html(""),$.each(a,function(a,i){0==i.TripActive?(l="<a href=\"#\" onclick=\"Show1Trip("+i+")\"><div class=\"TripListing pb-1 mb-1 \">",l+="<div class=\"col-12 d-flex no-padding px-1 pt-2 \">",l+="<div class=\"col-3 TripListName no-padding primary pr-3\"><i class=\"primary far fa-flag\"></i> <b>"+dateFormat(i.StartDate,"HH:MM ")+"</b></div>",l+="<div class=\"col-6 mr-auto TripListNameS no-padding pr-3\"> "+i.customerVehicleName+" </div>",l+="<div class=\"ml-auto TripListName primary no-padding \"><b>"+dateFormat(i.EndDate,"HH:MM ")+"<i class=\"primary fas fa-flag-checkered\"></b></i></div>",l+="</div>",l+="<div class=\"col-12 d-flex no-padding px-1 pt-2\">",l+="<div class=\"col-3 TripListName no-padding pr-3 primary\"><i class=\"fas fa-route\"></i> "+i.Distance+" </div>",l+=0<i.FuelUsage?"<div class=\"col-3 TripListName no-padding pr-3 primary\"> <i class=\"fas fa-tint tiny\"></i> "+i.FuelUsage+" </div>":"<div class=\"col-3 TripListNameS no-padding pr-3\">  </div>",l+=0<i.FuelUsed?"<div class=\"col-3 TripListNameS\" no-padding > <i class=\"fas fa-gas-pump tiny\"></i> "+i.FuelUsed+" </div>":"<div class=\"col-3 TripListNameS no-padding pr-3\">  </div>",l+="<div class=\"ml-auto text-right TripListName primary no-padding\"> "+i.Duration+" <i class=\"far fa-clock\"></i></div>",l+="</div></div></a>",s.append(l)):($Duration=new Date(localDate)-new Date(i.StartDate),$Distance=(e.OdoMeter-i.start_odometer)/1e3,l="<a href=\"#\" onclick=\"Show1Trip("+i+" );\"><div class=\"TripListingActive pb-1 mb-1 \">",l+="<div class=\"col-12 d-flex no-padding px-1 pt-2\">",l+="<div class=\"col-3 TripListName no-padding primary pr-3\"><i class=\"primary far fa-flag\"></i> <b>"+dateFormat(i.StartDate,"HH:MM ")+"</b></div>",l+="<div class=\"col-6 mr-auto TripListNameS no-padding pr-3\"> "+i.customerVehicleName+" </div>",l+="<div class=\"ml-auto TripListName work\"><b>"+dateFormat(localDate,"HH:MM ")+"</b> <i class=\"fas fa-flip-horizontal fa-wind fa-sm\" ></i><i class=\"fas fa-truck-moving\"></i></div>",l+="</div>",l+="<div class=\"col-12 d-flex no-padding px-1 pt-2\">",l+="<div class=\"col-4 mr-auto TripListName no-padding primary\"><i class=\"fas fa-route\"></i> "+$Distance+" km </div>",l+="<div class=\"col-3 text-right TripListName no-padding primary\"> "+dateFormat($Duration,"HH:MM ")+" <i class=\"far fa-clock\"></i></div>",l+="</div></div></a>",s.append(l))}),l="<div class=\"TripListing pb-4 mb-1 \"><p>&nbsp</p></div>",s.append(l)},error:function(){s.append("No Trips Today")}})}function sleep(e){for(var a=new Date().getTime(),s=0;1e7>s&&!(new Date().getTime()-a>e);s++);}function ShowVehicleTable(){table=$("#tableVehicles").DataTable({ajax:{url:window.location.origin+"/scripts/GetVehicles.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<span class='animated-background'></span>"},processing:!0,paging:!0,pageResize:!0,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[11,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,responsive:!0,buttons:{buttons:[{extend:"excel",title:"rFMS Reader VehicleOverview"},{extend:"pdf",orientation:"landscape",pageSize:"A3",messageTop:"Active Vehicles",title:"rFMS-Connect _VehicleOverview",customize:function(e){e.defaultStyle.fontSize=8}},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print",orientation:"landscape",pageSize:"A4",messageTop:"Active Vehicles",title:"rFMS-Connect _VehicleOverview"}]},columns:[{data:"tripActive",render:function(e){return"1"==e?"<i class=\"fas fa-play drive\"></i>":"<i class=\"fas fa-stop rest\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right"},{data:"customerVehicleName",title:"Vehicle Name",className:"dt-left"},{data:"TrailerName",title:"Trailer",className:"dt-left",render:function(e,a,i){return i.TrailerName?"<a href=\"trailer_edit.php?id="+i.TrailerId+"\" class=\"underline \"> "+i.TrailerName+" </a>":""}},{data:"Driver",title:"Driver",defaultContent:"",className:"dt-left ",render:function(e,a,i){return i.Driver?"<a href=\"driver_edit.php?id="+i.DriverId+"\" class=\"underline \"> "+i.Driver+" </a>":""}},{data:"LicensePlate",title:"License Plate",defaultContent:"",className:"dt-left",width:"6%"},{data:"OdoMeter",title:"ODO Meter",defaultContent:"",className:"dt-right",width:"4%"},{data:"serviceDistance",title:"Service Distance",defaultContent:"",className:"dt-center",width:"4%"},{data:"LastActivity",title:"Last Contact UTC",defaultContent:"",className:"dt-left"},{data:"FuelLevel",title:"Fuel level (%)",defaultContent:"",className:"dt-center",width:"3%"},{data:"CatalystFuelLevel",title:"Adblue level (%)",defaultContent:"",className:"dt-center",width:"3%"},{data:"Warnings",render:function(e){return"1"<=e?"<i class=\"fad fa-exclamation-triangle text-danger\"></i><span class=\"danger\"><b> "+e+" </b></span>":"<i class=\"fad fa-exclamation-triangle hide\"></i>"},title:"RED text-warning",defaultContent:"",className:"dt-center",width:"3%"},{data:"DamageCount",render:function(e){return"1"<=e?"<i class=\"fad fa-tools text-danger\"></i><span class=\"danger\"><b> "+e+" </b></span>":"<i class=\"fad fa-tools hide\"></i>"},title:"Severe Damage",defaultContent:"",className:"dt-center",width:"3%"},{data:"grossCombinationVehicleWeight",title:"Current Weight",defaultContent:"",className:"dt-right",width:"3%"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"vehicle_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}}]}),$("#tableVehicles").off("click"),$("#tableVehicles").on("click","tr",function(){var e=table.row(this).data();$(window).attr("location","/pages/vehicle_edit.php?id="+e.id)})}function ShowPDCTable(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#tablePDC").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDC.php?startDate="+e+"&endDate="+a,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[0,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS Reader VehicleOverview"},{extend:"pdf",orientation:"landscape",pageSize:"A3",messageTop:"Active Vehicles",title:"rFMS-Connect _VehicleOverview",customize:function(e){e.defaultStyle.fontSize=8}},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print",orientation:"landscape",pageSize:"A4",messageTop:"Active Vehicles",title:"rFMS-Connect _VehicleOverview"}]},createdRow:function(e,a){0<a.critical_damages&&$(e).addClass("delayedrow")},columns:[{data:"date",title:"Date",className:"dt-left"},{data:"customerVehicleName",title:"Vehicle Name",className:"dt-left"},{data:"TrailerName",title:"Trailer",className:"dt-left"},{data:"driver",title:"Driver",className:"dt-left"},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<btn onclick=\"ShowPDC_CheckResult(`"+i.id+"`);\" class=\"btn text-danger \"><i class=\"far fa-file-pdf\"></i></btn>"}},{data:"critical_damages",render:function(e){return"0"==e?"<i class=\"fa-fw\"></i>"+e:"<i class=\"fas fa-exclamation fa-fw text-danger\"></i>"+e},title:"critical damages ",visible:!0,width:"2%",className:"dt-center"},{data:"damages",title:"damages",defaultContent:"",width:"2%",className:"dt-center"},{data:"add_notes",title:"notes",defaultContent:"",className:"dt-left"},{data:"checked",title:"checked",defaultContent:"",className:"dt-center",width:"2%"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"vehicle_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}}]});$("#tableVehicles").off("click"),$("#tableVehicles").on("click","tr",function(){var e=i.row(this).data();$(window).attr("location","/pages/vehicle_edit.php?id="+e.id)})}function ShowAlertHistoryTable(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#tableAlertHistory").DataTable({ajax:{url:window.location.origin+"/scripts/GetAlertsHistory.php?startDate="+e+"&endDate="+a,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search",zeroRecords:"<span class='gray'><i>no data-records available</i></span>"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[1,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS Reader VehicleOverview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"Active Vehicles",title:"rFMS-Connect _VehicleOverview",customize:function(e){e.defaultStyle.fontSize=8}},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print",orientation:"landscape",pageSize:"A4",messageTop:"Active Vehicles",title:"rFMS-Connect _VehicleOverview"}]},columns:[{data:"CountedYellow",render:function(e){return"0"==e?"<i class=\"fa-fw\"></i>":"<i class=\"fas fa-exclamation-triangle fa-fw text-warning\"></i><span class=\"warning\">"+e+"</span>"},title:"Yellow warnings ",visible:!0,width:"6%",className:"dt-center"},{data:"CountedRed",render:function(e){return"0"==e?"<i class=\"fa-fw\"></i>":"<i class=\"fas fa-exclamation-triangle fa-fw text-danger\"></i><span class=\"danger\">"+e+"</span>"},title:"Red warnings ",visible:!0,width:"6%",className:"dt-center"},{data:"vehicle",title:"vehicle",defaultContent:"",className:"dt-left"},{data:"customerName",title:"Group",className:"dt-left"},{data:"LicensePlate",title:"License plate",className:"dt-left"},{data:"brand",title:"brand",className:"dt-left"},{data:"model",title:"model",className:"dt-left"}]});$("#tableVehicles").off("click")}function ShowMaintenanceTable(){$("#tableMaintenance").DataTable({ajax:{url:window.location.origin+"/scripts/GetMaintenanceVehicles.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[3,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,createdRow:function(e,a){!0==a.Due&&$(e).addClass("delayedrow")},buttons:{buttons:[{extend:"excel",text:"excel",title:"Vehicles Due Maintenance Overview_"+dateFormat(new Date,"yyyy-mm-dd")},{extend:"pdf",text:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"Maintenance Vehicles",title:"rFMS Reader Vehicles Due Maintenance Overview",customize:function(e){e.defaultStyle.fontSize=8}},{extend:"csv",extension:".csv",fieldSeparator:";",title:"rFMS Reader Vehicles Due Maintenance Overview"},{extend:"print",text:"print",orientation:"landscape",pageSize:"A4",messageTop:"Maintenance Vehicles",title:"rFMS Reader Vehicles Due Maintenance Overview"}]},columns:[{data:"Name",title:"Name",className:"dt-left"},{data:"LicensePlate",title:"License Plate",className:"dt-left"},{data:"type",title:"Type",className:"dt-left"},{data:"OdoMeter",title:"ODO Meter",className:"dt-right"},{data:"serviceDistance",title:"Service Distance",className:"dt-center"},{data:"Due",render:function(e){return"0"==e?"":"<i class=\"fad fa-wrench fa-fw text-danger\"></i>"},title:"Overdue ",visible:!0,width:"6%",className:"dt-center"},{data:"Damages",title:"Damages",className:"dt-center"},{data:"CriticalDamages",title:"Critical Damages",className:"dt-center"},{data:"VIN",title:"vin",className:"dt-left"},{data:"Country",title:"Customer Country"},{data:"Service_Homedealer",title:"Workshop"}]})}function ShowDriverTable(){var e=$("#tableDrivers").DataTable({ajax:{url:window.location.origin+"/scripts/GetDrivers.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<span class='loader'></span>"},processing:!0,paging:!0,pageResize:!0,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[1,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect  Drivers_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"Driver Overview",title:"rFMS-Connect  Drivers_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"tripActive",render:function(e){return"1"==e?"<i class=\"fas fa-play grey iconbox\"></i>":"<i class=\"fas fa-stop grey iconbox\"></i>"},title:" ",visible:!0,width:"1%",className:"dt-center"},{data:"Lastname",title:"Lastname",defaultContent:"",visible:!0,className:"dt-left"},{data:"Surname",title:"Name",defaultContent:"",visible:!0,className:"dt-left"},{data:"Address",title:"Address",defaultContent:"",visible:!1,className:"dt-left"},{data:"Country",title:"Country",defaultContent:"",visible:!1,defaultContent:""},{data:"City",title:"City",defaultContent:"",visible:!1,className:"dt-left"},{data:"Phone_Mobile",title:"Mobile",defaultContent:"",visible:!0},{data:"eMail",title:"eMail",defaultContent:"",visible:!1},{data:"tachoDriverIdentification",title:"Tacho card ID",defaultContent:"",visible:!0,className:"dt-left",width:"10%"},{data:"Validity",title:"Valid until",defaultContent:"",visible:!0,className:"dt-left"},{data:"RemainingDriveToday",title:"Remaining Today",defaultContent:"",visible:!0,className:"dt-left"},{data:"LastDriverActivity",title:"Last Activity",defaultContent:"",visible:!0,className:"dt-left"},{data:"customerVehicleName",title:"Driving on",defaultContent:"",visible:!0,className:"dt-left"},{data:"CurrentStatus",title:"TachographState",defaultContent:"",visible:!0,className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"driver_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"driver_delete.php?id="+i.id+"\" class=\"btn btn-default\"><i class=\"fad fa-trash-alt \"><i></a>"}}]});$("#tableDrivers").off("click"),$("#tableDrivers").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/pages/driver_edit.php?id="+a.id)})}function ShowTrailerTable(){var e=$("#tableTrailers").DataTable({ajax:{url:window.location.origin+"/scripts/GetTrailers.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[1,"asc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect _Trailers_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"Trailer Overview",title:"rFMS-Connect _Trailers_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"copplingStatus",render:function(e){return"1"==e?"<i class=\"fas fa-link rest\"></i>":"<i class=\"fas fa-unlink work\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-center"},{data:"trailerName",title:"Trailer",defaultContent:"",visible:!0,className:"dt-left"},{data:"LicensePlate",title:"Licenseplate",defaultContent:"",visible:!0,defaultContent:""},{data:"customerVehicleName",title:"Vehicle",defaultContent:"",visible:!0,className:"dt-left"},{data:"LastActivity",title:"LastActivity",defaultContent:"",visible:!0,className:"dt-left"},{data:"brand",title:"Trailer brand",defaultContent:"",visible:!0,className:"dt-left"},{data:"model",title:"Trailer model",defaultContent:"",visible:!0,className:"dt-left"},{data:"grossCombinationVehicleWeight",title:"TotalWeight",defaultContent:"",visible:!0,className:"dt-left",width:"3%"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"trailer_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"trailer_delete.php?id="+i.id+"\" class=\"btn \"><i class=\"fad fa-trash-alt \"><i></a>"}}]});$("#tableTrailers").off("click"),$("#tableTrailers").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/pages/trailer_edit.php?id="+a.id)})}function ShowAPITable(){var e=$("#tableAPI").DataTable({ajax:{url:window.location.origin+"/scripts/GetAPICollectors.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,lengthMenu:[[8,-1],[8,"All"]],autoWidth:!1,destroy:!0,order:[[1,"asc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,bLengthChange:!1,buttons:{buttons:[{extend:"excel",class:"btn btn-primary",title:"rFMS-Connect _APICollectors_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"API CollectorsOverview",title:"rFMS-Connect _APICollectors_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off gray\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-center"},{data:"name",title:"Name",defaultContent:"",visible:!0,className:"dt-left"},{data:"TypeName",title:"API Type",defaultContent:"",visible:!0,className:"dt-left"},{data:"vendor",title:"Vendor",defaultContent:"",visible:!0,className:"dt-left"},{data:"apiCustomerName",title:"Account at vendor",defaultContent:"",visible:!0,className:"dt-left"},{data:"auth_type",title:"Authentication",defaultContent:"",visible:!0,className:"dt-left"},{data:"CountFI",render:function(e){return 0==e?"<i class=\"fad fa-check \"></i>":"<i class=\"fad fa-exclamation-triangle \"></i>"},title:"Quality ",visible:!0,width:"2%",className:"dt-center"},{data:"EndPoints",title:"EndPoints",defaultContent:"",visible:!0,className:"dt-center",width:"3%"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"api_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"api_delete.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-trash-alt \"><i></a>"}}]});$("#tableAPI").off("click"),$("#tableAPI").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/pages/api_edit.php?id="+a.id)})}function ShowAPIScheduler(e){$("#APIScheduleTable").DataTable({ajax:{url:window.location.origin+"/scripts/GetAPIScheduler.php?id="+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!1,pageResize:!0,searching:!1,bLengthChange:!1,autoWidth:!1,destroy:!0,dom:"Bfltirp",bInfo:!1,scrollCollapse:!0,scrollX:!1,deferRender:!0,sorting:!1,buttons:{buttons:[]},columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off gray\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-center"},{data:"collector_id",title:"collector_id",defaultContent:"",visible:!1,className:"dt-left"},{data:"Description",title:"Description",defaultContent:"",visible:!0,className:"dt-left"},{data:"name_EndPoint",title:"Endpoint",defaultContent:"",visible:!0,className:"dt-left"},{data:"typeId",title:"typeId",defaultContent:"",visible:!1,className:"dt-left"},{data:"frequency",title:"frequency in min",defaultContent:"",visible:!0,defaultContent:""},{data:"lastExecution",title:"lastExecution",defaultContent:"",visible:!0,className:"dt-left"},{data:"lastStatus",render:function(e){return"200"==e?"<i class=\"fas fa-check text-success\"></i>":"<i class=\"fas fa-exclamation-triangle text-danger\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-center"},{data:"lastStatus",title:"lastStatus",defaultContent:"",visible:!1,className:"dt-left"},{data:"Script",title:"Script",defaultContent:"",visible:!1,className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"api_scheduler_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}}]});$("#APIScheduleTable").off("click")}function ShowAdminAuditTable(){$("#AuditTable").DataTable({ajax:{url:window.location.origin+"/scripts/GetAdminAuditLogs.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,searching:!1,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[1,"asc"]],dom:"Bfltirp",bInfo:!1,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[]},columns:[{data:"id",title:"id",defaultContent:"",className:"dt-left"},{data:"user",title:"user",defaultContent:"",visible:!0,className:"dt-left"},{data:"page",title:"page",defaultContent:"",visible:!0,className:"dt-left"},{data:"timestamp",title:"time",defaultContent:"",className:"dt-left"},{data:"ip",title:"ip-address",defaultContent:"",visible:!0,defaultContent:""},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"/scripts/delete_auditlog.php?id"+i.id+"\" class=\"btn btn-default editor_delete text-danger\"><i class=\"fad fa-trash-alt text-danger\"><i></a>"}}]});$("#AuditTable").off("click")}function ShowPagesPermissionsTable(){var e=$("#tablePagePermissions").DataTable({ajax:{url:window.location.origin+"/scripts/GetPagesPermissions.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:" search"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,bInfo:!1,lengthMenu:[[12,-1],[12,"All"]],bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[3,"desc"]],dom:"Bfltirp",scrollX:!0,deferRender:!0,pageResize:!0,searching:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect _APICollectors_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"API CollectorsOverview",title:"rFMS-Connect _APICollectors_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"private",render:function(e){return"1"==e?"<i class=\"fad fa-check-square rest\"></i>":"<i class=\"far fa-square \"></i>"},title:" private",visible:!0,width:"1%",className:"dt-center"},{data:"page",title:"Page Name",className:"dt-left"},{data:"Permissions",title:"Permissions",defaultContent:"",className:"dt-left",width:"70%"},{data:"id",title:"",className:"dt-left",width:"1%"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"../users/admin_page.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}}]});$("#tablePagePermissions").off("click"),$("#tablePagePermissions").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/users/admin_page.php?id="+a.id)})}function ShowAdminNotifications(){var e=$("#tableNotifications").DataTable({ajax:{url:window.location.origin+"/scripts/GetAdminNotifications.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,bInfo:!0,lengthMenu:[[10,-1],[10,"All"]],bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[5,"desc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect _APICollectors_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"API CollectorsOverview",title:"rFMS-Connect _APICollectors_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"name",title:"name",className:"dt-left"},{data:"description",title:"description",className:"dt-left"},{data:"groupName",title:"group/domain",className:"dt-left"},{data:"public",render:function(e){return"1"==e?"<i class=\"far fa-check-square \"></i>":"<i class=\"far fa-square gray\"></i>"},title:"@login",visible:!0,className:"dt-center"},{data:"desktop",render:function(e){return"1"==e?"<i class=\"far fa-check-square \"></i>":"<i class=\"far fa-square gray\"></i>"},title:"@dashboard",visible:!0,className:"dt-center"},{data:"startPublish",title:"Start Publish",defaultContent:"",className:"dt-left"},{data:"endPublish",title:"End Publish",defaultContent:"",className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"notification_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}}]});$("#tableNotifications").off("click"),$("#tableNotifications").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/pages/notifications_edit.php?id="+a.id)})}function ShowUserTable(){var e=$("#tableUsers").DataTable({ajax:{url:window.location.origin+"/scripts/GetUsers.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,bLengthChange:!1,autoWidth:!1,destroy:!0,order:[[1,"asc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect  Users_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"Users Overview",title:"rFMS-Connect  Users_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"permissions",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off gray\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-center"},{data:"lname",title:"Lastname",defaultContent:"",className:"dt-left"},{data:"fname",title:"Name",defaultContent:"",className:"dt-left",width:"10%"},{data:"email",title:"e-Mail",defaultContent:"-",className:"dt-left"},{data:"CustName",title:"Group",defaultContent:"-",width:"15%"},{data:"driver_id",render:function(e){return 1<e.length?"<i class=\"fad fa-check-square rest\"></i>":"<i class=\"far fa-square gray \"></i>"},title:"Driver ",visible:!0,width:"2%",className:"dt-center"},{data:"pwa",render:function(e){return 0==e?"<i class=\"fad fa-user-shield rest\"></i> ":"<i class=\"fad fa-history text-danger\" title=\"password expired\"></i>"},title:"Password",visible:!0,width:"2%",className:"dt-center"},{data:"ucss",title:"Styling",defaultContent:""},{data:"custom1",title:"Start Page",defaultContent:""},{data:"join_date",title:"Join Date",defaultContent:"",visible:!1},{data:"last_login",title:"Last Login",defaultContent:""},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"../users/admin_user.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",mRender:function(e,a,i){return"<a href=\"../users/admin_user_delete.php?id="+i.id+"\" class=\"btn btn-default gray editor_delete\"><i class=\"fad fa-pensil\"><i></a>"}}]});$("#tableUsers").off("click"),$("#tableUsers").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/../users/admin_user.php?id="+a.id)})}function ShowVehicleRDTable(e){var a=$("#tableDamage").DataTable({ajax:{url:window.location.origin+"/scripts/GetVehicleDamages.php?id="+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!1,pageResize:!0,autoWidth:!0,destroy:!0,order:[[0,"desc"]],dom:"Bfltirp",bInfo:!1,bSort:!1,scrollCollapse:!1,scrollX:!0,deferRender:!0,searching:!1,buttons:{buttons:[]},columns:[{data:"createdDateTime",title:"registered",defaultContent:"-",className:"dt-left"},{data:"title",title:"title",defaultContent:"",className:"dt-left"},{data:"event_description",title:"event",defaultContent:"",className:"dt-left"},{data:"description",title:"description",defaultContent:"",className:"dt-left",visible:!1},{data:"status",title:"status",defaultContent:"",className:"dt-left",visible:!1},{data:"repairStatus",title:"repairstatus",defaultContent:"-",visible:!1},{data:"driver",title:"Driver",defaultContent:"<i class='far fa-square'></i>",visible:!1},{data:"id",title:"is",defaultContent:"",className:"dt-left",visible:!1},{width:"1%",mRender:function(e,a,i){return"<a href=\"../pages/pdc_edit.php?id="+i.id+"\" class=\"btn btn-default\"><i class=\"fard fa-edit\"><i></a>"}},{width:"1%",mRender:function(e,a,i){return"<a href=\"../pages/pdc_delete.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-trash-alt \"><i></a>"}}]});$("#tableDamage").off("click"),$("#tableDamage").on("click","tr",function(){var e=a.row(this).data();$(window).attr("location","/pages/pdc_edit.php?id="+e.id)})}function ShowGroupAdminTable(){var e=$("#tableGroups").DataTable({ajax:{url:window.location.origin+"/scripts/GetGroupAdmin.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect  Groups_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"Groups Overview",title:"rFMS-Connect  Groups_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print",className:"btn btn-primary btn-sm"}]},columns:[{data:"name",title:"Groupname",defaultContent:"",className:"dt-left"},{data:"accountnumber",title:"Code",defaultContent:"",className:"dt-left",width:"10%"},{data:"Country",title:"Country",defaultContent:"",className:"dt-left"},{data:"TotalDrivers",title:"Drivers",defaultContent:"",className:"dt-left"},{data:"TotalVehicles",title:"Vehicles",defaultContent:"",className:"dt-left"},{data:"Service_Homedealer",title:"Home Dealer",defaultContent:""},{data:"IsDealer",render:function(e){return 0<e?"<span><i class=\"fad fa-check rest\" ></i></span>":""},title:"Dealer",defaultContent:"",className:"dt-center",width:"3%"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"../users/admin_group.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"../users/admin_group_delete.php?id="+i.id+"\" class=\"btn btn-default\"><i class=\"fad fa-trash-alt\"><i></a>"}}]});$("#tableGroups").off("click"),$("#tableGroups").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","../users/admin_group.php?id="+a.id)})}function ShowGroupTable(){$("#tableGroups").DataTable({ajax:{url:window.location.origin+"/scripts/GetGroupAdmin.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect  Groups_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"Groups Overview",title:"rFMS-Connect  Groups_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"name",title:"Groupname",defaultContent:"",className:"dt-left"},{data:"accountnumber",title:"Code",defaultContent:"",className:"dt-left",width:"10%"},{data:"Country",title:"Country",defaultContent:"",className:"dt-left"},{data:"TotalDrivers",title:"Drivers",defaultContent:"",className:"dt-left"},{data:"TotalVehicles",title:"Vehicles",defaultContent:"",className:"dt-left"},{data:"Service_Homedealer",title:"Home Dealer",defaultContent:""},{data:"IsDealer",render:function(e){return 0<e?"<span class=\"fa-stack\"><i class=\"far fa-square fa-stack-1x gray\"></i></i><i class=\"fas fa-check fa-stack-1x\" ></i></span>":"<span class=\"fa-stack\"><i class=\"far fa-square fa-stack-1x gray\"></i></span>"},title:"Dealer?",defaultContent:"",className:"dt-right",width:"3%"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"group_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}}]})}function ShowDealerTable(){var e=$("#tableDealer").DataTable({ajax:{url:window.location.origin+"/scripts/GetDealers.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,pageResize:!0,autoWidth:!1,destroy:!0,order:[[1,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,scrollX:!0,deferRender:!0,buttons:{buttons:[{extend:"excel",title:"rFMS-Connect _Dealers_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"rFMS Reader Group overview",title:"rFMS-Connect _Dealers_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"Dealer_ID",title:"ID",defaultContent:"-",className:"dt-left",width:"2%",visible:!1},{data:"Category",title:"Category",defaultContent:"-",className:"dt-left",visible:!0},{data:"location",title:"Address",defaultContent:"-",className:"dt-left",visible:!1},{data:"name",title:"Name",defaultContent:"",className:"dt-left"},{data:"adr_address_1",title:"Address",defaultContent:"",className:"dt-left"},{data:"adr_postalcode",title:"Postal",defaultContent:"",className:"dt-left"},{data:"adr_city",title:"City",defaultContent:"",className:"dt-left"},{data:"cnt_description",title:"Country",defaultContent:"",className:"dt-left"},{data:"Dealer_Phone",title:"Phone",defaultContent:"",className:"dt-left",visible:!1},{data:"its_24hours",title:"ITS 24 hours",defaultContent:"",className:"dt-left",width:"4%",visible:!1},{data:"its_trailer",title:"ITS trailer",defaultContent:"",className:"dt-left",width:"4%",visible:!1},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"dealer_view.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}}]});$("#tableDealer").off("click"),$("#tableDealer").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/pages/dealer_view.php?id="+a.id)})}function ShowReportTable(){var e=$("#tableReport").DataTable({ajax:{url:window.location.origin+"/scripts/GetReports.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,paging:!0,pageResize:!0,autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",bInfo:!1,scrollCollapse:!0,scrollX:!0,deferRender:!0,responsive:{details:!1},buttons:{buttons:[{extend:"excel",title:"rFMS-Connect _Reports_Overview"},{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"rFMS Reader reports overview",title:"rFMS-Connect _Reports_Overview"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print"}]},columns:[{data:"status",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off grey\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right",responsivePriority:1},{data:"name",title:"ReportName",defaultContent:"-",className:"dt-left",visible:!0,responsivePriority:1},{data:"description",title:"Description",defaultContent:"-",className:"dt-left",visible:!1},{data:"owner",title:"Owner",defaultContent:"",className:"dt-left"},{data:"CustomerName",title:"Group",defaultContent:"",className:"dt-left"},{data:"ReportName",title:"Report",defaultContent:"",className:"dt-left"},{data:"extra_email",title:"receivers",defaultContent:"",className:"dt-left",visible:!1},{data:"reporting_frequency",title:"Frequency",defaultContent:"",className:"dt-left"},{data:"reporting_period",title:"Period",defaultContent:"",className:"dt-left"},{data:"lastRunDateTime",title:"Last Executed",defaultContent:"",className:"dt-left"},{data:"nextRunDateTime",title:"Planned Execution",defaultContent:"",className:"dt-left"},{data:"id",defaultContent:"",className:"dt-left",visible:!1},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"report_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"report_delete.php?id="+i.id+"\" class=\"btn text-danger\"><i class=\"fad fa-trash-alt text-danger\"><i></a>"}}]});$("#tableReport").off("click"),$("#tableReport").on("click","tr",function(){var a=e.row(this).data();$(window).attr("location","/pages/report_edit.php?id="+a.id)})}function ShowDriverActivityTable(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i={},s="",l="",d=$("#tableDriverActivity").DataTable({ajax:{url:window.location.origin+"/scripts/GetDriverActivity.php?startDate="+e+"&endDate="+a,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,scrollY:"calc(100vh - 450px)",dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!1,deferRender:!0,pageResize:!0,order:[[0,"asc"]],rowGroup:{dataSrc:"driver",startRender:function(e,a,d){var r;if(0===d)s=a,r=a,l="";else{if(!!i[s])return;1==d&&(l=a),r=s+l+a}var o=!!i[r];return e.nodes().each(function(e){e.style.display=o?"none":""}),$("<tr/>").append("<td colspan=\"8\">"+a+" ("+e.count()+")</td>").attr("data-name",r).toggleClass("collapsed",o)}},buttons:{buttons:[]},columns:[{data:"driver",title:"Driver",defaultContent:"-",className:"dt-left",visible:!1},{data:"date",title:"Date",defaultContent:"-",className:"dt-left"},{data:"customerVehicleName",title:"Vehicle!",defaultContent:" ",className:"dt-left"},{data:"LicensePlate",title:"Licenseplate",defaultContent:" ",className:"dt-left",visible:!0},{data:"amountTrips",title:"Trips",defaultContent:" ",className:"dt-right"},{data:"Distance",title:"Total Distance",defaultContent:" ",className:"dt-right"},{data:"Duration",title:"Total Duration",defaultContent:" ",className:"dt-center"},{data:"DriveTime",title:"Total DriveTime",className:"dt-center"},{data:"FuelUsed",title:"Total FuelUsed",defaultContent:" ",className:"dt-right"},{data:"FuelUsage",title:"Average FuelUsage",defaultContent:" ",className:"dt-right"}]});$("#tableDriverActivity").off("click"),$("#tableDriverActivity tbody").on("click","tr.dtrg-start",function(){var e=$(this).data("name");i[e]=!i[e],d.draw(!1)})}function ShowPDCReport(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd");$("#tableDriverActivity").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDCReport.php?startDate="+e+"&endDate="+a,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!1,dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,deferRender:!0,pageResize:!0,order:[[0,"asc"]],rowGroup:{dataSrc:"driver"},buttons:{buttons:[]},columns:[{data:"driver",title:"Driver",defaultContent:"-",className:"dt-left",visible:!1},{data:"date",title:"Date",defaultContent:"-",className:"dt-left"},{data:"customerVehicleName",title:"Vehicle",defaultContent:" ",className:"dt-left"},{data:"LicensePlate",title:"Licenseplate",defaultContent:" ",className:"dt-left",visible:!0},{data:"amountTrips",title:"Trips",defaultContent:" ",className:"dt-right"},{data:"Distance",title:"Total Distance",defaultContent:" ",className:"dt-right"},{data:"Duration",title:"Total Duration",defaultContent:" ",className:"dt-center"},{data:"DriveTime",title:"Total DriveTime",className:"dt-center"},{data:"FuelUsed",title:"Total FuelUsed",defaultContent:" ",className:"dt-right"},{data:"FuelUsage",title:"Average FuelUsage",defaultContent:" ",className:"dt-right"}]}),$("#tableReport").off("click")}function ShowReportTypes(){$("#tableReporting").DataTable({ajax:{url:window.location.origin+"/scripts/GetReportTypes.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!1,dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,deferRender:!0,pageResize:!0,order:[[0,"asc"]],buttons:{buttons:[]},columns:[{data:"name",title:"Name",className:"dt-left"},{data:"description",title:"Description",className:"dt-left"},{data:"type",title:"Type",className:"dt-left",visible:!0},{data:"orientation",render:function(e){return"L"==e?"<i class = \"far fa-rectangle-wide\"></i>":"<i class=\"far fa-rectangle-portrait\"></i>"},title:"orientation",visible:!0,width:"2%",className:"dt-center",responsivePriority:1},{data:"mailsubject",title:"subject",className:"dt-left"},{data:"colorSchema",title:"colors",className:"dt-center"},{data:"attachmentType",title:"attachement",className:"dt-center"},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"reporttype_delete.php?id="+i.id+"\" class=\"btn text-danger\"><i class=\"fad fa-trash-alt text-danger\"><i></a>"}}]}),$("#tableReporting").off("click")}function ShowReportQueries(){$("#tableReportQueries").DataTable({ajax:{url:window.location.origin+"/scripts/GetReportQueries.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!1,lengthMenu:[[5,-1],[5,"All"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,deferRender:!0,pageResize:!0,order:[[0,"asc"]],rowGroup:{dataSrc:"ReportName"},buttons:{buttons:[]},columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off grey\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right",responsivePriority:1},{data:"queryName",title:"Name",className:"dt-left"},{data:"queryDescription",title:"Description",className:"dt-left"},{data:"sequence",title:"sequence",className:"dt-left",visible:!0},{data:"Creator",title:"Created by",className:"dt-left",visible:!0},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"reportqueries_delete.php?id="+i.id+"\" class=\"btn text-danger\"><i class=\"fad fa-trash-alt text-danger\"><i></a>"}}]}),$("#tableReportQueries").off("click")}function ShowPDCTemplates(){$("#tablePDCTemp").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDCTemplates.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!0,scrollY:"calc(100vh - 550px)",dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!1,deferRender:!0,pageResize:!0,order:[[0,"asc"]],buttons:[{text:"New template",action:function(){CreateNewPDCTemplate()}}],columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off grey\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right",responsivePriority:1},{data:"templateName",title:"Name",className:"dt-left"},{data:"shortdescription",title:"Description",className:"dt-left"},{data:"CountedCat",title:"# categories",className:"dt-left"},{data:"CountedSubCat",title:"# sub categories",className:"dt-left"},{data:"CountedCheckItems",title:"# checks items",className:"dt-left"},{data:"CountedDamageItems",title:"# damage items",className:"dt-left"},{data:"group",title:"group",className:"dt-left",visible:!0},{data:"username",title:"Created by",className:"dt-left",visible:!1},{width:"1%",bSortable:!1,mRender:function(e,a,i){return!0==i.active?"<btn onclick=\"ShowTemplateExample(`"+i.id+"`);\" class=\"btn text-danger \"><i class=\"far fa-file-pdf\"></i></btn>":""}},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_template_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_temp_delete.php?id="+i.id+"\" class=\"btn \"><i class=\"fad fa-trash-alt \"><i></a>"}}]}),$("#tablePDCTemp").off("click")}function ShowPDCCat(){var e={},a="",i="",s=$("#tablePDCC").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDCCat.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!0,scrollY:"calc(100vh - 550px)",dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!1,deferRender:!0,pageResize:!0,order:[[3,"asc"]],rowGroup:{dataSrc:"templateName",startRender:function(s,l,d){var r;if(0===d)a=l,r=l,i="";else{if(!!e[a])return;1==d&&(i=l),r=a+i+l}var o=!!e[r];return s.nodes().each(function(e){e.style.display=o?"none":""}),$("<tr/>").append("<td colspan=\"8\">"+l+" ("+s.count()+")</td>").attr("data-name",r).toggleClass("collapsed",o)}},buttons:[{text:"New categorie",action:function(){CreateNewPDCCategory()}}],columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off grey\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right",responsivePriority:1},{data:"cat_name",title:"name",className:"dt-left"},{data:"cat_type",title:"type",className:"dt-left"},{data:"templateName",title:"template",className:"dt-left"},{data:"languageName",title:"language",className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_cat_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_cat_delete.php?id="+i.id+"\" class=\"btn btn-default\"><i class=\"fad fa-trash-alt \"><i></a>"}}]});$("#tablePDCC").off("click"),$("#tablePDCC tbody").on("click","tr.dtrg-start",function(){var a=$(this).data("name");e[a]=!e[a],s.draw(!1)})}function ShowPDCSubCat(){var e={},a="",i="",s=$("#tablePDCSC").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDCSubCat.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!0,scrollY:"calc(100vh - 550px)",dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!1,deferRender:!0,pageResize:!0,order:[[2,"asc"]],rowGroup:{dataSrc:["templateName","cat_name"],startRender:function(s,l,d){var r;if(0===d)a=l,r=l,i="";else{if(!!e[a])return;1==d&&(i=l),r=a+i+l}var o=!!e[r];return s.nodes().each(function(e){e.style.display=o?"none":""}),$("<tr/>").append("<td colspan=\"8\">"+l+" ("+s.count()+")</td>").attr("data-name",r).toggleClass("collapsed",o)}},buttons:[{text:"New subcategory",action:function(){CreateNewPDCSubCategory()}}],columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off grey\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right",responsivePriority:1},{data:"subcat_name",title:"name",className:"dt-left"},{data:"templateName",title:"template",className:"dt-left"},{data:"languageName",title:"language",className:"dt-left"},{data:"createdby",title:"created",className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_subcat_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_subcat_delete.php?id="+i.id+"\" class=\"btn text-danger\"><i class=\"fad fa-trash-alt text-danger\"><i></a>"}}]});$("#tablePDCSC").off("click"),$("#tablePDCSC tbody").on("click","tr.dtrg-start",function(){var a=$(this).data("name");e[a]=!e[a],s.draw(!1)})}function ShowPDCCheckItems(){var e={},a="",i="",s=$("#tablePDCCI").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDCCheckItems.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!0,dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!1,deferRender:!0,pageResize:!0,order:[[4,"asc"]],scrollY:"calc(100vh - 550px)",rowGroup:{dataSrc:["templateName","cat_name"],startRender:function(s,l,d){var r;if(0===d)a=l,r=l,i="";else{if(!!e[a])return;1==d&&(i=l),r=a+i+l}var o=!!e[r];return s.nodes().each(function(e){e.style.display=o?"none":""}),$("<tr/>").append("<td colspan=\"8\">"+l+" ("+s.count()+")</td>").attr("data-name",r).toggleClass("collapsed",o)}},buttons:[{extend:"pdf",orientation:"landscape",pageSize:"A4",messageTop:"rFMS Reader Group overview",title:"rFMS-Connect _Dealers_Overview"},{text:"New Check",action:function(){CreateNewPDCCHeckItem()}}],columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off grey\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right",responsivePriority:1},{data:"check",title:"name",className:"dt-left"},{data:"cat_name",title:"category",className:"dt-left",visible:!1},{data:"subcat_name",title:"subcategory",className:"dt-left"},{data:"templateName",title:"template",className:"dt-left",visible:!0,width:"15%"},{data:"languageName",title:"language",className:"dt-left"},{data:"createdby",title:"created",className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_checkitem_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_checkitem_delete.php?id="+i.id+"\" class=\"btn btn-default\"><i class=\"fad fa-trash-alt\"><i></a>"}}]});$("#tablePDCCI").off("click"),$("#tablePDCCI tbody").on("click","tr.dtrg-start",function(){var a=$(this).data("name");e[a]=!e[a],s.draw(!1)})}function ShowPDCPolicies(){$("#tablePDCP").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDCPolicies.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!0,scrollY:"calc(100vh - 550px)",dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!1,deferRender:!0,pageResize:!0,order:[[0,"asc"]],buttons:[{text:"New Policy",action:function(){CreateNewPDCPolicy()}}],columns:[{data:"active",render:function(e){return"1"==e?"<i class=\"fad fa-toggle-on text-success\"></i>":"<i class=\"fad fa-toggle-off\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right",responsivePriority:1},{data:"name",title:"name",className:"dt-left"},{data:"description",title:"description",className:"dt-left"},{data:"GroupName",title:"group",className:"dt-left"},{data:"time_policy_days",render:function(e){return"0"==e?"<i class=\"fad fa-toggle-off grey\"></i>":"<i class=\"fad fa-toggle-on text-success fa-fw\"></i> "+e+" days"},title:"days ",visible:!0,width:"10%",className:"dt-left",responsivePriority:2},{data:"trip_policy_count",render:function(e){return"0"==e?"<i class=\"fad fa-toggle-off grey\"></i>":"<btn class=\"fad fa-toggle-on text-success fa-fw\"></btn> "+e+" #"},title:"trips",visible:!0,width:"10%",className:"dt-left",responsivePriority:3},{data:"distance_policy_km",render:function(e){return"0"==e?"<i class=\"fad fa-toggle-off grey\"></i>":"<i class=\"fad fa-toggle-on text-success fa-fw\"></i> "+e+" km"},title:"distance ",visible:!0,width:"10%",className:"dt-left",responsivePriority:4},{data:"reportuser",title:"report to",className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_policy_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_policy_delete.php?id="+i.id+"\" class=\"btn \"><i class=\"fad fa-trash-alt \"><i></a>"}}]}),$("#tablePDCP").off("click")}function ShowPDCDamageItems(){var e={},a="",i="",s=$("#tablePDCDI").DataTable({ajax:{url:window.location.origin+"/scripts/GetPDCDamageItems.php",dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,searching:!0,scrollY:"calc(100vh - 550px)",dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!1,deferRender:!0,pageResize:!0,order:[[3,"asc"]],rowGroup:{dataSrc:["templateName","cat_name"],startRender:function(s,l,d){var r;if(0===d)a=l,r="",i="";else{if(!!e[a])return;1==d&&(i=l),r=a+i+l}var o=!!e[r];return s.nodes().each(function(e){e.style.display=o?"none":""}),$("<tr/>").append("<td colspan=\"8\">"+l+" ("+s.count()+")</td>").attr("data-name",r).toggleClass("collapsed",o)}},buttons:[{text:"New DamageItem",action:function(){CreateNewPDCDamageItem()}}],columns:[{data:"title",title:"title",className:"dt-left"},{data:"severity",title:"severity",className:"dt-left"},{data:"subcat_name",title:"subcategory",className:"dt-left"},{data:"templateName",title:"template",className:"dt-left"},{data:"languageName",title:"language",className:"dt-left"},{data:"createdby",title:"created",className:"dt-left"},{width:"1%",className:"dt-center",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_damageitem_edit.php?id="+i.id+"\" class=\"btn btn-default \"><i class=\"fad fa-edit\"></i></a>"}},{width:"1%",bSortable:!1,mRender:function(e,a,i){return"<a href=\"pdc_damageitem_delete.php?id="+i.id+"\" class=\"btn \"><i class=\"fad fa-trash-alt \"><i></a>"}}]});$("#tablePDCDI").off("click"),$("#tablePDCDI tbody").on("click","tr.dtrg-start",function(){var a=$(this).data("name");e[a]=!e[a],s.draw(!1)})}function ShowTemplateExample(e){$.ajax({url:window.location.origin+"/scripts/GetPDCTemplateExample.php?id="+e,type:"GET",dataType:"html",success:function(e){html2pdf().set({margin:4,filename:"TemplateExample.pdf",image:{type:"jpeg",quality:1},html2canvas:{scale:1},jsPDF:{unit:"mm",format:"A3",orientation:"portrait"}}).from(e).save()},error:function(){}})}function ShowPDC_registerd(e){$.ajax({url:window.location.origin+"/scripts/GetPDCRegisteredCheck.php?id="+e,type:"GET",dataType:"html",success:function(e){html2pdf().set({margin:4,filename:"TemplateExample.pdf",image:{type:"jpeg",quality:1},html2canvas:{scale:1},jsPDF:{unit:"mm",format:"A3",orientation:"portrait"}}).from(e).save()},error:function(){}})}function ShowVehicleActivityTable(e){if("undefined"==e||null==e)var a=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),i=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),s="startDate="+a+"&endDate="+i;else var s="&VIN="+e;$("#tableDriverActivity").DataTable({ajax:{url:window.location.origin+"/scripts/GetVehicleActivity.php?"+s,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,autoWidth:!1,destroy:!0,dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,deferRender:!0,pageResize:!0,order:[[0,"asc"]],rowGroup:{dataSrc:"customerVehicleName"},buttons:{buttons:[]},columns:[{data:"customerVehicleName",title:"Vehicle",defaultContent:"-",className:"dt-left",visible:!1},{data:"date",title:"Date",defaultContent:"-",className:"dt-left"},{data:"driver",title:"Driver",defaultContent:"",className:"dt-left"},{data:"amountTrips",title:"Trips",defaultContent:"",className:"dt-left"},{data:"Distance",title:"Total Distance",defaultContent:"",className:"dt-left"},{data:"Duration",title:"Total Duration",defaultContent:"",className:"dt-left"},{data:"FuelUsed",title:"Total FuelUsed",defaultContent:"",className:"dt-left"},{data:"FuelUsage",title:"Average FuelUsage",defaultContent:"",className:"dt-left"},{data:"has_PDC",title:"PDC",defaultContent:"",className:"dt-left",width:"2%"},{data:"Count_Damages",title:"Damages",defaultContent:"",className:"dt-left",width:"2%"}]});$("#tableDriverActivity").off("click")}function ShowDriverTripTable(e,a){UpdateCounter("","tableDriverTrips"),$("#tableDriverTrips").DataTable({ajax:{url:window.location.origin+"/scripts/GetDriverTrips.php?id="+a+"&date="+e,dataSrc:""},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<span class='fad fa-refresh fa-refresh-animate'></span>"},processing:!0,autoWidth:!1,destroy:!0,searching:!1,dom:"HRSQfltrp",bInfo:!0,scrollCollapse:!0,paging:!0,deferRender:!0,pageResize:!0,order:[[0,"asc"]],lengthMenu:[[5,-1],[5,"All"]],buttons:{buttons:[]},columns:[{data:"driver",title:"Driver",className:"dt-left",visible:!1},{data:"StartDate",title:"Start Trip",className:"dt-left"},{data:"customerVehicleName",title:"Vehicle",className:"dt-left",width:"25%"},{data:"Distance",title:"Distance",className:"dt-center"},{data:"DriveTime",title:"Driving",className:"dt-center"},{data:"IdleTime",title:"Idle",className:"dt-center"},{data:"PreDepIdle",title:"Pre Trip Idle",className:"dt-center"},{data:"Duration",title:"Duration",className:"dt-center",visible:!1},{data:"FuelUsed",title:"Fuel Used",className:"dt-center"},{data:"FuelUsage",title:"Fuel Usage",className:"dt-center"},{data:"EndDate",title:"End Trip",className:"dt-right"}]}),$("#tableDriverTrips").off("click")}function Check_telltale_warning(e){var a=$VehicleData.find(a=>a.VIN===e);if(null!=a){var i=!1;return"YELLOW"==a.TT_PAR_BRA&&(i=!0),"YELLOW"==a.TT_FUE_LEV&&(i=!0),"YELLOW"==a.TT_ENG_COO_TEM&&(i=!0),"YELLOW"==a.TT_ENG_MIL_IND&&(i=!0),"YELLOW"==a.TT_ENG_EMI_FAI&&(i=!0),"YELLOW"==a.TT_ENG_OIL&&(i=!0),"YELLOW"==a.TT_ADB_LEV&&(i=!0),"RED"==a.TT_PAR_BRA&&(i=!0),"RED"==a.TT_FUE_LEV&&(i=!0),"RED"==a.TT_ENG_COO_TEM&&(i=!0),"RED"==a.TT_ENG_MIL_IND&&(i=!0),"RED"==a.TT_ENG_EMI_FAI&&(i=!0),"RED"==a.TT_ENG_OIL&&(i=!0),"RED"==a.TT_ADB_LEV&&(i=!0),i}}function Count_warning(e){return $warning=0,"YELLOW"==e.TT_PAR_BRA&&$warning++,"YELLOW"==e.TT_FUE_LEV&&$warning++,"YELLOW"==e.TT_ENG_COO_TEM&&$warning++,"YELLOW"==e.TT_ENG_MIL_IND&&$warning++,"YELLOW"==e.TT_ENG_EMI_FAI&&$warning++,"YELLOW"==e.TT_ENG_OIL&&$warning++,"YELLOW"==e.TT_ADB_LEV&&$warning++,"RED"==e.TT_PAR_BRA&&$warning++,"RED"==e.TT_FUE_LEV&&$warning++,"RED"==e.TT_ENG_COO_TEM&&$warning++,"RED"==e.TT_ENG_MIL_IND&&$warning++,"RED"==e.TT_ENG_EMI_FAI&&$warning++,"RED"==e.TT_ENG_OIL&&$warning++,"RED"==e.TT_ADB_LEV&&$warning++,$warning}function PopWarning(e){return $warning="<div class=\"\"><b>","YELLOW"==e.TT_PAR_BRA&&($warning+="<div class=\"warning\"> Parking Brake </div>"),"YELLOW"==e.TT_FUE_LEV&&($warning+="<div class=\"danger\"> Fuel Level </div>"),"YELLOW"==e.TT_ENG_COO_TEM&&($warning+="<div class=\"warning\"> Engine Cooling temperature </div>"),"YELLOW"==e.TT_ENG_MIL_IND&&($warning+="<div class=\"warning\"> Engine Mil Indicator </div>"),"YELLOW"==e.TT_ENG_EMI_FAI&&($warning+="<div class=\"warning\"> Engine Emmision Failure </div>"),"YELLOW"==e.TT_ENG_OIL&&($warning+="<div class=\"warning\"> Engine Oil </div>"),"YELLOW"==e.TT_ADB_LEV&&($warning+="<div class=\"warning\"> Ad Blue Level </div>"),"RED"==e.TT_PAR_BRA&&($warning+="<div class=\"danger\"> Parking Brake </div>"),"RED"==e.TT_FUE_LEV&&($warning+="<div class=\"danger\"> Fuel level </div>"),"RED"==e.TT_ENG_COO_TEM&&($warning+="<div class=\"danger\"> Engine Cooling temperature </div>"),"RED"==e.TT_ENG_MIL_IND&&($warning+="<div class=\"danger\"> Engine Mil Indicator  </div>"),"RED"==e.TT_ENG_EMI_FAI&&($warning+="<div class=\"danger\"> Engine Emmision Failure </div>"),"RED"==e.TT_ENG_OIL&&($warning+="<div class=\"danger\"> Engine Oil </div>"),"RED"==e.TT_ADB_LEV&&($warning+="<div class=\"danger\"> Ad Blue level </div>"),$warning+="</b></div>",$warning}function ShowDBVehicleInfo(e){var a=$("#EditVehicleDetails");$.ajax({url:window.location.origin+"/scripts/GetVehicleDetails.php?vin="+e,dataType:"JSON",success:function(e){$.each(e,function(e,i){a.html(""),a.append("<div class=\"row\">\t<div class=\"card-header col-12\">\t\t<h3 class=\"primary\"><strong>"+i.customerVehicleName+" </strong> <small <small> ("+i.LicensePlate+")</small></small></h3>\t\t<div class=\"\">"+i.brand+"/ "+i.model+"("+i.Year+") </h5> \t</div>"),a.append("\t<div class=\"row p-2\"></div><div class=\"row\">\t<div class=\"col-md-12\">\t\t<div class=\"nav-tabs-custom\">\t\t\t<ul class=\"nav nav-tabs nav-fill\">\t\t\t\t<li class=\"nav-item\"><a class=\"nav-link active\" href=\"#VS\" data-toggle=\"tab\" aria-expanded=\"true\">Vehicle Status</a></li>\t\t\t\t<li class=\"nav-item\"><a class=\"nav-link\" href=\"#VSU\" data-toggle=\"tab\" aria-expanded=\"false\">Unit</a></li>\t\t\t\t<li class=\"nav-item\"><a class=\"nav-link\" href=\"#VSU\" data-toggle=\"tab\" aria-expanded=\"false\">Trips</a></li>\t\t\t</ul>\t\t\t<div class=\"tab-content\">\t\t\t\t<div class=\"tab-pane active show\" id=\"VS\"></div>\t\t\t\t<div class=\"tab-pane\" id=\"VSU\"></div>\t\t\t\t<div class=\"tab-pane\" id=\"VST\"></div>\t\t\t</div>\t\t</div>\t</div></div>"),VehicleStatus(i),VehicleUnit(i)})},error:function(){}})}function VehicleUnit(e){var a=$("#VSU");a.html(""),a.append("<div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">VIN </div><div class=\"ml-auto p-2 StatusValue\">"+e.VIN+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Unit Number</div><div class=\"ml-auto p-2 StatusValue\">"+e.OBU_Serial+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Unit Software version</div><div class=\"ml-auto p-2 StatusValue\">"+e.obu_sw_version+"</div></div>")}function VehicleStatus(e){var a=$("#VS");a.html(""),a.append("<div class=\"row\"><div class=\"col-md-4 VTMap\"><div id=\"map\"></div></div><div class=\"col-md-8\"><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Last Contact</div><div class=\"ml-auto p-2 StatusValue\">"+dateFormat(e.LastActivity,"dd-mm-yyyy HH:MM ")+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Odo-Meter</div><div class=\"ml-auto p-2 StatusValue\">"+e.OdoMeter/1e3+" km</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Service Distance</div><div class=\"ml-auto p-2 StatusValue\">"+e.serviceDistance/1e3+" km</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Total Fuel Used</div><div class=\"ml-auto p-2 StatusValue\" >"+e.TotalFuelUsed/1e3+" L </div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Total Engine hours</div><div class=\"ml-auto p-2 StatusValue\">"+e.TotalEngineHours+" hrs</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Combination Weight</div><div class=\"ml-auto p-2 StatusValue\">"+e.grossCombinationVehicleWeight+" kg</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Fuel-Level</div><div class=\"ml-auto p-2 StatusValue\">"+e.FuelLevel+" %</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">AdBlue-Level</div><div class=\"ml-auto p-2 StatusValue\">"+e.CatalystFuelLevel+" %</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Engine Coolant</div><div class=\"ml-auto p-2 StatusValue\">"+e.engineCoolantTemperature+"</b> &#x2103; </div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Brake Air Pressure</div><div class=\"ml-auto p-2 StatusValue\">"+e.serviceBrakeAirPressureCircuit1/1e5+" / "+e.serviceBrakeAirPressureCircuit2/1e5+"</b> bar</div></div>");var i=!1,s="";"RED"==e.TT_PAR_BRA&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 notice-danger \"> <div class=\"align-middle \"> Parking Brake </div></div>"),"RED"==e.TT_ADB_LEV&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 notice-danger \"> <div class=\"align-middle \"> AdBlue level </div></div>"),"RED"==e.TT_FUE_LEV&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 notice-danger \"> <div class=\"align-middle \"> Fuel Level </div></div>"),"RED"==e.TT_ENG_COO_TEM&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 notice-danger \"> <div class=\"align-middle \"> Engine Cooling </div></div>"),"RED"==e.TT_ENG_MIL_IND&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 notice-danger \"> <div class=\"align-middle \"> Engine Mil Indicator </div></div>"),"RED"==e.TT_ENG_EMI_FAI&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 notice-danger \"> <div class=\"align-middle \"> Engine Emission Failure </div></div>"),"RED"==e.TT_ENG_OIL&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 notice-danger \"> <div class=\"align-middle \"> Engine Oil </div></div>"),"YELLOW"==e.TT_PAR_BRA&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-warning \"><div class=\"align-middle \"> Parking Brake </div></div>"),"YELLOW"==e.TT_ADB_LEV&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-warning \"><div class=\"align-middle \"> AdBlue level </div></div>"),"YELLOW"==e.TT_FUE_LEV&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-warning \"><div class=\"align-middle \"> Fuel Level </div></div>"),"YELLOW"==e.TT_ENG_COO_TEM&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-warning \"><div class=\"align-middle \"> Engine Cooling </div></div>"),"YELLOW"==e.TT_ENG_MIL_IND&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-warning \"><div class=\"align-middle \"> Engine Mil Indicator </div></div>"),"YELLOW"==e.TT_ENG_EMI_FAI&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-warning \"><div class=\"align-middle \"> Engine Emission Failure </div></div>"),"YELLOW"==e.TT_ENG_OIL&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-warning \"><div class=\"align-middle \"> Engine Oil </div></div>"),"INFO"==e.TT_PAR_BRA&&(i=!0,s+="<div class=\"mr-1 notice col-6 py-2 bg-primary \"><div class=\"align-middle \"> Parking Brake </div></div>"),!0==i&&a.append("<div class=\"StatusLineHeader\"><div class=\"col-md-12 pull-left\"><b>Active text-warnings</b></div></div><div class=\"row p-2\">"+s),a.append("</div></div></div>"),!e.last_Latitude||(InitializeSimpleMAP(),LIcon=L.AwesomeMarkers.icon({icon:"asterisk",markerColor:"blue",iconSize:[35,46],iconAnchor:[17,46],tooltipAnchor:[,-62],popupAnchor:[,-62]}),rFMS_Latest.clearLayers(),L.marker([e.last_Latitude,e.last_Longitude],{icon:LIcon,draggable:!1}).addTo(rFMS_Latest),map.addLayer(rFMS_Latest),map.setView([e.last_Latitude,e.last_Longitude],8))}function DriverDetails(e){var a=$("#DD");a.html(""),a.append("<div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Home address</div><div class=\"ml-auto p-2 \">"+e.Address+" "+e.Housenumber+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\"></div><div class=\"ml-auto p-2 \">"+e.Address2+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\"></div><div class=\"ml-auto p-2 \">"+e.Zipcode+" "+e.City+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\"></div><div class=\"ml-auto p-2 StatusValue\">"+e.Country+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">E-mail address</div><div class=\"ml-auto p-2 StatusValue\"><a href=\"mailto:"+e.eMail+"\">"+e.eMail+"</a> </div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Mobile</div><div class=\"ml-auto p-2 StatusValue\" >"+e.Phone_Mobile+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Home</div><div class=\"ml-auto p-2 StatusValue\">"+e.Phone_Home+"</div></div></div></div>")}function DriverTacho(e){var a=$("#DT");a.html(""),a.append("<div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Tachograph ID</div><div class=\"ml-auto p-2 StatusValue\">"+e.tachoDriverIdentification+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Renewal date (yyyy-mm-dd)</div><div class=\"ml-auto p-2 StatusValue\">"+e.Validity+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Company Index</div><div class=\"ml-auto p-2 StatusValue\">"+e.CCIndex+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Replacement Index</div><div class=\"ml-auto p-2 StatusValue\">"+e.CReplIndex+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Renewal index</div><div class=\"ml-auto p-2 StatusValue\">"+e.CRenewIndex+"</div></div>"),a.append("<div class=\"StatusLineHeader\"><div class=\"p-2 align-middle\"><strong>Driving Status</strong></div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Remaining Today </div><div class=\"ml-auto p-2 StatusValue\">"+e.RemainingDriveToday+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Remaining Weekly </div><div class=\"ml-auto p-2 StatusValue\">"+e.RemainingDriveWeek+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Remaining Bi-weekly </div><div class=\"ml-auto p-2 StatusValue\">"+e.RemainingDriveBiWeekly+"</div></div>")}function DriveTimeMgt(e){var a=$("#DTM");a.html(""),a.append("<div class=\"DriverInfo p-2\"><div id=\"Driver1\" > - </div><div id=\"DTM1\"></div><div id=\"TripDT1\" class=\"rFMSDriverGraph \"></div></div>"),ReadDriverDetails(e.DriverId,"Driver1","DTM1","TripDT1"),ShowDriveTime(e.DriverId,"TripDT1","DTM1"),a.append("<div id=\"TripInfo\" class=\"rFMSTripInfo\"></div>"),ReadTodayDriverTrips(e,"TripInfo")}function DriverVehicle(e){var a=$("#DV");a.html(""),$.ajax({url:window.location.origin+"/scripts/GetVehicleDetails.php?vin="+e,dataType:"JSON",success:function(e){$.each(e,function(e,i){a.append("<div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Vehicle</div><div class=\"ml-auto p-2 StatusValue\">"+i.customerVehicleName+"</div></div><div class=\"d-flex StatusLine\"><div class=\"p-2 align-middle\">Customer</div><div class=\"ml-auto p-2 StatusValue\">"+i.name+"</div></div>")})},error:function(){}})}function FilterDBDelayed(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#TripReport");i.html("");var s=$("#DelayedTables");s.html("");var l=$("#GraphDelayedVehicles");l.html("");var d=$("#DelayedVehicles");d.html("");var r=$("#TitleDay");r.html(""),ShowSpinner("TripReport"),$counter=0,$vehicles=[],map.removeLayer(heat),$.ajax({url:window.location.origin+"/scripts/GetDelayedVehicles.php?StartDate="+e+"&EndDate="+a,dataType:"JSON",type:"GET",success:function(e){$.each(e,function(e,a){$vehicles.push(a)}),0<$vehicles.length?(i.html(""),i.append("<div class=\"col-12 card-title primary\">Delayed vehicles per day</div>"),ShowHeatMap($vehicles),ReadDelayedChart(),ReadTodayDelay(a),ReadDelayedVehicles(a)):(i.html(""),i.append("<div class='notice-danger' ><strong>No data found !</div>"))}})}function ShowDelayedVehicles(e){var a=$("#DelayedTables");a.html(""),$("#DelayedTables").DataTable({data:e,autoWidth:!1,destroy:!0,order:[[7,"desc"]],dom:"Bfltirp",scrollY:"45vh",bInfo:!0,scrollCollapse:!0,paging:!1,scrollX:!0,language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},buttons:{buttons:[{extend:"excel",className:"btn btn-group btn-primary btn-sm",filename:"rFMSConnect_Delayed_Vehicles"},{extend:"pdf",className:"btn btn-group btn-primary btn-sm",orientation:"landscape",pageSize:"A4",messageTop:"Delayed vehicles"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print",className:"btn btn-group btn-primary btn-sm",messageTop:"Delayed vehicles"}]},columns:[{data:"createdDate",title:"Measure Date",defaultContent:"",className:"dt-left"},{data:"customerVehicleName",title:"Name",className:"dt-left"},{data:"name",title:"Group",defaultContent:"",className:"dt-left"},{data:"vin",title:"Vin",className:"dt-left",visible:!1},{data:"add_toDB",title:"Adde_to_DB",defaultContent:"",className:"dt-left",visible:!1},{data:"obu_sw_version",title:"OBU",defaultContent:"",className:"dt-left",visible:!1},{data:"OBU_Serial",title:"OBU Serial",className:"dt-center",defaultContent:"",visible:!1},{data:"receivedDateTime",title:"first delay",className:"dt-center",defaultContent:"",visible:!1},{data:"delay",title:"delay (in min)",className:"dt-center",defaultContent:"",visible:!1},{data:"address",title:"location",className:"dt-center",defaultContent:"",visible:!1},{data:"country",title:"country",className:"dt-center",defaultContent:"",visible:!1},{data:"latitude",title:"lat",className:"dt-center",defaultContent:"",visible:!1},{data:"longitude",title:"long",className:"dt-center",defaultContent:"",visible:!1}]})}function ReadBackLogValues(){$.ajax({type:"GET",url:window.location.origin+"/data/backlog.json",dataType:"json",success:function(e){var a=new Date(e.requestTime),i=new Date(e.messageTime),s=new Date(e.receivedTime),l=(a.getTime()-s.getTime())/1e3/3600,d=(s.getTime()-i.getTime())/1e3/3600,r=$("#warningmessage");if($message="",1>d){var o=(s.getTime()-i.getTime())/1e3/60;$message+="<div class=\"info-box-number primary row\"><div class=\"col-6\">Vehicle-M2M </div><div class=\"col-6\"><i class=\"fas fa-history\"></i> "+o.toFixed(2)+"<small> minutes</small></div></div>"}else $message+="<div class=\"info-box-number text-danger row\"><div class=\"col-6\">Vehicle-M2M </div><div class=\"col-6\"><i class=\"fas fa-history\"></i> "+d.toFixed(2)+"<small> hours </small></div></div>";if(1>l){var c=(a.getTime()-s.getTime())/1e3/60;$message+="<div class=\"info-box-number primary row\"><div class=\"col-6\">M2M-API </div><div class=\"col-6\"><i class=\"fas fa-clock \"></i> "+c.toFixed(2)+"<small> minutes </small></div></div>"}else $message+="<div class=\"info-box-number text-danger row\"><div class=\"col-6\">M2M-API </div><div class=\"col-6\"><i class=\"fas fa-history \"></i> "+l.toFixed(2)+"<small> hours</small></div></div>";return r.html(""),r.append("<span><strong>"+$message+"</strong></span>"),l}})}function ShowVehicleStats(){$.ajax({url:window.location.origin+"/scripts/GetVehiclesStats.php",dataType:"JSON",success:function(e){$message="";var a=$("#statsmessage");$message+="<div class=\"primary row\"><div class=\"col-12\">Data Reliability</div>",$message+="\t\t<div class=\"col-6 grey\"><li>newest </li></div><div class=\"col-6 white\">"+e[0].D_Min+"<small> (h:m:s)</small></div>",$message+="\t\t<div class=\"col-6 grey\"><li>average</li></div><div class=\"col-6 primary\">"+e[0].D_Average+"<small> (h:m:s)</small></div>",$message+="\t\t<div class=\"col-6 grey\"><li>oldest </li></div><div class=\"col-6 white\">"+e[0].D_Max+"<small> (h:m:s)</small></div>",$message+="\t\t<div class=\"col-6 grey\"><li>Non-Communicating</li></div><div class=\"col-6 primary\">"+e[0].V_CountNC+"</div>",$message+="\t\t<div class=\"col-6 grey\"><li>Delayed</li></div><div class=\"col-6 white\">"+e[0].V_Delayed+"</div>",$message+="\t\t<div class=\"col-6 grey\"><li>Actived via API</li></div><div class=\"col-6 primary\">"+e[0].V_CountActive+"</div>",$message+="\t</div>",a.html(""),a.append($message)}})}function ShowAlertReport(){var e=$("#VehicleAlertDetails");e.html("");var e=$("#AdviseData");e.html(""),$.ajax({url:window.location.origin+"/scripts/GetVehiclesAlertsReport.php",dataType:"JSON",success:function(e){var a=[];$.each(e,function(e,i){!0==i.status.alert&&a.push(i)}),ShowAlertReportTable(a)},error:function(){e=$("#VehicleAlertTable"),e.html(""),e.append("Failed to read database")}})}function ShowAlertReportTable(e){table=$("#VehicleAlertTable").DataTable({language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},data:e,autoWidth:!1,destroy:!0,order:[[4,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,scrollX:!0,buttons:{buttons:[]},columns:[{data:"VIN",title:"",visible:!1,searchable:!0,width:"25%"},{data:"customerVehicleName",title:"Vehicle Name",className:"dt-left",width:"20%"},{data:"LastActivity",title:"Last Contact UTC",visible:!1,defaultContent:""},{data:"LastDriver",title:"Last Driver",defaultContent:"",className:"dt-left",width:"20%"},{data:"CountedWarning",title:"#",defaultContent:"",className:"dt-right",width:"5%"}]}),$("#VehicleAlertTable").off("click"),$("#VehicleAlertTable").on("click","tr",function(){var e=table.row(this).data();ShowAlertVehicleInfo(e.id)})}function ShowAlertVehicleInfo(e){$.ajax({url:window.location.origin+"/scripts/GetVehicleDetails.php?id="+e,dataType:"JSON",success:function(a){var i=L.AwesomeMarkers.icon({icon:"",markerColor:"orange",iconSize:[30,36],iconAnchor:[15,20],tooltipAnchor:[,-22],popupAnchor:[,-22]});$.each(a,function(a,s){rFMS_Latest.clearLayers(),L.marker([s.last_Latitude,s.last_Longitude],{icon:i,rotationAngle:s.last_Heading,draggable:!1}).bindTooltip("<div class=\"card-header\">"+s.customerVehicleName+"</div>",{direction:"top",opacity:1}).on("click",function(){ShowVehicleInfo(e,"a")}).addTo(rFMS_Latest),map.addLayer(rFMS_Dealers),map.addLayer(rFMS_Latest),ShowVehicleInfo(e,"a"),ShowAlertAdvise(s),ReadAlertsHistory(e),map.setView([s.last_Latitude,s.last_Longitude],7)})}})}function ShowAlertAdvise(e){var a=$("#AdviseData");a.html(""),"RED"==e.TT_PAR_BRA&&AddAdvise("TT_PAR_BRA","RED",a),"RED"==e.TT_FUE_LEV&&AddAdvise("TT_FUE_LEV","RED",a),"RED"==e.TT_ENG_OIL&&AddAdvise("TT_ENG_OIL","RED",a),"RED"==e.TT_ADB_LEV&&AddAdvise("TT_ADB_LEV","RED",a),"RED"==e.TT_ENG_COO_TEM&&AddAdvise("TT_ENG_COO_TEM","RED",a),"RED"==e.TT_ENG_MIL_IND&&AddAdvise("TT_ENG_MIL_IND","RED",a),"RED"==e.TT_ENG_EMI_FAI&&AddAdvise("TT_ENG_EMI_FAI","RED",a),"YELLOW"==e.TT_PAR_BRA&&AddAdvise("TT_PAR_BRA","YELLOW",a),"YELLOW"==e.TT_FUE_LEV&&AddAdvise("TT_FUE_LEV","YELLOW",a),"YELLOW"==e.TT_ENG_OIL&&AddAdvise("TT_ENG_OIL","YELLOW",a),"YELLOW"==e.TT_ADB_LEV&&AddAdvise("TT_ADB_LEV","YELLOW",a),"YELLOW"==e.TT_ENG_COO_TEM&&AddAdvise("TT_ENG_COO_TEM","YELLOW",a),"YELLOW"==e.TT_ENG_MIL_IND&&AddAdvise("TT_ENG_MIL_IND","YELLOW",a),"YELLOW"==e.TT_ENG_EMI_FAI&&AddAdvise("TT_ENG_EMI_FAI","YELLOW",a),"INFO"==e.TT_PAR_BRA&&AddAdvise("TT_PAR_BRA","INFO",a)}function AddAdvise(e,a,i){if("YELLOW"==a)var s="warning",l="text-warning";if("RED"==a)var s="danger",l="text-danger";if("INFO"==a)var s="primary",l="text-primary";$.ajax({url:window.location.origin+"/scripts/GetWarningAdvise.php?warning="+e+"&status="+a,dataType:"JSON",type:"GET",success:function(e){$.each(e,function(e,a){i.append("<div class=\"col-12 p-0\"><div class=\"card alert-"+s+" AdviseBox mb-2\">\t\t<div class=\"card-header "+l+"\">"+a.Description+"</div> \t\t<div class=\"card-body py-2\">"+a.Advise+" \t\t</div>\t</div></div>")})}})}function ReadAlertsHistory(e){var a=[];$.ajax({url:window.location.origin+"/scripts/GetVehicleAlerts.php?id="+e,dataType:"JSON",type:"GET",success:function(e){$.each(e,function(e,i){a.push(i)}),0<a.length&&ShowTellTaleTable(a)}})}function InitializeSimpleMAP(){HEREGrey=L.tileLayer("https://{s}.{base}.maps.cit.api.here.com/maptile/2.1/{type}/{mapID}/reduced.day/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}&ppi=320",{attribution:"<a href=\"http://developer.here.com\">HERE</a>",subdomains:"1234",mapID:"newest",app_id:"Ch87ydlyXjsmnI5AcXho",app_code:"z2HsXPK48vhNPwyfcFr5ew",base:"traffic",maxZoom:20,type:"streettile",language:"eng",format:"png8",size:"512"}),rFMS_Latest=new L.MarkerClusterGroup({spiderfyOnMaxZoom:!0,showCoverageOnHover:!1,zoomToBoundsOnClick:!0}),map=L.map("map",{center:[46,8.65],zoomSnap:.25,minZoom:2,maxZoom:20,zoom:5,fadeAnimation:!1,scrollWheelZoom:!0,dragging:!1}),map.removeControl(map.zoomControl),map.addLayer(HEREGrey)}function ReadTripCounter(e){var a=$("#"+e);$.ajax({url:window.location.origin+"/scripts/CountTodayTrips.php",dataType:"JSON",type:"GET",success:function(e){a.html(""),$.each(e,function(e,i){if(0!=i.TotTripsToday){var s=100/(i.TotDistanceToday/i.TotFuelToday),l=i.TotFuelToday/2.64,d="<div class=\"row\">";d+="\t<div class=\"col  \" title=\"average fuelusage\">",d+="\t\t<i class=\"fad fa-tint gray tiny\" ></i> "+formatNumber(round(s,1))+"<br><br><span title=\"CO2 produced\"><small>CO<sup>2</sup> - </small> "+formatNumber(round(l,0))+" <small>kg</small></span>",d+="\t</div>",d+="\t<div class=\"col text-right \">",d+="\t\t<div class=\"\" title=\"total trips\">"+formatNumber(i.TotTripsToday)+" - <i class=\"fad fa-flag-checkered fa-fw gray tiny\"></i></div>",d+="\t\t<div class=\"\" title=\"total distance (km)\">"+formatNumber(round(i.TotDistanceToday,0))+" - <i class=\"fad fa-route  fa-fw gray tiny\"></i></a></div>",d+="\t\t<div class=\"\" title=\"total fuel used (L)\">"+formatNumber(round(i.TotFuelToday,0))+" - <i class=\"fad fa-gas-pump  fa-fw gray tiny\"></i></a></div>",d+="\t</div>",d+="</div>",a.append(d)}else{var d="<div class=\"row\"><div class=\"col-12 \"><a href=\"#\" title=\"Fuel Economy l / 100km\"><i class=\"fas fa-tint \"></i> - </a></div></div>";d+="<div class=\"row\"><div class=\"col-12 text-right\">",d+="<div class=\"\"><a href=\"#\" title=\"# amount of trips\">0 - <i class=\"fas fa-flag-checkered  tiny\"></i></a></small></div>",d+="<div class=\"\"><a href=\"#\" title=\"distance in km\">0 - <i class=\"fas fa-route  tiny\"></i></small></a></div>",d+="<div class=\"\"><a href=\"#\" title=\"fuel in liters\">0 - <i class=\"fas fa-gas-pump  tiny\"></i></small></a></div></div></div>",a.append(d)}})}})}function Delayed(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#TripReport");ShowSpinnerSmall("TripReport"),$counter=0,$vehicles=[],map.removeLayer(heat),$.ajax({url:window.location.origin+"/scripts/GetDelayedVehicles.php?StartDate="+e+"&EndDate="+a,dataType:"JSON",type:"GET",success:function(e){$.each(e,function(e,a){$vehicles.push(a)}),0<$vehicles.length?(i.html(""),ShowDelayedVehicles($vehicles),ShowHeatMap($vehicles)):(i.html(""),i.append("<div class='notice-danger' ><strong>No data found !</div>"))}})}function SaveSelectedGroup_oud(){var e,a=document.getElementById("groups"),i=a.options[a.selectedIndex].value,s=a.options[a.selectedIndex].text;e=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP"),e.onreadystatechange=function(){},urlString=window.location.origin+"/users/setSessionVariable.php?choiceId="+i+"&choiceText="+s,e.open("GET",urlString,!0),e.send(),UpdateCounter(s,"CustomerName"),location.reload()}function SaveSelectedGroup(){var e=document.getElementById("groups"),a=e.options[e.selectedIndex].value,i=e.options[e.selectedIndex].text;$.ajax({url:window.location.origin+"/users/setSessionVariable.php?choiceId="+a+"&choiceText="+i,dataType:"JSON",type:"POST",success:function(){UpdateCounter(i,"Groups")}}),wait(200)}function FleetUtil(){ShowPlaceholder("FleetUtilReport","graph"),ShowPlaceholder("FleetmodelChart","graph"),ShowPlaceholder("FleetTripReport","graph"),ShowPlaceholder("FleetFuelReport","graph"),ShowPlaceholder("FleetTripTable","table"),ShowPlaceholder("FleetSumReport","sumreport"),FleetUtilData(),ShowFleetTable(),ReadFleetmodels(),FleetTripData(),ReadFleetTable()}function FleetUtilData(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#FleetUtilReport"),s=[],l=[];$.ajax({url:window.location.origin+"/scripts/CustomerVehicleCountPerDay.php?StartDate="+e+"&EndDate="+a,dataType:"JSON",type:"POST",success:function(e){$.each(e,function(e,a){a.TotalGroup===void 0?(s.push([new Date(a.createDate),parseFloat(a.Total)]),l.push([new Date(a.createDate),0])):(s.push([new Date(a.createDate),parseFloat(a.Total)]),l.push([new Date(a.createDate),parseFloat(a.TotalGroup)]))}),FleetUtilChart(s,l)},error:function(){i.html(""),i.append("<i class='fas fa-exclamation text-danger'> error searching data</i>")}})}function FleetTripData(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#FleetTripReport"),s=$("#FleetFuelReport"),l=$("#FleetSumReport"),d=[],r=[],o=[],c=[],n=[],p=0,m=0;$TCO2=0;var f=0;$TFE=0,$counter=0,$Str="";var v=parseInt((new Date(document.getElementById("SelectDateEnd").value)-new Date(document.getElementById("SelectDate").value))/86400000+1,10);$.ajax({url:window.location.origin+"/scripts/CustomerTripCountPerDay.php?StartDate="+e+"&EndDate="+a,dataType:"JSON",type:"POST",success:function(e){$.each(e,function(e,a){d.push([new Date(a.Date),parseFloat(a.Total)]),f+=parseFloat(a.Total),r.push([new Date(a.Date),parseFloat(a.Distance)]),m+=parseFloat(a.Distance),o.push([new Date(a.Date),parseFloat(a.Fuelused)]),p+=parseFloat(a.Fuelused),$FuelUsage=100/(a.Distance/a.Fuelused),c.push([new Date(a.Date),parseFloat($FuelUsage.toFixed(2))]),$TFE+=parseFloat($FuelUsage),$CO2=2.64*a.Fuelused,n.push([new Date(a.Date),parseFloat($CO2.toFixed(2))]),$TCO2+=parseFloat($CO2),$counter++}),$TFE=parseFloat($FuelUsage),FleetTripChart(d,r,n),FleetFuelChart(o,c,n),l.html(""),$Str+="<div class=\"form-group col-xl-2 col-lg-4 col-6 \"><div class=\"trips p-2\">\t\t<span><small>Trips</small>\t</span></br><span class=\"info-box-number\">"+formatNumber(f)+"</span></div></div>",$Str+="<div class=\"form-group col-xl-2 col-lg-4 col-6 \"><div class=\"distance p-2\">\t<span><small>Distance </small></span></br><span class=\"info-box-number\">"+formatNumber(m.toFixed(0))+"</b> <small>km</small></div></div>",$Str+="<div class=\"form-group col-xl-2 col-lg-4 col-6 \"><div class=\"fuelused p-2\">\t<span><small>Fuel used </small></span></br><span class=\"info-box-number\">"+formatNumber(p.toFixed(0))+"</b> <small>L</small></div></div>",$Str+="<div class=\"form-group col-xl-2 col-lg-4 col-6 \"><div class=\"fuelusage p-2\">\t<span><small>Fuel Economy </small></span></br><span class=\"info-box-number\">"+formatNumber($TFE.toFixed(2))+" </b> <small>L/100km</small></div></div>",$Str+="<div class=\"form-group col-xl-2 col-lg-4 col-6 \"><div class=\"co2 p-2\">\t\t<span><small>CO2 </small></span></br><span class=\"info-box-number\">"+formatNumber($TCO2.toFixed(0))+"</b> <small>kg</small></div></div>",$Str+="<div class=\"form-group col-xl-2 col-lg-4 col-6 \"><div class=\"days p-2\">\t\t<span><small>Days </small></span></br><span class=\"info-box-number\">"+v+"</b></div></div>",l.append($Str)},error:function(){i.html(""),i.append("<i class='fas fa-exclamation text-danger'> error searching data</i>"),s.html(""),s.append("<i class='fas fa-exclamation text-danger'> error searching data</i> ")}})}function FleetUtilChart(e,a){Highcharts.chart("FleetUtilReport",{chart:{zoomType:"x",marginTop:40,marginLeft:10,marginRight:10,styledMode:!0},title:{text:"Number of vehicles per day",margin:0,style:{color:"#ddd",fontSize:".6rem",fontWeight:"bold"}},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"<b>%e-%b</b>"},title:{text:""},tickInterval:864e5,units:[["week",[1]]],labels:{autoRotation:[-30,-40]}},yAxis:[{title:{text:"vehicles"},min:1,visible:!0},{title:{text:""},min:0,visible:!1,linkedTo:0}],tooltip:{headerFormat:"",pointFormat:"<span style=\"color:{series.color}\">{series.name} </br><b>{point.y}</b></span>",crosshairs:!1,useHTML:!0,shared:!0},plotOptions:{column:{pointPadding:5,pointWidth:10,borderWidth:0},spline:{marker:{enabled:!0}},series:{turboThreshold:1,animation:!0,lineWidth:3}},credits:{enabled:!1},legend:{enabled:!1},series:[{name:"Total Vehicles",yAxis:0,data:a,type:"column"},{name:"Active Vehicles",yAxis:1,data:e,type:"spline",lineWidth:3}]})}function FleetTripChart(e,a,i){Highcharts.chart("FleetTripReport",{chart:{zoomType:"x",marginTop:40,marginLeft:10,marginRight:10,styledMode:!0},title:{text:"Number of Trips, CO2 & Distance per day",margin:0},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"<b>%e-%b</b>"},title:{text:""},tickInterval:864e5,units:[["week",[1]]],labels:{autoRotation:[-30,-40]}},yAxis:[{min:1,visible:!0},{min:1,visible:!1},{min:1,visible:!1}],tooltip:{headerFormat:"",pointFormat:"<span style=\"color:{series.color}\">{series.name} </br><b>{point.y}</b></span>",crosshairs:!0,useHTML:!0,shared:!0},plotOptions:{column:{pointPadding:5,pointWidth:10,borderWidth:0},spline:{marker:{enabled:!0}},series:{turboThreshold:1,animation:!0}},credits:{enabled:!1},legend:{enabled:!1},series:[{name:"Trips",yAxis:0,data:e,type:"column"},{name:"Distance (km)",yAxis:1,data:a,type:"spline",lineWidth:4},{name:"CO2 (tons)",yAxis:2,data:i,type:"spline",lineWidth:4}]})}function FleetFuelChart(e,a,i){Highcharts.chart("FleetFuelReport",{chart:{zoomType:"x",marginTop:40,marginLeft:10,marginRight:10,styledMode:!0},title:{text:"Fleet Fuelused, CO2 & Fuel Economy per day",margin:0},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"<b>%e-%b</b>"},title:{text:""},tickInterval:864e5,units:[["week",[1]]],labels:{autoRotation:[-30,-40]}},yAxis:[{min:0,visible:!0},{min:0,visible:!1},{min:0,visible:!1}],tooltip:{headerFormat:"",pointFormat:"<span style=\"color:{series.color}\">{series.name} </span></br><b>{point.y}</b><br/>{series.label}",crosshairs:!0,useHTML:!0,shared:!1},plotOptions:{column:{pointPadding:5,pointWidth:10,borderWidth:0},spline:{marker:{enabled:!0}},series:{turboThreshold:1,animation:!0}},credits:{enabled:!1},legend:{enabled:!1},series:[{name:"Fuel Used",yAxis:0,data:e,type:"column"},{name:"Fuel Usage",yAxis:1,data:a,type:"spline",lineWidth:4},{name:"CO2 (tons)",yAxis:2,data:i,type:"spline",lineWidth:4}]})}function FleetmodelChart(e){Highcharts.chart("FleetmodelChart",{chart:{type:"pie",zoomType:"x",marginTop:50,marginLeft:40,marginRight:40,styledMode:!0},title:{text:"Vehicle models ",margin:0},xAxis:{type:"category",title:{text:""},labels:{autoRotation:[-30,-40]}},yAxis:{title:{text:""},min:0,visible:!1},tooltip:{headerFormat:"",pointFormat:"<span style=\"color:{series.color}\">{point.name} </span></br><b>{point.y}</b><br/>",crosshairs:!1,useHTML:!0,shared:!0},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",dataLabels:{enabled:!0,format:"<b>{point.name}</b>: {point.percentage:.1f} %"}},series:{turboThreshold:1,animation:!1,fillColor:"#ddd"}},colors:["#058DC7","#50B432","#ED561B","#DDDF00","#24CBE5","#64E572","#FF9655","#FFF263","#6AF9C4"],credits:{enabled:!1},legend:{enabled:!1},series:[{name:"Count of vehicles per model",data:e}]})}function ReadFleetTable(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#FleetTripTable");$.ajax({url:window.location.origin+"/scripts/GetTripSummary.php?StartDate="+e+"&EndDate="+a,dataType:"JSON",type:"POST",success:function(e){UpdateCounter("","FleetTripTable"),i.append("<table class=\"display table noWrap\" id=\"FleetVehicleReport\"></table>"),ShowFleetTable(e)},error:function(){i.html(""),i.append("<i class='fas fa-exclamation text-danger'> error searching data</i>")}})}function ShowFleetTable(e){var a=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),i=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd");table=$("#FleetVehicleReport").DataTable({data:e,autoWidth:!1,language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},destroy:!0,lengthMenu:[[8,75,200,-1],[8,75,200,"All"]],dom:"Bfltirp",searching:!0,scrollCollapse:!0,paging:!0,scrollX:!0,buttons:{buttons:[{extend:"excel",filename:"rFMSReader_FleetReport"},{extend:"pdf",orientation:"portrait",pageSize:"A4",messageTop:"Trip-data for selected Group"},{extend:"csv",extension:".csv",fieldSeparator:";"},{extend:"print",messageTop:"Trip-data for selected group "}]},columns:[{data:"customerVehicleName",title:"Vehicle",className:"dt-left"},{data:"amountTrips",title:"Trips",className:"dt-right"},{data:"Duration",title:"Duration",className:"dt-center"},{data:"Distance",title:"Distance",className:"dt-center"},{data:"FuelUsed",title:"Fuelused",className:"dt-center"},{data:"FuelUsage",title:"Fuelusage",className:"dt-center"},{data:"DriveTime",title:"DriveTime",className:"dt-center"},{data:"CO2_emission",title:"Co2",className:"dt-center"}]})}function ReadFleetmodels(){var e=$("#FleetmodelChart"),a=[];$.ajax({url:window.location.origin+"/scripts/CustomermodelsFleet.php",dataType:"JSON",type:"POST",success:function(e){$.each(e,function(e,i){a.push([i.model,parseFloat(i.TotalPermodel)])}),FleetmodelChart(a)},error:function(){e.html(""),e.append("<i class='fas fa-exclamation text-danger'> error searching data</i>")}})}function ShowDriveTime(e,a,i,s){UpdateCounter("",a),UpdateCounter("",i),null==s&&(s=new Date().format("yyyy-mm-dd")),$.ajax({url:window.location.origin+"/scripts/GetDriveTime.php?id="+e+"&date="+s,dataType:"JSON",type:"GET",success:function(e){DriveTime(e,a,i)}})}function ShowTripDriveTime(e,a){UpdateCounter("",a);for(var i=[],s=0;s<e.length;++s)""!=e[s].driver1Id_WSC&&($DriverData={workingstate:e[s].driver1Id_WSC,createdDateTime:e[s].createdDateTime},i.push($DriverData));DriveTime(i,a)}function setTTColor(e){return $color="6","YELLOW"==e&&($color="#ffc107"),"INFO"==e&&($color="#efefef"),"OFF"==e&&($color="transparent"),"RED"==e&&($color="#FF0000"),"DRIVE"==e&&($color="0"),"WORK"==e&&($color="1"),"REST"==e&&($color="2"),"DRIVER_AVAILABLE"==e&&($color="10"),"NOT_AVAILABLE"==e&&($color="transparent"),$color}function DriveTime(e,a,i){for(var s={REST:0,DRIVE:0,WORK:0,DRIVER_AVAILABLE:0},l=[],d=3,r="",o={x:Date.parse(e[0].createdDateTime+" UTC"),x2:"",y:d,diff:0,status:e[0].workingstate,pointWidth:"8",colorIndex:"2"},c=0;c<e.length;++c){"NOT_AVAILABLE"==e[c].workingstate&&(e[c].workingstate="REST");var n=e[c].workingstate;o.status!=n&&(o.x2=Date.parse(e[c].createdDateTime+" UTC"),o.diff=o.x2-o.x,o.y=d,l.push(o),"REST"==n&&(d=3,r="2"),"DRIVE"==n&&(d=0,r="0"),"WORK"==n&&(d=1,r="1"),"DRIVER_AVAILABLE"==n&&(d=2,r="10"),s[o.status]+=o.diff,o={x:Date.parse(e[c].createdDateTime+" UTC"),x2:"",y:d,diff:0,status:n,pointWidth:"8",colorIndex:r})}o.x2=Date.parse(e[e.length-1].createdDateTime+" UTC"),o.diff=o.x2-o.x,l.push(o),s[o.status]+=o.diff;var p="<div class=\"d-flex text-primary mt-2 small \"><div class=\"p-auto mr-1 col border\"><i class=\"fad fa-user-circle drive\">\t</i> "+dateFormat(new Date(s.DRIVE),"UTC:HH:MM")+"</></div><div class=\"p-auto mr-1 col border\"><i class=\"fad fa-tools work\">\t\t \t</i> "+dateFormat(new Date(s.WORK),"UTC:HH:MM")+"</div>";p+="<div class=\"p-auto mr-1 col border\"><i class=\"fad fa-square available\"></i> "+dateFormat(new Date(s.DRIVER_AVAILABLE),"UTC:HH:MM")+"</div>",p+="<div class=\"p-auto col border\"><i class=\"fad fa-bed rest\"> \t\t\t</i> "+dateFormat(new Date(s.REST),"UTC:HH:MM")+"</div>",UpdateCounter(p,i);var m=e[0].DriverId,f=Math.abs(324e5-s.DRIVE);return f=dateFormat(new Date(f),"UTC:HH:MM:ss"),UpdateCounter(f,"DR_"+m),Highcharts.chart(a,{chart:{type:"xrange",zoomType:"x",marginLeft:30,marginRight:0,marginBottom:20,marginTop:10,spacingBottom:50,spacingTop:20,spacingLeft:10,spacingRight:10,animation:!0,styledMode:!0},title:{text:"",margin:20,style:{color:"#888",fontWeight:"normal"}},xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H"},title:{text:""},tickInterval:72e5,labels:{autoRotation:[-0,-0],overflow:"justify"}},yAxis:{visible:!0,maxPadding:2,categories:["D","W","A","R"],reversed:!0},tooltip:{xDateFormat:"%H:%M:%S",headerFormat:"<small>( {point.x:%H:%M} - {point.x2:%H:%M} )</small> ",pointFormat:" </br>{point.status}: for <b> {point.diff:%H:%M:%S}</b> ",footerFormat:"",crosshairs:!1,shared:!0,useHTML:!1,backgroundColor:"transparent",borderWidth:0,padding:3,shadow:!0},plotOptions:{series:{animation:!1}},credits:{enabled:!1},legend:{enabled:!1},series:[{borderRadius:5,borderWidth:0,pointWidth:25,data:l}]}),s}function InitializeHeatMAP(){map=L.map("map",{center:[46,8.65],zoomSnap:.25,minZoom:2,maxZoom:18,zoom:4,fadeAnimation:!1}),HERE=L.tileLayer("https://{s}.{base}.maps.cit.api.here.com/maptile/2.1/{type}/{mapID}/normal.traffic.day/{z}/{x}/{y}/{size}/{format}?app_id={app_id}&app_code={app_code}&lg={language}",{attribution:"Map <a href=\"http://developer.here.com\">HERE</a>",subdomains:"1234",mapID:"newest",app_id:"Ch87ydlyXjsmnI5AcXho",app_code:"z2HsXPK48vhNPwyfcFr5ew",base:"traffic",maxZoom:20,type:"traffictile",language:"eng",format:"png8",size:"256",reuseTiles:!0,unloadInvisibleTiles:!1}).addTo(map)}function ShowHeatMap(e){e=e.map(function(e){return[e.latitude,e.longitude]}),heat=L.heatLayer(e).addTo(map)}function ReadDelayedChart(){var e=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),a=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),i=$("#GraphDelayedVehicles");i.html(""),ShowSpinnerSmall("DelayedVehicles");var s=$("#DelayedVehicles");s.html(""),dataPoints=[],$.ajax({url:window.location.origin+"/scripts/GetCountDelayedVehicles.php?StartDate="+e+"&EndDate="+a,dataType:"JSON",type:"GET",success:function(e){$.each(e,function(e,a){dataPoints.push([new Date(a.createdDate),parseFloat(a.CountVin)])}),ShowDelayedChart(dataPoints)}})}function ShowDelayedChart(e){Highcharts.chart("GraphDelayedVehicles",{chart:{zoomType:"x",marginTop:0,marginLeft:10,marginRight:40,backgroundColor:"rgba(255, 255, 255, 0.0)"},title:{text:"",margin:0,style:{fontSize:"13px",fontWeight:"normal"}},xAxis:{type:"datetime",dateTimeLabelFormats:{day:"<b>%e-%b</b>"},title:{text:""},tickInterval:864e5,labels:{autoRotation:[-30,-40]}},yAxis:{min:0,opposite:!0,title:{text:"# vehicles"}},tooltip:{headerFormat:"",pointFormat:"<span style=\"color:{series.color}\">{series.name} </span></br><b>{point.y}</b><br/>{series.label}",crosshairs:!1,useHTML:!0,shared:!0},plotOptions:{column:{pointPadding:5,pointWidth:10,borderWidth:0},series:{turboThreshold:1,animation:!0,dataLabels:{enabled:!0,rotation:315,x:10,y:-20},point:{events:{click:function(){ReadTodayDelay(this.x),ReadDelayedVehicles(this.x)}}}}},credits:{enabled:!1},legend:{enabled:!1},series:[{name:"Count of delayed Vehciles per day",data:e,type:"column"}]})}function ShowTermsTxt(){$.ajax({url:window.location.origin+"/users/licenses/terms.txt",dataType:"TEXT",success:function(e){$("#TermsAndConditions").modal("show");var a=$("#TermsAndConditionsText");a.html(""),a.append(e)},error:function(){}})}function DriverUtil(){var e=$("#DriveTimeTable"),a=document.getElementById("drivers").value,i=new Date(document.getElementById("SelectDate").value).format("yyyy-mm-dd"),s=new Date(document.getElementById("SelectDateEnd").value).format("yyyy-mm-dd");GetDriveTime(a)}function DriverUtil_oud(){var e=$("#DriveTimeGraph"),a=$("#DriveTimeTable"),i=$("#SumReport"),s=document.getElementById("drivers").value,l=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),d=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),r=[];a.html(""),i.html(""),ShowSpinner("DriveTimeGraph");var o=0;$.ajax({url:window.location.origin+"/scripts/GetBiWDriveTime.php?id="+s+"&StartDate="+l+"&EndDate="+d,dataType:"JSON",success:function(a){e.html("");for(var i,s=[],d=dateFormat(new Date(l),"yyyy-mm-dd"),c=0;c<a.length;++c)if(i=dateFormat(new Date(a[c].createdDateTime),"yyyy-mm-dd"),i==d)s.push(a[c]);else{var n="DTMGraph"+o.toString(),p="DTMSum"+o.toString();e.append("<div class=\"row\"><div class=\"col-12 StatusLine rFMSDriverGraph\" id=\""+n+"\"></div></div>"),r.push(ReportDriveTime(s,n,p));var s=[];s.push(a[c]),d=new Date(d),o++,d.setDate(d.getDate()+1),d=dateFormat(new Date(d),"yyyy-mm-dd")}var n="DTMGraph"+o.toString(),p="DTMSum"+o.toString();e.append("<div class=\"row\"><div class=\"col-12 StatusLine rFMSDriverGraph\" id=\""+n+"\"></div></div>"),ShowDTTable(r,"SumReport")},error:function(){e.html(""),e.append("<span class=\"bg-danger\">Failed to retrieve data from webservice, please contact your application administrator</span>")}})}function ReadDTTable(e){var a=$("#DriveTimeTable"),i=[];a.html("");var s=moment().subtract(6,"days").toDate(),l=moment().toDate();ShowSpinner("DriveTimeGraph");var d=0;$.ajax({url:window.location.origin+"/scripts/GetBiWDriveTime.php?id="+e+"&StartDate="+s.format("yyyy/mm/dd")+"&EndDate="+l.format("yyyy/mm/dd"),dataType:"JSON",success:function(e){a.html("");for(var l,r=[],o=dateFormat(new Date(s),"yyyy-mm-dd"),c=0;c<e.length;++c)if(l=dateFormat(new Date(e[c].createdDateTime),"yyyy-mm-dd"),l==o)r.push(e[c]);else{var n="DTMGraph"+d.toString(),p="DTMSum"+d.toString();i.push(ShowDrivingTime(r,n,p));var r=[];r.push(e[c]),o=new Date(o),d++,o.setDate(o.getDate()+1),o=dateFormat(new Date(o),"yyyy-mm-dd")}var n="DTMGraph"+d.toString(),p="DTMSum"+d.toString();i.push(ShowDrivingTime(r,n,p)),ShowDTTable(i,"SumReport")},error:function(){a.html(""),a.append("<span class=\"bg-danger\">Failed to retrieve data from webservice, please contact your application administrator</span>")}})}function ReportDriveTime(a,i){var s=a.length-1,l=new Date(a[0].createdDateTime),d=new Date(a[s].createdDateTime);l.setHours(0,0,0,0),d.setHours(23,59,59);var r={Date:Date.parse(l+"UTC"),REST:0,DRIVE:0,WORK:0,DRIVER_AVAILABLE:0},o=[],c={x:Date.parse(l+"UTC"),x2:Date.parse(d+"UTC"),y:0,diff:0,status:"REST",Driver:"",colorIndex:"6",pointWidth:"15"};o.push(c),c={x:Date.parse(l+"UTC"),x2:"",y:0,diff:0,status:"REST",Driver:"",colorIndex:"6",pointWidth:"15"};for(var n=0;n<a.length;++n){"NOT_AVAILABLE"==a[n].workingstate&&(a[n].workingstate="REST");var p=a[n].workingstate,m=dateFormat(new Date(a[n].createdDateTime),"yyyy-mm-dd");if(c.status!=p){if(c.x2=Date.parse(a[n].createdDateTime),c.diff=c.x2-c.x,c.y=0,o.push(c),r[c.status]+=c.diff,"REST"==p)var f="15";else var f="25";c={x:Date.parse(a[n].createdDateTime),x2:"",y:0,diff:0,status:p,pointWidth:f,colorIndex:setTTColor(p)}}}var v=dateFormat(new Date,"yyyy-mm-dd"),u=dateFormat(new Date(a[s].createdDateTime),"yyyy-mm-dd");if(v==u)var d=new Date(a[s].createdDateTime);c.x2=Date.parse(d+"UTC"),c.diff=c.x2-c.x,c.y=0,o.push(c),r[c.status]+=c.diff;var g="<div class=\"row \"><div class=\"col-12 col-md-3 primary d-flex align-items-center\"><B>"+dateFormat(new Date(d),"UTC:dddd yyyy-mm-dd")+"</b></div><div class=\"col-3 col-md-2\"><i class=\"far fa-user-circle drive\"></i> <b>"+dateFormat(new Date(r.DRIVE),"UTC:HH:MM:ss")+"</b></div><div class=\"col-3 col-md-2\"><i class=\"fas fa-tools work\"> \t  </i> <b>"+dateFormat(new Date(r.WORK),"UTC:HH:MM:ss")+"</b></div>";return g+="<div class=\"col-3 col-md-2\"><i class=\"far fa-square available\"> </i> <b>"+dateFormat(new Date(r.DRIVER_AVAILABLE),"UTC:HH:MM:ss")+"</b></div>",g+="<div class=\"col-3 col-md-2\"><i class=\"fas fa-bed rest\"> \t\t  </i> <b>"+dateFormat(new Date(r.REST),"UTC:HH:MM:ss")+"</b></div>",g+="<div class=\"col-3 col-md-2\"><i class=\"fas fa-bed rest\"> \t\t  </i> <b>"+dateFormat(new Date(r.REST),"UTC:HH:MM:ss")+"</b></div>",Highcharts.chart(i,{chart:{type:"xrange",zoomType:"x",marginLeft:10,marginRight:0,marginBottom:45,spacingBottom:-20,spacingTop:-10,spacingLeft:10,spacingRight:10,animation:!1},title:{text:"",margin:0,style:{color:"#888",fontSize:"15px",fontWeight:"normal"}},xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H"},title:{text:""},tickInterval:72e5,labels:{autoRotation:[-30,-40],overflow:"justify"}},yAxis:{visible:!1,maxPadding:2,categories:""},tooltip:{xDateFormat:"%H:%M:%S",headerFormat:"<span style=\"color:{series.colorIndex}\">{point.x} - {point.x2}</span> ",pointFormat:"<span style=\"color:{series.colorIndex}\"><br/> <b>{point.status}</b> {point.diff:%H:%M:%S}</span>",crosshairs:!0,shared:!0},plotOptions:{series:{animation:!1}},credits:{enabled:!1},legend:{enabled:!1},series:[{borderRadius:0,borderWidth:0,pointWidth:25,data:o,turboThreshold:0,colorIndex:"1"}]}),r}function ShowDrivingTime(a){var i=a.length-1,s=new Date(a[0].createdDateTime),l=new Date(a[i].createdDateTime);s.setHours(0,0,0,0),l.setHours(23,59,59);var d={Date:Date.parse(s+"UTC"),REST:0,DRIVE:0,WORK:0,DRIVER_AVAILABLE:0},r=[],o={x:Date.parse(s+"UTC"),x2:Date.parse(l+"UTC"),y:0,diff:0,status:"REST",Driver:"",colorIndex:"6",pointWidth:"15"};r.push(o),o={x:Date.parse(s+"UTC"),x2:"",y:0,diff:0,status:"REST",Driver:"",colorIndex:"6",pointWidth:"15"};for(var c=0;c<a.length;++c){"NOT_AVAILABLE"==a[c].workingstate&&(a[c].workingstate="REST");var n=a[c].workingstate,p=dateFormat(new Date(a[c].createdDateTime),"yyyy-mm-dd");if(o.status!=n){if(o.x2=Date.parse(a[c].createdDateTime),o.diff=o.x2-o.x,o.y=0,r.push(o),d[o.status]+=o.diff,"REST"==n)var m="15";else var m="25";o={x:Date.parse(a[c].createdDateTime),x2:"",y:0,diff:0,status:n,pointWidth:m,colorIndex:setTTColor(n)}}}var f=dateFormat(new Date,"yyyy-mm-dd"),v=dateFormat(new Date(a[i].createdDateTime),"yyyy-mm-dd");if(f==v)var l=new Date(a[i].createdDateTime);o.x2=Date.parse(l+"UTC"),o.diff=o.x2-o.x,o.y=0,r.push(o),d[o.status]+=o.diff;var u="<div class=\"row \"><div class=\"col-12 col-md-3 primary d-flex align-items-center\"><B>"+dateFormat(new Date(l),"UTC:dddd yyyy-mm-dd")+"</b></div><div class=\"col-3 col-md-2\"><i class=\"far fa-user-circle drive\"></i> <b>"+dateFormat(new Date(d.DRIVE),"UTC:HH:MM:ss")+"</b></div><div class=\"col-3 col-md-2\"><i class=\"fas fa-tools work\"> \t  </i> <b>"+dateFormat(new Date(d.WORK),"UTC:HH:MM:ss")+"</b></div>";return u+="<div class=\"col-3 col-md-2\"><i class=\"far fa-square available\"> </i> <b>"+dateFormat(new Date(d.DRIVER_AVAILABLE),"UTC:HH:MM:ss")+"</b></div>",u+="<div class=\"col-3 col-md-2\"><i class=\"fas fa-bed rest\"> \t\t  </i> <b>"+dateFormat(new Date(d.REST),"UTC:HH:MM:ss")+"</b></div>",d}function ShowDTTable(e,a){var i={REST:0,DRIVE:0,WORK:0,DRIVER_AVAILABLE:0,EXTRATIME:0,SHORTREST:0,INFRIGMENT:0},s=$("#"+a);$Str="";for(var l=0;l<e.length;++l)e[l].Date=dateFormat(e[l].Date,"ddd yyyy-mm-dd"),i.DRIVER_AVAILABLE+=e[l].DRIVER_AVAILABLE,i.WORK+=e[l].WORK,i.REST+=e[l].REST,i.DRIVE+=e[l].DRIVE,324e5<e[l].DRIVE&&e[l].EXTRATIME++,396e5>e[l].REST&&e[l].SHORTREST++,36e6<e[l].DRIVE&&e[l].INFRIGMENT++,324e5>e[l].REST&&e[l].INFRIGMENT++,e[l].DRIVER_AVAILABLE=dateFormat(new Date(e[l].DRIVER_AVAILABLE),"UTC:HH:MM"),e[l].WORK=dateFormat(new Date(e[l].WORK),"UTC:HH:MM"),e[l].REST=dateFormat(new Date(e[l].REST),"UTC:HH:MM"),e[l].DRIVE=dateFormat(new Date(e[l].DRIVE),"UTC:HH:MM");table=$("#DriveTimeTable").DataTable({data:e,autoWidth:!1,createdRow:function(e,a){0!=TimeToSeconds(a.DRIVE)&&$("td:eq(1)",e).addClass("cell_bold"),0!=TimeToSeconds(a.WORK)&&$("td:eq(2)",e).addClass("cell_bold"),0!=TimeToSeconds(a.DRIVER_AVAILABLE)&&$("td:eq(3)",e).addClass("cell_bold"),0!=TimeToSeconds(a.REST)&&$("td:eq(4)",e).addClass("cell_bold"),540<TimeToSeconds(a.DRIVE)&&$("td:eq(1)",e).addClass("cell_warning"),600<TimeToSeconds(a.DRIVE)&&$("td:eq(1)",e).addClass("cell_danger"),540>TimeToSeconds(a.REST)&&$("td:eq(4)",e).addClass("cell_danger")},destroy:!0,order:[[0,"asc"]],lengthMenu:[[14,-1],[14,"All"]],dom:"Bftirp",searching:!1,ordering:!1,footer:!1,scrollCollapse:!0,paging:!1,scrollX:!0,buttons:{buttons:[]},columns:[{data:"Date",title:"Date",className:"dt-left"},{data:"DRIVE",title:"Drive",className:"dt-right"},{data:"WORK",title:"Work",className:"dt-right"},{data:"DRIVER_AVAILABLE",title:"Available",className:"dt-right"},{data:"REST",title:"Rest",className:"dt-right"},{data:"COMP",render:function(e){return"1"==e?"<i class=\"fas fa-circle rest\"></i>":"<i class=\"far fa-circle gray\"></i>"},title:"Compliant",visible:!0,className:"dt-center"},{data:"EXTRATIME",render:function(e){return"1"==e?"<i class=\"fas fa-circle text-warning\"></i>":"<i class=\"far fa-circle gray\"></i>"},title:"Extra",visible:!0,className:"dt-center"},{data:"SHORTREST",render:function(e){return"1"==e?"<i class=\"fas fa-circle text-warning\"></i>":"<i class=\"far fa-circle gray\"></i>"},title:"Short",visible:!0,className:"dt-center"},{data:"INFRIGMENT",render:function(e){return"1"==e?"<i class=\"fas fa-circle text-danger\"></i>":"<i class=\"far fa-circle gray\"></i>"},title:"",visible:!0,className:"dt-center"}]}),s.html(""),$Str+="<div class=\"row pt-2\">",$Str+="<div class=\"form-group col-xl-3 col-lg-4 col-6\"><div class=\"sum-drive\">\t<span>drive\t</span><div class=\"info-box-number ml-auto\">"+seconds2time(i.DRIVE)+"</div></div></div>",$Str+="<div class=\"form-group col-xl-3 col-lg-4 col-6\"><div class=\"sum-work\">\t<span>work\t</span><div class=\"info-box-number ml-auto\">"+seconds2time(i.WORK)+"</div></div></div>",$Str+="<div class=\"form-group col-xl-3 col-lg-4 col-6\"><div class=\"sum-rest\">\t<span>rest\t</span><div class=\"info-box-number ml-auto\">"+seconds2time(i.REST)+"</div></div></div>",$Str+="</div>",s.append($Str)}function GetDriveTime(e){var a=document.getElementById("SelectDate");if(a){var i=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd"),s=new Date(document.getElementById("SelectDateEnd").value).format("yyyy/mm/dd"),e=document.getElementById("drivers").value;$str="&StartDate="+i+"&EndDate="+s}else $str="";table=$("#DriveTimeTable").DataTable({ajax:{url:window.location.origin+"/scripts/GetDriveTimes.php?id="+e+$str,dataSrc:""},autoWidth:!1,oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,createdRow:function(e,a){0!=TimeToSeconds(a.drive)&&$("td:eq(1)",e).addClass("cell_bold"),0!=TimeToSeconds(a.work)&&$("td:eq(2)",e).addClass("cell_bold"),0!=TimeToSeconds(a.available)&&$("td:eq(3)",e).addClass("cell_bold"),0!=TimeToSeconds(a.rest)&&$("td:eq(4)",e).addClass("cell_bold"),540<TimeToSeconds(a.drive)&&($("td:eq(1)",e).addClass("cell_warning"),a.EXTRATIME="1"),600<TimeToSeconds(a.drive)&&($("td:eq(1)",e).addClass("cell_danger"),a.INFRIGMENT="1"),540>TimeToSeconds(a.rest)&&($("td:eq(4)",e).addClass("cell_danger"),a.INFRIGMENT="1"),660>TimeToSeconds(a.rest)&&(a.INFRIGMENT="1"),1==a.Total&&($(e).addClass("rowTotal"),$("td:eq(1)",e).removeClass("cell_warning"),$("td:eq(1)",e).removeClass("cell_danger"),$("td:eq(1)",e).removeData("cell_danger"),$("td:eq(0)",e).text("Weekly Total"))},language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},autoWidth:!1,destroy:!0,order:[[0,"asc"]],dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,footer:!1,scrollCollapse:!0,paging:!0,bInfo:!1,order:[[0,"asc"]],lengthMenu:[[8,-1],[8,"All"]],buttons:{buttons:[]},columns:[{data:"DriveDate",title:"Date ",className:"dt-left"},{data:"drive",title:"Drive <i class=\"fad fa-user-circle drive \">",className:"dt-center"},{data:"work",title:"Work <i class=\"fad fa-tools work small\">",className:"dt-center"},{data:"available",title:"Available <i class=\"fad fa-square available border\"></i>",className:"dt-center"},{data:"rest",title:"Rest <i class=\"fad fa-bed rest\"> ",className:"dt-center"},{data:"COMP",render:function(e){return"0"==e?"<i class=\"far fa-circle \"></i>":"<i class=\"fad fa-circle rest\"></i>"},title:"",visible:!0,className:"dt-center",width:"1%"},{data:"EXTRATIME",render:function(e){return"0"==e?"<i class=\"far fa-circle \"></i>":"<i class=\"fad fa-circle text-warning\"></i>"},title:"Extra",visible:!0,className:"dt-center",width:"1%"},{data:"SHORTREST",render:function(e){return"0"==e?"<i class=\"far fa-circle \"></i>":"<i class=\"fad fa-circle text-warning\"></i>"},title:"Short",visible:!0,className:"dt-center",width:"1%"},{data:"INFRIGMENT",render:function(e){return"0"==e?"<i class=\"far fa-circle \"></i>":"<i class=\"fad fa-circle text-danger\"></i>"},title:"",visible:!0,className:"dt-center",width:"1%"}]}),$("#DriveTimeTable").off("click"),$("#DriveTimeTable").on("click","tr",function(){var e=table.row(this).data();ShowDriveTime(e.DriverId,"DriveTimeGraph","DriveTimeSummary",e.DriveDate),UpdateCounter("-","tableDriverTrips"),ShowDriverTripTable(e.DriveDate,e.DriverId,"TripsCol")})}function Show1Trip(e,a){var i=[];rFMS_Trip.clearLayers();var s=L.icon({iconUrl:"../images/triparrow.png",iconSize:[16,16],iconAnchor:[8,8],popupAnchor:[0,-8]}),l=L.icon({iconUrl:"../images/StartMarker.png",iconSize:[,32],iconAnchor:[16,32],tooltipAnchor:[0,-36]});$.ajax({url:window.location.origin+"/scripts/GetVehicle1Trip.php?vin="+e+"&StartDate="+a+"&EndDate="+$EndDate,dataType:"JSON",success:function(e){$.each(e,function(e,a){if("DISTANCE_TRAVELLED"==a.triggerType&&L.marker([a.GNSS_latitude,a.GNSS_longitude],{rotationAngle:a.GNSS_heading,icon:s,draggable:!1}).addTo(rFMS_Trip),"IGNITION_OFF"==a.triggerType){new L.Polyline(i,{color:"#00529c",weight:6}).addTo(rFMS_Trip);StartTrip=t,i=[],Distance=0,delayed=!1,$Delay=0,TimerCounter=0,L.marker([a.GNSS_latitude,a.GNSS_longitude],{icon:l,draggable:!1}).addTo(rFMS_Trip)}"IGNITION_ON"==a.triggerType&&L.marker([a.GNSS_latitude,a.GNSS_longitude],{icon:l,draggable:!1}).addTo(rFMS_Trip)}),0!=val.GNSS_latitude&&i.push([val.GNSS_latitude,val.GNSS_longitude])}}),map.addLayer(rFMS_Trip),map.fitBounds(rFMS_Trip.getBounds(),{padding:[50,50]})}function ReadDelayedVehicles(e){var a=new Date(e).format("yyyy/mm/dd"),i=$("#DelayedTables");i.html(""),ShowSpinner("DelayedTables"),$vehicles=[],$.ajax({url:window.location.origin+"/scripts/GetDelayedVehicles.php?StartDate="+a,dataType:"JSON",type:"GET",success:function(e){ShowDelayedVehicles(e)}})}function ReadTodayDelay(e){var a=[],i=[],s=$("#DelayedVehicles");s.html(""),ShowSpinnerSmall("DelayedVehicles");var l=$("#TitleDay");if(l.html(""),!e)var d=new Date;else var d=new Date(e);$.ajax({url:window.location.origin+"/scripts/CountDelayedVehiclesDay.php?StartDate="+d.format("yyyy-mm-dd"),dataType:"JSON",type:"GET",success:function(r){$.each(r,function(e,s){a.push([parseFloat(s.Hours),parseFloat(s.new)]),i.push([parseFloat(s.Hours),parseFloat(s.count)])}),s.html(""),e?(s.append("<div class=\"dgpad\" id=\"ShowHourlyDelayed\"></div>"),$String="ShowHourlyDelayed"):(s.append("<div id=\"MonitorDelayedVehicles\"></div>"),$String="MonitorDelayedVehicles"),l.append("Delayed vehicles for day :  <b>"+d.format("dddd dd  mmm yyyy")+"</b> (per Hour)"),DelayedChart(a,i,$String)}})}function DelayedChart(e,a,i){Highcharts.chart(i,{chart:{marginTop:0,marginBottom:30,marginLeft:10,marginRight:10,styledMode:!0},title:{text:"",margin:0},xAxis:{title:{text:""},tickInterval:1,labels:{autoRotation:[-30,-40],overflow:"justify"}},yAxis:{},tooltip:{headerFormat:"",pointFormat:"<span style=\"color:{series.color}\">{series.name} </span> - <b> {point.y}</b><br/>{series.label}",crosshairs:!1,useHTML:!0,shared:!0},plotOptions:{column:{pointPadding:.5,pointWidth:10,borderWidth:0},series:{turboThreshold:1e3,animation:!1,dataLabels:{enabled:!0,rotation:315,x:10,y:-20}}},credits:{enabled:!1},legend:{enabled:!1},series:[{data:a,type:"column",name:"delayed",colorIndex:"0",dataLabels:{enabled:!0,rotation:270,x:0,y:-20}},{data:e,type:"spline",name:"new ",colorIndex:"1",dataLabels:{enabled:!1}}]})}function ReadTimeLineMarkers(e){var a,i,s=[],l=[];$distance:;$.each(e,function(e,d){$color="1",$WS=d.driver1Id_WSC,"TIMER"==d.triggerType&&($color="0",$distance=40,d.triggerType="Timer <br><small>("+d.driver1Id_WSC+")</small>"),("ENGINE_ON"==d.triggerType||"ENGINE_OFF"==d.triggerType)&&($color="3",$distance=80),("IGNITION_ON"==d.triggerType||"IGNITION_OFF"==d.triggerType)&&($color="8",$distance=20),"TELL_TALE"==d.triggerType&&($color="2",$distance=60,d.triggerType="Display<BR><small>("+d.triggerInfo+")</small>"),"DRIVER_1_WORKING_STATE_CHANGED"==d.triggerType&&($color="2",$distance=60,d.triggerType="Tacho1<br><small>("+d.driver1Id_WSC+")</small>"),"TachoStatus"==d.triggerType&&($color="2",$distance=60,d.triggerType="Tacho1<br><small>("+d.driver1Id_WSC+")</small>"),"DISTANCE_TRAVELLED"==d.triggerType&&($color="5",$distance=80),("DRIVER_LOGOUT"==d.triggerType||"DRIVER_LOGIN"==d.triggerType)&&($color="4",$distance=80),a={x:Date.parse(d.createdDateTime),label:d.triggerType+" ",colorIndex:$color},i={x:Date.parse(d.createdDateTime),label:"<span class=\"text-right\">"+parseFloat(d.wheelBasedSpeed)+" km/u</span>",y:parseFloat(d.wheelBasedSpeed),colorIndex:$color},s.push(a),l.push(i)}),ShowMarkersTimeLine(s,l)}function ShowMarkersTimeLine(e,a){Highcharts.chart("TripDetailsTimeline",{chart:{zoomType:"x",styledMode:!0,marginTop:10,marginBottom:70,marginLeft:30,marginRight:0},xAxis:{type:"datetime",visible:!0},yAxis:[{gridLineWidth:1,title:"",visible:!1,labels:{enabled:!0}},{title:"km/u",visible:!0,tickPixelInterval:30}],legend:{enabled:!0},credits:{enabled:!1},title:{text:""},tooltip:{crosshairs:!0,useHTML:!0,shared:!0,headerFormat:"<span style=\"color:{series.colorIndex}\">{point.x:%Y-%m-%d %H:%M:%S}</span>",pointFormat:"<br><span style=\"color:var(--primary)\"><b>{point.label} </b></span>"},plotOptions:{series:{turboThreshold:1e3,animation:!0,dataLabels:{enabled:!1,rotation:0,x:10,y:-20,allowOverlap:!0}},spline:{marker:{enabled:!0,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}}},series:[{showInNavigator:!0,animation:!1,dataLabels:{allowOverlap:!1,distance:45,fontsize:"12px",name:"data message",enabled:!0,rotation:0,borderWidth:1,format:"<BR> <p style=\"color:var(--primary)\"><b>{point.label}</b></p>"},marker:{symbol:"circle"},type:"timeline",lineColor:"var(--primary)",lineWidth:4,yAxis:0,data:e,colorIndex:"7"},{data:a,type:"areaspline",name:"Speed in km/h",yAxis:1,colorIndex:"0"}]})}function ShowMarkersGraph(e){Highcharts.chart("TripDetailsGraph",{chart:{marginTop:0,marginBottom:30,marginLeft:10,marginRight:10,styledMode:!0,zoomType:"x"},xAxis:{type:"datetime",visible:!0},yAxis:{title:"km/u",visible:!0,labels:{enabled:!0}},legend:{enabled:!1},credits:{enabled:!1},plotOptions:{area:{marker:{enabled:!1,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}},column:{pointPadding:.5,pointWidth:10,borderWidth:0},series:{turboThreshold:1e3,animation:!1,dataLabels:{enabled:!0,rotation:315,x:10,y:-20}}},title:{text:""},tooltip:{enabled:!1,crosshairs:!0,shared:!0},series:[{data:e,type:"spline",name:"new ",colorIndex:"1",dataLabels:{enabled:!1}}]})}function ShowTTGraph(a){var i=new Date,s=new Date;i.setHours(0,0,0,0),s.setHours(23,59,59,0);for(var e=[],l=0;7>l;++l)PB={},PB.x=Date.parse(i),PB.x2=Date.parse(s),PB.y=l,PB.status="off",PB.color="#F6F6F6",e.push(PB);$.ajax({url:window.location.origin+"/scripts/GetTodayTT.php?vin="+a,dataType:"JSON",type:"GET",success:function(a){if(0==a.length)return void UpdateCounter("<div class=\"m-1 primary\">no data available</div>","TodayTT");PB={},FL={},ABL={},EMI={},EO={},ECT={},EEF={},PB.x=Date.parse(a[0].createdDateTime),PB.x2="",PB.y=0,PB.status="off",PB.color="#F6F6F6",FL.x=Date.parse(a[0].createdDateTime),FL.x2="",FL.y=1,FL.status="off",FL.color="#F6F6F6",ABL.x=Date.parse(a[0].createdDateTime),ABL.x2="",ABL.y=2,ABL.status="off",ABL.color="#F6F6F6",EMI.x=Date.parse(a[0].createdDateTime),EMI.x2="",EMI.y=3,EMI.status="off",EMI.color="#F6F6F6",EO.x=Date.parse(a[0].createdDateTime),EO.x2="",EO.y=4,EO.status="off",EO.color="#F6F6F6",ECT.x=Date.parse(a[0].createdDateTime),ECT.x2="",ECT.y=5,ECT.status="off",ECT.color="#F6F6F6",EEF.x=Date.parse(a[0].createdDateTime),EEF.x2="",EEF.y=6,EEF.status="off",EEF.color="#F6F6F6";for(var i=0;i<a.length;++i){var s=a[i].tellTale,l=a[i].state;"PARKING_BRAKE"==s&&PB.status!=l&&(PB.x2=Date.parse(a[i].createdDateTime),e.push(PB),i<a.length&&(PB={},PB.x=Date.parse(a[i].createdDateTime),PB.x2="",PB.y=0,PB.status=l,PB.color=setTTColor(l))),"FUEL_LEVEL"==s&&FL.status!=l&&(FL.x2=Date.parse(a[i].createdDateTime),e.push(FL),i<a.length&&(FL={},FL.x=Date.parse(a[i].createdDateTime),FL.x2="",FL.y=1,FL.status=l,FL.color=setTTColor(l))),"ENGINE_MIL_INDICATOR"==s&&EMI.status!=l&&(EMI.x2=Date.parse(a[i].createdDateTime),e.push(EMI),i<a.length&&(EMI={},EMI.x=Date.parse(a[i].createdDateTime),EMI.x2="",EMI.y=3,EMI.status=l,EMI.color=setTTColor(l))),"ENGINE_EMISSION_FAILURE"==s&&EEF.status!=l&&(EEF.x2=Date.parse(a[i].createdDateTime),e.push(EEF),i<a.length&&(EEF={},EEF.x=Date.parse(a[i].createdDateTime),EEF.x2="",EEF.y=6,EEF.status=l,EEF.color=setTTColor(l)))}Highcharts.chart("TodayTT",{chart:{type:"xrange",zoomType:"x",marginLeft:80,marginRight:40,styledMode:!0},title:{text:"",margin:0},xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:00",minute:"%H:%M"},title:{text:""},tickInterval:144e5,labels:{autoRotation:[-30,-40]}},yAxis:{title:{text:""},categories:["Parking Brake","Fuel Level","AdBlue Level","EngineMil Indicator","Engine Oil","Engine Collant Temperature","Engine Emission Failure"],reversed:!0},tooltip:{xDateFormat:"%H:%M:%S",headerFormat:"{point.x} - {point.x2}",pointFormat:"<br/>Status : <b>{point.status}</b>",crosshairs:!0,shared:!0},credits:{enabled:!1},legend:{enabled:!1},series:[{borderRadius:0,borderWidth:0,pointWidth:15,data:e}]})},error:function(){UpdateCounter("<div class=\"m-1 text-danger\">no data available</div>","TodayTT")}})}function ReadDriverTrips(e){var a=$("#"+e),i="";ShowSpinnerSmall(e);var s=new Date;$.ajax({url:window.location.origin+"/scripts/GetDriverTrips.php",type:"GET",dataType:"json",success:function(e){a.html(""),$.each(e,function(e,l){dateFormat(l.StartDate,"yyyy-mm-dd")!=dateFormat(l.localDate,"yyyy-mm-dd")&&(i="<div class=\"col-5 TripListName no-padding primary pr-3\"><b>"+dateFormat(l.StartDate,"yyyy-mm-dd")+"</b></div>",a.append(i)),0==l.TripActive?(i="<div class=\"TC-row pb-1 mb-1 \">",i+="<div class=\"col-12 d-flex no-padding px-1 pt-2 \">",i+="<div class=\"col-5 TripListName no-padding primary pr-3\"><i class=\"primary far fa-flag\"></i> <b>"+dateFormat(l.StartDate,"HH:MM ")+"</b></div>",i+="<div class=\"col-4 mr-auto TripListNameS no-padding pr-3 primary\"><i class=\"primary fas fa-truck\"></i> "+l.customerVehicleName+" </div>",i+="<div class=\"ml-auto TripListName primary no-padding \"><b>"+dateFormat(l.EndDate,"HH:MM ")+"<i class=\"primary fas fa-flag-checkered\"></b></i></div>",i+="</div>",i+="<div class=\"col-12 d-flex no-padding px-1 pt-2\">",i+="<div class=\"col-3 TripListName no-padding pr-3 primary\"><i class=\"fas fa-route\"></i> "+l.Distance+" </div>",i+=0<l.FuelUsage?"<div class=\"col-3 TripListName no-padding pr-3 primary\"> <i class=\"fas fa-tint \"></i> "+l.FuelUsage+" </div>":"<div class=\"col-3 TripListNameS no-padding pr-3\">  </div>",i+=0<l.FuelUsed?"<div class=\"col-3 TripListNameS no-padding primary\"\" > <i class=\"fas fa-gas-pump \"></i> "+l.FuelUsed+" </div>":"<div class=\"col-3 TripListNameS no-padding pr-3\">  </div>",i+="<div class=\"ml-auto text-right TripListName primary no-padding\"> "+l.Duration+" <i class=\"far fa-clock\"></i></div>",i+="</div></div>",a.append(i)):($Duration=new Date(s)-new Date(l.StartDate),$Distance=($C.OdoMeter-l.start_odometer)/1e3,i="<div class=\"TC-row pb-1 mb-1 \">",i+="<div class=\"col-12 d-flex no-padding px-1 pt-2\">",i+="<div class=\"col-3 TripListName no-padding primary pr-3\"><i class=\"primary far fa-flag\"></i> <b>"+dateFormat(l.StartDate,"y-m-d HH:MM ")+"</b></div>",i+="<div class=\"col-6 mr-auto TripListNameS no-padding pr-3\"> "+l.customerVehicleName+" </div>",i+="<div class=\"ml-auto TripListName work\"><b>"+dateFormat(s,"HH:MM ")+"</b> <i class=\"fas fa-flip-horizontal fa-wind fa-sm\" ></i><i class=\"fas fa-truck-moving\"></i></div>",i+="</div>",i+="<div class=\"col-12 d-flex no-padding px-1 pt-2\">",i+="<div class=\"col-4 mr-auto TripListName no-padding primary\"><i class=\"fas fa-route\"></i> "+$Distance+" km </div>",i+="<div class=\"col-3 text-right TripListName no-padding primary\"> "+dateFormat($Duration,"HH:MM ")+" <i class=\"far fa-clock\"></i></div>",i+="</div></div>",a.append(i)),s=new Date(l.StartDate)})},error:function(){a.append("No Trips Today")}})}function ReadDriver_TachoStatus(e){var a=$("#"+e),i="";ShowSpinnerSmall(e);new Date;$.ajax({url:window.location.origin+"/scripts/GetDriverTachoStatus.php",type:"GET",dataType:"json",success:function(e){a.html(""),$.each(e,function(e,s){i="\t<div class=\"col-12\">",i+="\t\t<div class=\"row TC-row\">",i+="\t\t\t<div class=\"col-12 \"><b>"+s.Lastname+", "+s.Surname+"</b> / ",i+="\t\t\t<b>"+s.tachoDriverIdentification+" </b> <small>(valid until "+dateFormat(s.Validity,"yyyy-mm-dd HH:MM ")+")</small></div>",$Str+="\t\t</div>",i+="\t</div>",i+="\t<div class=\"col-12\">",i+="\t\t<div class=\"row TC-row\">",i+="\t\t\t<div class=\"col-4  primary\">Today </div>",i+="\t\t\t<div class=\"ml-auto text-right primary \"> <b>"+s.RemainingDriveToday+"</b></div>",i+="\t\t\t<div class=\" col-4 progressTC\" id=\"TC1\"></div>",$Str+="\t\t</div>",i+="\t</div>",i+="\t<div class=\"col-12\">",i+="\t\t<div class=\"row TC-row\">",i+="\t\t\t<div class=\"col-4 primary\">Weekly </div>",i+="\t\t\t<div class=\"ml-auto text-right primary \"> <b>"+s.RemainingDriveWeek+"</b></div>",i+="\t\t\t<div class=\" col-4 progressTC\" id=\"TC2\"></div>",$Str+="\t\t</div>",i+="\t</div>",i+="\t<div class=\"col-12\">",i+="\t\t<div class=\"row TC-row\">",i+="\t\t\t<div class=\"col-4 primary\">Bi-Weekly </div>",i+="\t\t\t<div class=\"ml-auto text-right primary \"> <b>"+s.RemainingDriveBiWeekly+"</b></div>",i+="\t\t\t<div class=\" col-4 progressTC\" id=\"TC3\"></div>",$Str+="\t\t</div>",i+="\t</div>",i+="\t<div class=\"col-12\">",i+="\t\t<div class=\"row TC-row\">",i+="\t\t\t<div class=\"col-4  primary\">Rest Today  </div>",i+="\t\t\t<div class=\"ml-auto text-right primary \"> <b>"+s.RemainingRestToday+"</b></div>",i+="\t\t\t<div class=\" col-4 progressTC\" id=\"TC4\"></div>",$Str+="\t\t</div>",i+="\t</div>",i+="</div>",a.append(i)});var s={strokeWidth:18,easing:"easeInOut",duration:1100,color:"#266cab",trailColor:"#ddd",trailWidth:4,svgStyle:{width:"100%",height:"100%"}},l=new ProgressBar.Line(TC1,s),d=new ProgressBar.Line(TC2,s),r=new ProgressBar.Line(TC3,s),o=new ProgressBar.Line(TC4,{strokeWidth:18,easing:"easeInOut",duration:1100,color:"#8AC543",trailColor:"#ddd",trailWidth:4,svgStyle:{width:"100%",height:"100%"}});l.animate(.45),d.animate(.5),r.animate(.74),o.animate(.24)},error:function(){a.append("No Driver information available")}})}function ReadNotifications(){var e=$("#Not_Sidebar"),a="";ShowSpinnerSmall("Not_Sidebar");new Date;$.ajax({url:window.location.origin+"/scripts/GetNotifications.php",type:"GET",dataType:"json",success:function(i){e.html(""),$.each(i,function(i,s){a="<div class=\"col-12 \" title=\"enabled until "+s.endPublish+"\">",a+="<div class=\"card Notification \">",a+=""==s.notificationHeader?"<div class=\"card-header \"><h4><strong></strong><h4></div>":"<div class=\"card-header "+s.notificationType+"\"><h4><strong>"+s.notificationHeader+"</strong><h4></div>",a+="<div class=\"card-body "+s.notificationType+"\">"+s.notificationInfo+"</div>",a+="</div>",a+="</div>",e.append(a)})},error:function(){e.html(""),e.append("No information available")}})}function CreateReport(e,a){UpdateCounter("Creating report...","TripReport"),ShowSpinnerSmall("TripReport"),$url=!1==a?"/scripts/createreport.php?type="+e:"/scripts/createreport.php?type="+e+"&Schedule="+a,$.ajax({url:window.location.origin+$url,success:function(){!0==a?$("#TripReport").html("Scheduler has been set to weekly as of next monday").fadeIn(500).delay(5e3).fadeOut(1e3):$("#TripReport").html("Report has been created ").fadeIn(500).delay(5e3).fadeOut(1e3)},error:function(){$("#TripReport").html("<span class=\"danger\"><i class=\"fas fa-exclamation-circle \"></i>Report NOT created</span>").fadeIn(500).delay(5e3).fadeOut(1e3)}})}function openNav(){var e=$("#mySidebar");e.html("");var a="<div class=\"card VehicleDetails shadow-sm\">";a+="<div class=\"card-header py-2\"><h3>General Notifications</h3><a href=\"javascript:void(0)\" class=\"closebtn\" onclick=\"closeNav()\">\xD7</a></div>",a+="</div>",a+="<div id=\"Not_Sidebar\"></div>",e.append(a),document.getElementById("mySidebar").style.width="450px",ReadNotifications()}function closeNav(){UpdateCounter("","mySidebar"),document.getElementById("mySidebar").style.width="0"}function openVehDet(){var e=document.getElementById("VehicleDetails");e.classList.remove("hide"),document.getElementById("VehicleDetails").className+=" transition ",map.invalidateSize(),map.fitBounds(rFMS_Latest.getBounds(),{padding:[40,40]})}function closeVehDet(){UpdateCounter("","VehicleDetails"),document.getElementById("VehicleDetails").className+=" hide ",map.invalidateSize(),map.fitBounds(rFMS_Latest.getBounds(),{padding:[40,40]}),ShowLatestLayer()}function toggleIcon(a){$(a.target).prev(".panel-heading").find(".more-less").toggleClass("fa-plus fa-minus")}$(".panel-group").on("hidden.bs.collapse",toggleIcon),$(".panel-group").on("shown.bs.collapse",toggleIcon);function ShowAdminPagesTable(e){table=$("#tableAdminPages").DataTable({data:e,language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,responsive:!0,autoWidth:!1,destroy:!0,order:[[6,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,scrollX:!0,deferRender:!0,pageResize:!0,colReorder:!0,buttons:{buttons:[]},columns:[{data:"id",title:"id",className:"dt-left",width:"3%"},{data:"page",title:"page",visible:!0},{data:"",render:function(e){return"1"==e?"<i class=\"fas fa-lock-open rest\"></i>":"<i class=\"fas fa-lock text-danger\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right"}]}),$("#tableAdminPages").off("click"),$("#tableAdminPages").off("mousedown"),$("#tableAdminPages").on("click","tbody tr",function(a){a.preventDefault();$(this).find("td:nth-child(0)").text();$(this).closest("tr"),$(window).attr("location","../users/admin_page.php?id="+$row)})}function ShowTomFooleryTable(e){table=$("#tableAdminPages").DataTable({data:e,language:{search:"<i class=\"fad fa-fw fa-filter\" aria-hidden=\"true\"></i>",searchPlaceholder:"filter records"},oLanguage:{sProcessing:"<div class='loader' id='tableloader'></div>"},processing:!0,responsive:!0,autoWidth:!1,destroy:!0,order:[[6,"desc"]],dom:"Bfltirp",bInfo:!0,scrollCollapse:!0,paging:!0,scrollX:!0,deferRender:!0,pageResize:!0,colReorder:!0,buttons:{buttons:[]},columns:[{data:"id",title:"id",className:"dt-left",width:"3%"},{data:"user",title:"user",visible:!0},{data:"page",title:"page",visible:!0},{data:"timestamp",title:"timestamp",visible:!0},{data:"ip",title:"ip-address",visible:!0},{data:"",render:function(e){return"1"==e?"<i class=\"fas fa-lock-open rest\"></i>":"<i class=\"fas fa-lock text-danger\"></i>"},title:" ",visible:!0,width:"2%",className:"dt-right"}]})}function ShowVehicleDetails(){var e=$("#VehicleDetails");$S=new URL(location.href).searchParams.get("id"),e.html(""),e.append("ja het werkt "),$.ajax({url:window.location.origin+"/scripts/GetVehicleDetails.php?id="+$S,dataType:"JSON",success:function(a){if(null==a[0].model){$model="";var i="../images/avatars/"+a[0].brand+"_XF_"+a[0].Year+".png"}else{$model=a[0].model;var i="../images/avatars/"+a[0].brand+"_"+a[0].model.substring(0,2)+"_"+a[0].Year+".png"}var s="<div class=\"vehicleCard truck_background\">";s+="\t<div class=\"row px-2\">",s+="\t\t<div class=\"col-12 px-3 \">",s+="\t\t\t<div class=\"col-12 p-0 StatusLine \"><i class=\"far fa-fw fa-building fa-fw tooltipicon\"></i> <span> "+a[0].name+"</b></span></div>",s+="\t\t\t<div class=\"col-12 p-0 StatusLine \" id=\"VLAddress\"></div>",s+="\t\t\t<div class=\"d-flex StatusLine col-12 p-0\">",s+="\t\t\t\t<div class=\"col-6 p-0 \"><i class=\"fas fa-tachometer-alt fa-fw tooltipicon \"></i> "+(a[0].OdoMeter/1e3).toFixed(0)+"</b> km</div>",s+="\t\t\t\t<div class=\"ml-auto p-0 StatusValue  \"><i class=\"fas fa-truck-moving fa-fw tooltipicon \"></i> "+a[0].grossCombinationVehicleWeight+"</b> kg</div>",s+="\t\t\t</div>",s+="\t\t\t<div class=\"d-flex StatusLine col-12 p-0\">",s+="\t\t\t\t<div class=\"col-6 p-0 \"><i class=\"fas fa-gas-pump fa-fw tooltipicon \"></i> "+a[0].FuelLevel+"</b> %</div>",s+="\t\t\t\t<div class=\"ml-auto p-0 StatusValue \"> "+a[0].currentSpeed+"</b> km/u</div>",s+="\t\t\t</div>",s+="\t\t\t<div class=\"d-flex StatusLine col-12 p-0\">",s+="\t\t\t\t<div class=\"ml-auto p-0 StatusValue \"> <b>"+dateFormat(a[0].LastActivity+" UTC","yyyy-mm-dd HH:MM ")+"</b></div>",s+="\t\t\t</div>",s+="\t\t</div>",s+="\t</div>",e.append(s),Convert2Address([a[0].last_Latitude,a[0].last_Longitude,"VLAddress"]),ShowVehicleRD(a[0].id),s="<div class=\"row mt-4 \">",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>vin</label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].VI+"</div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>brand </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].brand+"</div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>model</label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].Mode+"</div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>service distance</label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].serviceDistance/1e3+" km</div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>odo meter </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].OdoMeter/1e3+" km</div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>fuel level </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].FuelLevel+" %</div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>ad-blue level </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].CatalystFuelLevel+" %</div>",s+="\t\t</div>",s+="<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>total fuel used </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].TotalFuelUsed/1e3+" L </div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>total engine hours  </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].TotalEngineHours+" h </div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>last activity  </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].LastActivity+" </div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>outside temp </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].ambientAirTemperature+" </div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>coolant temp </label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].engineCoolantTemperature+" </div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>last driver</label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].driver+" </div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>damage</label>",s+="\t\t\t<div class=\"form-group\" >"+a[0].DamageCount+" </div>",s+="\t\t</div>",s+="\t\t<div class=\"col-6 col-lg-4 p-1\">",s+="\t\t\t<label>service home dealer>",s+="\t\t\t<div class=\"form-group\" >"+a[0].Service_Homedealer+" </div>",s+="\t\t</div>",s+="\t</div>",e.append(s)},error:function(){UpdateCounter("<span class=\"danger\"><i class=\"fas fa-exclamation-circle \"></i>functionality failed</span>","TripReport")}})}function SelectDrivers(){$select=$("#drivers"),$select.html(""),"*"==document.getElementById("groups").value?$select.append("<option value=\"\" selected> <i>First select a group</i></option>"):$.ajax({url:window.location.origin+"/scripts/GetDrivers.php",dataType:"JSON",success:function(e){$selected="selected",$.each(e,function(e,a){$select.append("<option value=\""+a.id+"\" class=\"select\" "+$selected+">"+a.driver+"</option>"),"selected"==$selected&&($selected="")})}})}function SessionAlert(){}function CheckUserSession(){var e=!1;return $.ajax({url:window.location.origin+"/scripts/CheckSession.php",type:"POST",dataType:"json",contentType:"application/json; charset=utf-8",async:!1,success:function(a){e=a.userInSession}}),e}function ChangeStyle(){const e=document.querySelector("#colorstyle");var a=document.getElementById("us_css"),i=a.options[a.selectedIndex].text,s=window.location.origin+"/users/css/color_schemes/";e.href=s+i+".css"}$("#carouselNotifications").carousel({interval:500}),$("#password-eye-btn").click(function(){$(this).toggleClass("fa-eye fa-eye-slash");var e=$($(this).attr("toggle"));"password"==e.attr("type")?e.attr("type","text"):e.attr("type","password")}),$("#loginbtn").click(function(){$("#loginbtn").html("<span class=\"spinner-border spinner-border-sm mr-2\" role=\"status\" aria-hidden=\"true\"></span> authenticating...").attr("enabled",!0)}),Notiflix.Notify.Init({position:"left-bottom",timeout:6e3,ID:"dashboardMessages",plainText:!1,clickToClose:!0,useFontAwesome:!0,fontAwesomeIconSize:"36px"});