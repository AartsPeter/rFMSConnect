var Global_Check={};function Convert2Address(a){$.ajax({url:"https://reverse.geocoder.api.here.com/6.2/reversegeocode.json?prox="+a[0]+","+a[1]+"&mode=retrieveAddresses&gen=9&language=en&maxresults=1&app_id=Ch87ydlyXjsmnI5AcXho&app_code=z2HsXPK48vhNPwyfcFr5ew",type:"GET",dataType:"json",success:function(a){return"<i class=\"fas fa-map-marked-alt fa-fw tooltipicon\"></i><i class=\"fas fa-fw\"></i> "+a.Response.View[0].Result[0].Location.Address.Label}})}function SelectVehicle(){var a=$("#selectedVehicle");a.html("");var b=$("#selectedVehicleFooter");b.html(""),a.append("<table class=\"display table noWrap border-bottom\" id=\"tablePDCSelectVehicle\"></table>"),b.append("<div class=\"row \">        <div class=\"col-12\">            <button class=\"btn btn-primary \" data-toggle=\"modal\" data-target=\"#NewVehicleModal\">ADD other vehicle </button>        </div>    </div>");var c=$("#tablePDCSelectVehicle").DataTable({ajax:{url:window.location.origin+"/scripts/GetLastVehicles.php",dataSrc:""},bInfo:!1,autoWidth:!1,destroy:!0,dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,ordering:!1,footer:!1,scrollCollapse:!1,paging:!0,drawCallback:function(){$("#tablePDCSelectVehicle thead").addClass("hide")},buttons:{buttons:[]},columns:[{data:"customerVehicleName",title:"",className:"dt-left"},{data:"brand",title:"",className:"dt-left "},{data:"model",title:"",className:"dt-left "},{data:"LicensePlate",title:"",className:"dt-right d-none d-md-block"}]});$("#tablePDCSelectVehicle").off("click"),$("#tablePDCSelectVehicle").on("click","tr",function(){var b=c.row(this).data();a=$("#selectedVehicle"),a.html("");var d=$("#selectedVehicleFooter");d.html(""),a.append("<div class=\"d-flex\"><div class=\"col-9 p-0 \"><b>"+b.customerVehicleName+"</b> </div><div class=\"ml-auto\"><button class=\"btn btn-outline-default\" onclick=\"SelectVehicle();\"><i class=\"fad fa-edit\"></i></button></div></div>"),Global_Check.vehicle=b.vin,Global_Check.vehicle_odometer=b.odometer})}function SelectTrailer(){var a=$("#selectedTrailer");a.html("");var b=$("#selectedTrailerFooter");b.html(""),a.append("<table class=\"display table noWrap border\" id=\"tablePDCSelectTrailer\"></table>"),b.append(" <div class=\"row\">        <div class=\"col-12\">            <button class=\"btn btn-primary \" data-toggle=\"modal\" data-target=\"#NewTrailerModal\">ADD other trailer </button>            <button class=\"btn btn-secondary ml-2\" data-toggle=\"modal\" onclick=\"SelectNoTrailer();\" data-target=\"#\">SKIP trailer </button>        </div>    </div>");var c=$("#tablePDCSelectTrailer").DataTable({ajax:{url:window.location.origin+"/scripts/GetLastTrailer.php",dataSrc:""},bInfo:!1,autoWidth:!1,destroy:!0,dom:"Bfltirp",scrollX:!1,deferRender:!0,searching:!1,ordering:!1,footer:!1,scrollCollapse:!1,paging:!0,drawCallback:function(){$("#tablePDCSelectTrailer thead").addClass("hide")},buttons:{buttons:[]},columns:[{data:"trailerName",title:"",className:"dt-left"},{data:"LicensePlate",title:"",className:"dt-left"},{data:"lastTrip",title:"",className:"dt-left"}]});$("#tablePDCSelectTrailer").off("click"),$("#tablePDCSelectTrailer").on("click","tr",function(){var b=c.row(this).data();a.html(""),a.append("<div class=\"d-flex\"><div class=\"col-9 p-0 \"><B></B>"+b.trailerName+"</b></div><div class=\"ml-auto\"><button class=\"btn btn-default\" onclick=\"SelectTrailer();\"><i class=\"fad fa-edit\"></i></button></button></div></div>"),Global_Check.trailer=b.vin})}function SelectNoTrailer(){var a=$("#selectedTrailer");a.html("");var b=$("#selectedTrailerFooter");b.html(""),a.html(""),a.append("<div class=\"d-flex\"><div class=\"col-9 p-0 \"><B>NO trialer selected</B></div><div class=\"ml-auto\"><button class=\"btn btn-default\" onclick=\"SelectTrailer();\"><i class=\"fad fa-edit\"></i></button></button></div></div>")}function ReadDriverStatus(a,b){ShowSpinnerSmall(a),ShowSpinnerSmall(b),$.ajax({url:window.location.origin+"/scripts/GetDriverDashboard.php",type:"GET",dataType:"json",success:function(c){0<c.length&&$.each(c,function(c,d){Global_Check.vehicle=d.LastVehicle,Global_Check.vehicle_odometer=d.odometer,Global_Check.trailer=d.TrailerVin;var e=$("#"+a);e.html("");var f=$("#"+b);f.html(""),e.append("<div class=\"d-flex\"><div class=\"col-9 p-0 \"><B>"+d.LastVehicleName+"</B></div><div class=\"ml-auto\"><button class=\"btn btn-default\" onclick=\"SelectVehicle();\"><i class=\"fad fa-edit \"></i></button></div></div>"),f.append("<div class=\"d-flex\"><div class=\"col-9 p-0 \"><B>"+d.TrailerName+"</B></div><div class=\"ml-auto\"><button class=\"btn btn-default\" onclick=\"SelectTrailer();\"><i class=\"fad fa-edit \"></i></button></div></div>")})},error:function(){}})}function ReadDriverTachoStatus(a){ShowSpinnerSmall(a),$.ajax({url:window.location.origin+"/scripts/GetDriverDashboard.php",type:"GET",dataType:"json",success:function(b){if(0<b.length)$.each(b,function(b,c){var d=$("#"+a);d.html(""),d.append("\t<div class=\"d-flex StatusLine\">\t\t<div class=\"mr-auto\">Remaing Drive Today </div>\t\t<div class=\"text-right  ml-auto\"><b>"+c.RemainingDriveToday+"</b></div></div>"),d.append("\t<div class=\"d-flex StatusLine\">\t\t<div class=\"mr-auto\">Remaing Drive this Week</div>\t\t<div class=\"text-right  ml-auto\"><b>"+c.RemainDriveWeekly+"</b></div></div>"),$str="\t<div class=\"d-flex StatusLine\">",$str+="\t\t<div class=\"mr-auto\">Remaing Extended Drivetime</div>",$str+=0>c.RemainingExtendedDrive?"\t\t<div class=\"text-right text-danger\"><b> INFRIGMENT +"+Math.abs(c.RemainingExtendedDrive)+"</b></div>":"\t\t<div class=\"text-right  ml-auto\"><b>"+c.RemainingExtendedDrive+"</b></div>",$str+=" </div>",d.append($str),$str="\t<div class=\"d-flex StatusLine\">",$str+="\t\t<div class=\"mr-auto\">Total Drivetime BI-Weekly</div>",$str+=5100<TimeToSeconds(c.DriveBiWeekly)?"\t\t<div class=\"text-right text-danger\"><b> INFRIGMENT "+c.DriveBiWeekly+"</b></div>":"\t\t<div class=\"text-right  ml-auto\"><b>"+c.DriveBiWeekly+"</b></div>",$str+=" </div>",d.append($str);var e=$("#lastVehicle");e.html(""),e.append(c.LastVehicle)});else{var c=$("#"+a);c.html(""),c.append("\t<div class=\"d-flex py-2\">\t\t<div class=\"mr-auto\">Remaing Drive Today </div>\t\t<div class=\"text-right grey ml-auto\">You are not a driver or <br>Your Tachgraph DriverCard is not known</b></div></div>")}},error:function(){}})}function ReadDriverDamageStatus(a){var b=$("#"+a),c="";ShowSpinnerSmall(a);new Date;$.ajax({url:window.location.origin+"/scripts/GetDriverDashboardDamages.php",type:"GET",dataType:"json",success:function(a){b.html(""),$.each(a,function(a,b){null==b.Damages&&(b.Damages=0),null==b.trailer&&(b.trailer=0),null==b.customerVehicleName?b.customerVehicleName="</b><span class=\"grey\">Please select vehicle</span>":(c+="<div class=\"col-12 d-flex text-grey\">",c+="<div class=\"mr-auto\"><i class=\"fas fa-check rest\"></i>  <b>"+b.Checks+"</b></div>",0==b.trailer?c+="<div class=\"m-auto\"><i class=\"fas fa-truck \"></i>  <b>"+b.customerVehicleName+"</b></div>":(c+="<div class=\"m-auto \"><i class=\"fad fa-truck fa-flip-horizontal\"></i> <b>"+b.customerVehicleName+"</b> ",c+="<i class=\"fas fa-trailer fa-flip-horizontal\"></i>  <b>"+b.trailerName+"</b></div>"),c+="\t<div class=\"ml-auto text-right\"><i class=\"fad fa-tools text-danger\"></i> <b>"+b.Damages+"</b></div>",c+="</div><div class=\"dropdown-divider\"></div>")}),c+="\t<div class=\"row px-3 py-2 \">",c+="\t\t<a href=\"pages/pdc_new.php?id=\" id=\"StartCheck\" class=\"btn btn-lg btn-primary mb-3 col-12 \"><i class=\"fad fa-list fa-fw\"></i><b> Start Check</b></a>",c+="\t\t<button class=\"btn btn-secondary btn-lg col-5 gray\" \"><b>Damage </b><i class=\"fad fa-wrench \"></i></button>",c+="\t\t<a href=\"pages/pdc_accident_new.php\" class=\"btn btn-danger btn-lg ml-auto col-5\" \"><b>Accident </b><i class=\"fad fa-car-crash\"></i></a>",c+="\t</div>",b.append(c)},error:function(){b.html(""),b.append("No Driver information available")}})}function StartPDC(){var a=$("#pdc_details");a.html("");var b="";openpdcDet(),b+="<div class=\"card h-100\">",b+=" <div class=\"card-header\">",b+="     <div class=\"d-flex\">",b+="         <div><a  onclick=\"closepdcDet();\"><i class=\"fas fa-arrow-left fa-fw\"></i></a></div>",b+="         <div class=\"m-auto\">Perform Checks - <span id=\"pdc_cc\"></span></div>",b+="     </div>",b+=" </div>",b+=" <div class=\"card-body pdc-pagina\">",b+="     <div class=\"row\" >";var c=0,d=0;$.each(Global_Check.categories,function(a,e){b+="         <div class=\"col-12 \" id=\"pdccatcard_"+c+"\">",e.checked?(b+=MarkCatChecked(c,0),d++):0==e.damages?b+=MarkCatNotChecked(c,0):(b+=MarkCatDamage(c,0),d++),b+="         </div>",c++}),b+=" </div>",b+=" </div>",b+=" <div class=\"card-footer\" id=\"PDCFinaliseButton\"></div>",b+="</div>",a.append(b),CheckComplete()}function CheckComplete(){var a=0,b=0;$.each(Global_Check.categories,function(c,d){d.checked?b++:0!=d.damages&&b++,a++});var c="  <span class=\"badge badge-success\">"+b+" </span> | <span class=\"badge badge-secondary\"></b>"+a+"</span>  ";if($("#pdc_cc").html(c),b==a)var d="<button class=\"btn btn-lg btn-success col-12\" onclick=\"FinalisePDC();\"> Finalise Check  </button>";else var d="<button class=\"btn btn-lg btn-secondary col-12\" disabled\"> to finalise, perform all checks  </button>";$("#PDCFinaliseButton").html(d)}function showCheckItems(a){var b=$("#pdc_details2");b.html("");var c="";c+="<div class=\"card h-100\">",c+=" <div class=\"card-header\">",c+="     <div class=\"d-flex\">",c+="         <div><a  onclick=\"closepdcDet2();\"><i class=\"fas fa-arrow-left fa-fw\"></i></a></div>",c+="         <div class=\"m-auto\">"+Global_Check.categories[a].cat_name+"</div><span class=\"small\" id=\"pdc_cc\"><span>",c+="     </div>",c+=" </div>",c+=" <div class=\"card-body pb-5 pdc-pagina\">",c+="     <div class=\"col-12\" >",c+="         <div class=\"page-title\" >What to check?</div><ul>",$.each(Global_Check.categories[a].checkitems,function(a,b){c+="\t    \t   <a href=\"#good\"><li>",c+="                 <div class=\"py-1\">"+b.check+"</i></div>",c+="             </li></a>"}),c+="        </ul></div>",0==Global_Check.categories[a].damages&&(c+=" <div class=\"d-flex py-5 \" id=\"good\">",c+="     <div class=\"col-12 m-auto\"><button class=\"col-12 p-2 btn btn-outline-success info-box-number\"  onclick=\"MarkCatChecked(`"+a+"`,`1`);closepdcDet2();\"> All Good  <i class=\"fas fa-check \"></i> </button> </div>",c+=" </div>"),c+="     </div>",c+=" </div>",c+=" </div>",b.append(c),openpdcDet2()}function showSubCategories(a){var b=$("#pdc_details2");b.html("");var c="",d=0;c+="<div class=\"card h-100\">",c+=" <div class=\"card-header\">",c+="     <div class=\"d-flex\">",c+="         <div><a  onclick=\"closepdcDet2();\"><i class=\"fas fa-arrow-left fa-fw\"></i></a></div>",c+="         <div class=\"m-auto\">"+Global_Check.categories[a].cat_name+"</div><span class=\"small\" id=\"pdc_cc\"><span>",c+="     </div>",c+="</div>",c+="     <div class=\"card-body pdc-pagina \">",c+="         <div class=\"col-12 p-0\">",$.each(Global_Check.categories[a].subcategories,function(b,e){c+="             <a onclick=\"ShowSubCatDamages(`"+a+"`,`"+d+"`);\">",c+="\t    \t    <div class=\"card alert-danger pdc-card mb-3\">",c+="\t    \t        <div class=\"card-title d-flex p-2 px-3 mb-0\">",c+="\t     \t            <div class=\" \"><i class=\"fad fa-fw  fa-exclamation-triangle text-danger\"></i></div>",c+="                     <div class=\"text-grey px-2\">"+e.subcat_name+"</div>",c+="                     <div class=\"ml-auto px-2\"><i class=\"fas fa-chevron-right\"></i></div>",c+="                 </div>",c+="             </div></a>",d++}),c+="         </div>",c+="     </div>",c+=" </div>",b.append(c),openpdcDet2()}function MarkCatChecked(a,b){var c="";if(closepdcDet2(),c+=" \t<div class=\"card alert-success pdc-card shadow mb-3\" >",c+="         <a class=\"text-grey\" onclick=\"MarkCatNotChecked(`"+a+"`,`1`);\">",c+="\t    \t<div class=\"btn card-title mb-0 d-flex\">",c+="            <div class=\"subtitle rest\">"+Global_Check.categories[a].cat_name+"</div>",c+="            <div class=\"subtitle ml-auto\"><i class=\"far fa-edit rest\"></i></div>",c+="         </div></a>",c+="     </div>",Global_Check.categories[a].checked=!0,0!=b){CheckComplete(),$("#pdccatcard_"+parseInt(a)).html(c);var d="#pdccatcard_"+(parseInt(a)+1);jump(d)}else return c}function MarkCatNotChecked(a,b){var c="";if($val=Global_Check.categories[a],c+=" \t<div class=\"card pdc-card shadow-sm mb-3\"   >",c+="          <a className=\"textgrey\" onClick=\"openpdcDet2();showCheckItems(`"+a+"`);\">",c+="\t    \t<div class=\"card-header d-flex\">",c+="            <div class=\"subtitle\">"+Global_Check.categories[a].cat_name+"</div>",c+="            <div class=\"ml-auto\"><i class=\"fas fa-chevron-right\"></i></div>",c+="         </div></a>",c+="\t    \t<div class=\"card-body p-2\">",c+="             <div class=\"d-flex\">",c+="                 <div class=\"pl-2 pt-1\"><i class=\""+Global_Check.categories[a].cat_icon+" fa-fw  fa-2x text-grey\"></i></div>",c+="                 <div class=\"ml-auto\">   <button class=\"btn-round btn-outline-danger \" onclick=\"openpdcDet2();ShowCatDamage(`"+a+"`);\"><i class=\"fas fa-tools fa-fw\"></i>   </button> </div>",c+="                 <div class=\"mx-2\">      <button class=\"btn-round btn-outline-success MarkCatChecked\" onclick=\"MarkCatChecked(`"+a+"`,`1`);\">  <i class=\"fas fa-check fa-fw\"></i> </button> </div>",c+="             </div>",c+="         </div>",c+="     </div>",Global_Check.categories[a].checked=!1,0!=b){CheckComplete();var d=$("#pdccatcard_"+parseInt(a));d.html(c);var e="#pdccatcard_"+(parseInt(a)-1);jump(e)}else return c}function MarkCatDamage(a){var b="";return b+=" \t<div class=\"card pdc-card shadow-sm mb-3\" >",b+="\t    \t<div class=\"card-header alert-danger d-flex\">",b+="            <div class=\"subtitle\">"+Global_Check.categories[a].cat_name+"</div>",b+="            <div class=\"ml-auto\"><a class=\"textgrey\" onclick=\"openpdcDet2();showCheckItems(`"+a+"`);;\"><i class=\"fas fa-chevron-right\"></i></a></div>",b+="         </div>",b+="\t    \t<div class=\"card-body p-2\">",null==Global_Check.categories[a].subcategories?($dc=0,$.each(Global_Check.categories[a].damageitems,function(c,d){d.registered&&(b+="             <div class=\"d-flex px-2\">",b+="                 <a class=\"text-danger\" onclick=\"ShowCatDamage(`"+a+"`);\"><i class=\"fas fa-fw fa-exclamation-triangle danger\"></i> "+d.title+"</a> ",b+="                 <div class=\"ml-auto\"> <a class=\"text-danger\" onclick=\"UnMarkDamage(`"+a+"`,``,`"+$dc+"`);StartPDC();\"><i class=\"far fa-fw fa-trash-alt text-danger\"></i></a> </div>",b+="             </div>"),$dc++})):($sc=0,$.each(Global_Check.categories[a].subcategories,function(c,d){$dc=0,$.each(d.damageitems,function(c,d){d.registered&&(b+="             <div class=\"d-flex px-2\">",b+="                 <a class=\"text-danger\" onclick=\"ShowCatDamage(`"+a+"`);\"><i class=\"fas fa-fw fa-exclamation-triangle danger\"></i> "+d.title+"</a> ",b+="                 <div class=\"ml-auto\"> <a class=\"text-danger\" onclick=\"UnMarkDamage(`"+a+"`,`"+$sc+"`,`"+$dc+"`);StartPDC();\"><i class=\"fad fa-fw fa-trash-alt text-danger\"></i></a> </div>",b+="             </div>"),$dc++}),$sc++})),b+="         </div>",b+="\t    \t<div class=\"p-2\">",b+="             <div class=\"d-flex px-2\">",b+="                 <div class=\"ml-auto\">",b+="                      <button class=\"btn btn-outline-danger\" onclick=\"openpdcDet2();ShowCatDamage(`"+a+"`);\"><b>Add Damages <i class=\"fal fa-plus\"></i></b></button>",b+="                 </div>",b+="             </div>",b+="         </div>",b+="     </div>",b}function RegisterFormDamages(a,b,c){var d=$("#pdc_details2");d.html("");var e="";if(e+="<div class=\"card h-100\">",e+=" <div class=\"card-header\">",e+="     <div class=\"d-flex\">",e+="         <div><a onclick=\"closepdcDet2();\"><i class=\"fas fa-arrow-left fa-fw\"></i></a></div>",e+="         <div class=\"m-auto\">"+Global_Check.categories[a].cat_name+"</div>",e+="     </div>",e+=" </div>",e+=" <div class=\"card-body pdc-pagina\">",""!=b)var f=Global_Check.categories[a].subcategories[b].damageitems[c];else var f=Global_Check.categories[a].damageitems[c];e+="     <div class=\"d-flex\">",e+="         <div class=\"col-1\"><i class=\"fas fa-fw fa-exclamation-triangle text-danger\"></i></div>",e+="         <div class=\"col-10\">"+f.title+"</div>",e+="         <div class=\"col-1\"> <a  href=\"\" class=\"text-danger\" onclick=\"ShowCatDamage(`"+a+"`);\"><i class=\"far fa-check-square text-danger\"></i></a> </div>",e+="     </div>",e+="     <div class=\"d-flex pt-3\">",e+="                 <div class=\"col-1\"><i class=\"fa-fw\"></i></div>",e+="                 <div class=\"col-10\"><b>"+f.event_description+"</b></div>",e+="                 <div class=\"col-1\"><i class=\"fa-fw\"></i></div>",e+="     </div>",e+="     <div class=\"row pt-3\">",e+="                 <form class=\"col-12 form-signup\" action=\"\" method=\"POST\" id=\"add_damage\" enctype=\"multipart/form-data\"> ",e+="                     <div class=\"col-12\">",e+="                         <label>Damage comments/description</label>",e+="                         <input class=\"form-control\" type=\"textarea\" id=\"damage_comments\" value=\""+f.comments+"\" name=\"damage_description\">",e+="                     </div>",e+="                     <div class=\"col-12 pt-3\">",e+="                         <label>Photo evidence of damage</label>",e+=""==f.evidence_picture?"                         <input class=\"form-control \" type=\"file\" id=\"damage_evidence\" name=\"damage_evidence\" value=\""+f.evidence_picture+"\">":"                          <div class=\"form-control-ro\"><img class=\"border shadow-sm\" src=\""+f.evidence_picture+"\" height=\"60px\" alt=\""+f.evidence_picture+"\"></div>",e+="                     </div>",e+="                     <div class=\"row pt-5 m-auto\">",e+="                         <button class=\"col-12 text-white btn btn-lg btn-primary m-auto\" onclick=\"RegisterDamage(`"+a+"`,`"+b+"`,`"+c+"`);closepdcDet2();\">Save <i class=\"fad fa-clipboard-check fa-fw\"></i></button>",e+="                     </div>",e+="                 </form>",e+="    </div>",e+=" </div>",e+="</div>",d.append(e)}function RegisterDamage(a,b,c){""==b?(Global_Check.categories[a].damageitems[c].registered=!0,Global_Check.categories[a].damageitems[c].comments=document.getElementById("damage_comments").value,Global_Check.categories[a].damageitems[c].evidence_picture=document.getElementById("damage_evidence").value,Global_Check.damages++,Global_Check.categories[a].damages++):(Global_Check.categories[a].subcategories[b].damageitems[c].registered=!0,Global_Check.categories[a].subcategories[b].damageitems[c].comments=document.getElementById("damage_comments").value,Global_Check.categories[a].subcategories[b].damageitems[c].evidence_picture=document.getElementById("damage_evidence").value,Global_Check.damages++,Global_Check.categories[a].damages++,Global_Check.categories[a].subcategories[b].damages++),closepdcDet2(),StartPDC()}function UnMarkDamage(a,b,c){""==b?(Global_Check.categories[a].damageitems[c].registered=!1,Global_Check.categories[a].damageitems[c].comments="",Global_Check.categories[a].damageitems[c].evidence_picture="",Global_Check.damages--,Global_Check.categories[a].damages--):(Global_Check.categories[a].subcategories[b].damageitems[c].registered=!1,Global_Check.categories[a].subcategories[b].damageitems[c].comments="",Global_Check.categories[a].subcategories[b].damageitems[c].evidence_picture="",Global_Check.damages--,Global_Check.categories[a].damages--,Global_Check.categories[a].subcategories[b].damages--),closepdcDet2(),StartPDC()}function ShowCatDamage(a){if(Global_Check.categories[a].subcategories==null){var b=$("#pdc_details2");b.html("");var c="",d=0;c+="<div class=\"card h-100\">",c+=" <div class=\"card-header\">",c+="     <div class=\"d-flex\">",c+="         <div><a onclick=\"closepdcDet2();\"><i class=\"fas fa-arrow-left fa-fw\"></i></a></div>",c+="         <div class=\"m-auto\">"+Global_Check.categories[a].cat_name+"</div><span class=\"small\" id=\"pdc_cc\"><span>",c+="     </div>",c+=" </div>",c+=" <div class=\"card-body pdc-pagina\">",$.each(Global_Check.categories[a].damageitems,function(b,e){c+="             <a class=\"card pdc-card alert-danger mb-3\" onclick=\"RegisterFormDamages(`"+a+"`,``,`"+d+"`)\">",c+="\t    \t    <div class=\"card-title d-flex p-2 px-3 mb-0\">",c+="\t     \t        <div class=\"danger\"><i class=\"fad fa-exclamation-triangle text-danger\"></i></div>",c+="                 <div class=\"text-grey px-2\">"+e.title+"</div>",c+=!1==e.registered?"                 <div class=\"ml-auto px-2\"><i class=\"fad fa-square text-grey\"></i></div>":"                 <div class=\"ml-auto px-2\"><i class=\"fad fa-check-square text-danger\"></i></div>",c+="             </div>",c+="             </a>",d++}),c+="             </div>",c+="         </div>",c+="     </div>",c+=" </div>",b.append(c),openpdcDet2()}else showSubCategories(a)}function ShowSubCatDamages(a,b){var c=$("#pdc_details2");c.html("");var d="",e=0;d+="<div class=\"card h-100\">",d+=" <div class=\"card-header \">",d+="     <div class=\"d-flex\">",d+="         <div><a  onclick=\"showSubCategories("+a+");\"><i class=\"fas fa-arrow-left fa-fw\"></i></a></div>",d+="         <div class=\"m-auto\">"+Global_Check.categories[a].cat_name+" / "+Global_Check.categories[a].subcategories[b].subcat_name+"</div><span class=\"small\" id=\"pdc_cc\"><span>",d+="     </div>",d+=" </div>",d+=" <div class=\"card-body pdc-pagina\">",$.each(Global_Check.categories[a].subcategories[b].damageitems,function(c,f){d+=!1==f.registered?"             <a class=\"card pdc-card alert-danger mb-3\" onclick=\"openpdcDet2();RegisterFormDamages(`"+a+"`,`"+b+"`,`"+e+"`);\">":"             <a class=\"card pdc-card alert-danger mb-3\" onclick=\"openpdcDet2();RegisterFormDamages(`"+a+"`,`"+b+"`,`"+e+"`);\">",d+="\t    \t    <div class=\"card-title d-flex p-2 px-3 mb-0\" >",d+="\t     \t        <div class=\"text-danger\"><i class=\"fad fa-exclamation-triangle text-danger\"></i></div>",d+="                 <div class=\"text-grey px-2\">"+f.title+"</div>",d+=!1==f.registered?"                 <div class=\"ml-auto px-2\"><i class=\"fal fa-square fa-fw text-danger\"></i></div>":"                 <div class=\"ml-auto px-2\"><i class=\"fad fa-check fa-fw text-danger\"></i></div>",d+="             </div>",d+="             </a>",e++}),d+="        </div>",d+="     </div>",d+=" </div>",c.append(d),openpdcDet2()}function loadPDCtemplate(a){$("#StartCheck").html("<span class=\"spinner-border spinner-border-sm\" role=\"status\" aria-hidden=\"true\"></span> loading").attr("enabled",!0),$.ajax({url:window.location.origin+"/scripts/GetPDCTemplate.php?id="+a,type:"GET",dataType:"json",success:function(a){Global_Check=a,$("#StartCheck").html("<i class=\"fad fa-list fa-fw\"></i><i class=\"fas fa-fw\"></i> Start Registration").attr("enabled",!0),$("#TempDescription").html("<div class=\"card-body StatusLine alert-success\">"+Global_Check.templateDescription+"</div>")}})}function openpdcDet(){function a(a){if(a.matches){var b=document.getElementById("pdc_details");b.classList.remove("hide"),document.getElementById("pdc_details2").className+=" hide",document.getElementById("pdc_main").className+=" hide"}else{var b=document.getElementById("pdc_main");b.classList.remove("hide");var c=document.getElementById("pdc_details");c.classList.remove("hide");var d=document.getElementById("pdc_details2");d.classList.remove("hide")}}const b=window.matchMedia("(max-width: 768px)");b.addListener(a),a(b)}function closepdcDet(){function a(a){if(a.matches){var b=document.getElementById("pdc_main");b.classList.remove("hide"),document.getElementById("pdc_details2").className+=" hide",document.getElementById("pdc_details").className+=" hide"}else{var b=document.getElementById("pdc_main");b.classList.remove("hide");var c=document.getElementById("pdc_details");c.classList.remove("hide");var d=document.getElementById("pdc_details2");d.classList.remove("hide")}}var b=$("#pdc_details");b.html("");const c=window.matchMedia("(max-width: 768px)");c.addListener(a),a(c)}function openpdcDet2(){function a(a){if(a.matches){var b=document.getElementById("pdc_details2");b.classList.remove("hide"),document.getElementById("pdc_details").className+=" hide",document.getElementById("pdc_main").className+=" hide"}else{var b=document.getElementById("pdc_main");b.classList.remove("hide");var c=document.getElementById("pdc_details");c.classList.remove("hide");var d=document.getElementById("pdc_details2");d.classList.remove("hide")}}const b=window.matchMedia("(max-width: 768px)");b.addListener(a),a(b)}function closepdcDet2(){function a(a){if(a.matches){var b=document.getElementById("pdc_details");b.classList.remove("hide"),document.getElementById("pdc_details2").className+=" hide",document.getElementById("pdc_main").className+=" hide"}else{var b=document.getElementById("pdc_main");b.classList.remove("hide");var c=document.getElementById("pdc_details");c.classList.remove("hide");var d=document.getElementById("pdc_details2");d.classList.remove("hide")}}var b=$("#pdc_details2");b.html("");const c=window.matchMedia("(max-width: 768px)");c.addListener(a),a(c)}function openpdcDet3(){}function closepdcDet3(){}function FinalisePDC(){var a=$("#pdc_details");a.html("");var b="";b+="<div class=\"card h-100\">",b+=" <div class=\"card-header\">",b+="     <div class=\"d-flex\">",b+="         <div><a  onclick=\"StartPDC()\"><i class=\"fas fa-arrow-left fa-fw\"></i></a></div>",b+="         <div class=\"m-auto\"> Save & Register</div>",b+="     </div>",b+=" </div>",b+=" <div class=\"card-body pdc-pagina \">",b+="     <div class=\"row\" >",b+="         <div class=\"col-12  mb-2\" >",b+="             <div class=\"card-title\">Details</div>",b+="             <div class=\"row\">",b+="                 <div class=\"col-6 \">Template name</div>  <div class=\"col-6\"><b>"+Global_Check.templateName+"</b></div>",b+="                 <div class=\"col-6\">Vehicle </div>      <div class=\"col-6\"><b>"+Global_Check.vehicle+"</b></div>",b+="                 <div class=\"col-6\">Odometer </div>     <div class=\"col-6\"><b>"+Global_Check.vehicle_odometer/1e3+"</b></div>",b+="                 <div class=\"col-6\">Trailer </div>      <div class=\"col-6\"><b>"+Global_Check.trailer+"</b></div>",b+="                 <div class=\"col-6\">Driver  </div>      <div class=\"col-6\"><b>"+Global_Check.driver+"</b></div>",b+="                 <div class=\"col-6\">Report Date </div>  <div class=\"col-6\"><b>"+new Date().format("yyyy/mm/dd HH:MM:ss")+"</b></div>",b+="                 <div class=\"col-6\">Damages </div>      <div class=\"col-6\"><b>"+Global_Check.damages+"</b></div>",b+="             </div>",b+="         </div>",b+="         <div class=\" col-12\" >",b+="             <div class=\"mb-3 \">",b+="                 <label>Additional notes</label>",b+=" \t\t\t    <textarea role=\"textbox\" rows=\"4\" class=\"form-control text-left shadow-sm\"  contenteditable  name=\"Add_Notes\" id=\"add_notes\" ></textarea>",b+="             </div>",b+="             <div class=\"mb-3\">",b+="                 <label>Signature</label>",b+=" \t\t\t    <input type=\"text\" class=\"form-control text-left shadow-sm\" value=\""+Global_Check.driver+"\" name=\"Add_Notes\" id=\"signature\" >",b+="             </div>",b+="        </div>",b+="         <div class=\"col-12\" >",b+="             <div class=\"px-3\">I hereby confirm that I have carried out the pre-departure check in accordance with the regulations.</div>",b+="         </div>",b+="     </div>",b+=" </div>",b+=" <div class=\"card-footer\">",b+="     <button class=\"col-12 btn btn-lg btn-primary\" id=\"SaveCheck\" onclick=\"RegisterCheckToSystem()\" >Save & Upload <i class=\"fad fa-clipboard-check\"></i></button>",b+=" </div>",a.append(b)}function RegisterCheckToSystem(){Global_Check.add_notes=document.getElementById("add_notes").value,Global_Check.signature=Global_Check.driver,$("#SaveCheck").html("<span class=\"spinner-border spinner-border-sm \" role=\"status\" aria-hidden=\"true\"></span> saving...").attr("enabled",!0),$.ajax({url:window.location.origin+"/scripts/POST_PDC_Check.php",type:"POST",data:JSON.stringify(Global_Check),contentType:"application/json; charset=utf-8",dataType:"json",success:function(a){"200"==a.code?($("#SaveCheck").html("<i class=\"fas fa-check-double rest\"></i> ...Saved").attr("enabled",!0),setTimeout(()=>{console.log("Waiting to show succes"),Global_Check={};var a=$("#pdc_details");a.html(""),window.location.replace("../index.php")},1500)):($(".display-error").html("<ul>"+a.msg+"</ul>"),$(".display-error").css("display","block"))}})}function jump(){window.scrollBy(0,131),window.scrollTo(0,top)}