function LoadMonitorData(a){$s=void 0===a?"":"?id="+a,$.ajax({type:"GET",dataType:"JSON",url:window.location.origin+"/scripts/GetAPIMonitorEndPoints.php"+$s,success:function(a){$.each(a,function(a,b){ReadPerformanceLog(b)})}})}function ReadPerformanceLog(a){var b=document.getElementById("SelectDate");!b||(b=new Date(document.getElementById("SelectDate").value).format("yyyy/mm/dd H:MM"));var c=document.getElementById("SelectHours");c=c?document.getElementById("SelectHours").value:4,null==b?(SDE=new Date,SD=new Date):(SDE=new Date(b),SD=new Date(b)),SD.setHours(SD.getHours()-c),SDE.setHours(SDE.getHours());var d=a.name_EndPoint;ShowPlaceholder("Stat_"+a.id,"stats"),ShowPlaceholder("Perf_"+a.id,"graph"),ShowPlaceholder("Avai_"+a.id,"graph"),$.ajax({type:"GET",dataType:"JSON",url:window.location.origin+"/scripts/GetPerformanceLog.php?StartDate="+SD.format("yyyy-mm-dd H:MM")+"&EndDate="+SDE.format("yyyy-mm-dd H:MM")+"&Endpoint="+d,success:function(b){UpdateCounter("","Stat_"+a.id),UpdateCounter("","Perf_"+a.id),UpdateCounter("","Avai_"+a.id),CountStats(b,"Stat_"+a.id,d,c),Endpoint_Monitor_Graph(b,"Perf_"+a.id,c)},error:function(){UpdateCounter("loading failed","Stat_"+a.id),UpdateCounter("loading failed","Perf_"+a.id),UpdateCounter("loading failed","Avai_"+a.id)}})}function ReadBackLog(a,b,c){if(null==c)var d=new Date,e=new Date;else var d=new Date(c),e=new Date(c);e.setHours(e.getHours()-a),ShowPlaceholder("BackLogStats"+b,""),ShowPlaceholder("BackLogGraph"+b,""),d.setHours(d.getHours()+2),$.ajax({type:"GET",dataType:"JSON",url:window.location.origin+"/scripts/GetBacklog.php?StartDate="+e.format("yyyy-mm-dd H:MM")+"&EndDate="+d.format("yyyy-mm-dd H:MM")+"&Endpoint="+b,success:function(c){BackLogData(c,b,a),ShowBackLogStats(c,b)},error:function(){UpdateCounter("","BackLogStats"+b),UpdateCounter("","BackLogGraph"+b)}})}function CountStats(a,b,c){var d=0,e=0,f=0,g=0,h=0;$AR_KPI=" gray",$A_KPI=" gray";for(var j=0,k=0,l=0;l<=a.length-1;l++)a[l].Endpoint==c&&(d++,200==a[l].Status||429==a[l].Status?(e++,h+=parseFloat(a[l].rt)):888==a[l].Status?(g++,h+=parseFloat(a[l].rt)):f++,k=100*(e/d),j=h/e);$AR_KPI=15<j?"text-danger":5<j&&15>=j?"text-warning":"text-success",$A_KPI=99>k?"text-danger":99<k&&99.7>=k?"text-warning":"text-success";var m=$("#"+b);m.html(""),m.append("<div class=\"row\"><div class=\"col-12 d-flex\"><div class=\"col-6 text-left\"><div class=\"dark\"><label>amount requests</label><h4><b>"+d.toFixed(0)+"</b></h4></div></div><div class=\"col-6 text-right\"><div class=\"dark\"><label>errors / No Data</label><h4><b>"+f.toFixed(0)+" / "+g.toFixed(0)+"</b></h4></div></div></div></div><div class=\"row\"><div class=\"col-12 d-flex\"><div class=\"col-6 text-left\"><div class=\""+$A_KPI+"\"><label>availability</label><h4><b>"+k.toFixed(2)+" % </b></H4></div></div><div class=\"col-6 text-right\"><div class=\""+$AR_KPI+"\"><label>av. response</label><h4><b>"+j.toFixed(2)+" s </b></h4></div></div></div></div>")}function ShowBackLogStats(a,b){var c=$("#BackLogStats"+b);c.html("");for(var d=0,e="",f="",g=0;g<=a.length-1;g++){d++,$backlog=(new Date(a[g].requestDateTime)-new Date(a[g].receivedDateTime))/1e3/60,$databacklog=(new Date(a[g].receivedDateTime)-new Date(a[g].messageDateTime))/1e3/60;var h=$backlog/a.length*a.length,j=$databacklog/a.length*a.length}e=6<h?"red-kpi":5.5<h&&6>=h?"orange-kpi":"green-kpi",6<j?f="red-kpi":5.5<j&&6>=j?e="orange-kpi":f="green-kpi";var k=new Date(a[0].requestDateTime),l=new Date(a[0].messageDateTime),m=new Date(a[0].receivedDateTime),n=(k.getTime()-m.getTime())/1e3/3600,o=(new Date(a[10].requestDateTime).getTime()-new Date(a[10].receivedDateTime).getTime())/1e3/3600;$APIProgress=o<n?"<i class=\"fas fa-arrow-up text-danger\"></i>":"<i class=\"fas fa-arrow-down text-success\"></i>",$A_KPI=.1<n?"text-danger":.03>=n&&.08<n?"text-warning":"text-success";var p=(m.getTime()-l.getTime())/1e3/3600,q=(new Date(a[10].receivedDateTime).getTime()-new Date(a[10].messageDateTime).getTime())/1e3/3600;$DataProgress=q<p?"<i class=\"fas fa-arrow-up text-danger\"></i>":"<i class=\"fas fa-arrow-down text-success\"></i>",$D_KPI=.1<p?"text-danger":.03>=p&&.08<p?"text-warning":"text-success",c.append("<div class=\"row\"><div class=\"col-12 d-flex \"><div class=\"col-6 text-left\"><div class=\""+$A_KPI+"\"><label>API Average </label><h4><b>"+a[0].backlog+"  "+$APIProgress+"</b><br></div></div><div class=\"col-6 text-right\"><div class=\""+e+"\"><label>API Backlog</label><h4><b>"+h.toFixed(2)+" s</b></h4></div></div></div><div class=\"col-12 d-flex \"><div class=\"col-6 text-left\"><div class=\""+$D_KPI+"\"><label>M2M Average</label><h4><b>"+a[0].databacklog+"  "+$DataProgress+"</b></h4></div></div><div class=\"col-6 text-right\"><label>M2M Backlog </label><div class=\""+f+"\"><h4><b>"+j.toFixed(2)+" s</b></h4></div></div></div></div>"),$str="<div class=\"d-flex col-12 align-items-end text-left small \">",$str+="<div class=\"\"><B>API </B>: difference in timestamp API-request and received datetime of leatest object</div>",$str+="<div class=\"\"><b>M2M </b>: difference in timestamp created and received datetime of leatest object</div>",$str+="</div>",UpdateCounter($str,"BackLogExplain")}function Endpoint_Monitor_Graph(a,b){var c=[],d=[];$.each(a,function(a,b){200==b.Status||429==b.Status||888==b.Status?c.push({x:Date.parse(b.DateTime),y:parseInt(100.1)}):c.push({x:Date.parse(b.DateTime),y:parseInt(0)}),200==b.Status&&d.push({x:Date.parse(b.DateTime),y:parseFloat(b.rt)}),888==b.Status&&d.push({x:Date.parse(b.DateTime),y:parseFloat(.5)}),(0==b.Status||500==b.Status)&&d.push({x:Date.parse(b.DateTime),y:parseFloat(-.1)})}),Highcharts.chart(b,{chart:{zoomType:"x",styledMode:!0,marginTop:10,marginBottom:30,marginLeft:10,marginRight:10},xAxis:{type:"datetime",visible:!0},yAxis:[{title:"",visible:!1,tickInterval:1,min:0,max:100,labels:{enabled:!1}},{title:"",tickInterval:1,min:0,visible:!1}],legend:{enabled:!1},credits:{enabled:!1},title:{text:""},tooltip:{crosshairs:!0,useHTML:!0,shared:!0,headerFormat:"<span style=\"color:{series.colorIndex}\"><small>{point.x:%Y-%m-%d %H:%M:%S}</small></span>",pointFormat:"<br><span style=\"color:var(--primary)\">{series.name} : <b>{point.y}</b></span>"},plotOptions:{series:{turboThreshold:1e3,animation:!0,dataLabels:{enabled:!1,rotation:0,x:10,y:-20,allowOverlap:!0}},line:{marker:{enabled:!0,symbol:"circle",radius:2,states:{hover:{enabled:!0}}}},area:{fillOpacity:.5}},series:[{data:c,type:"area",name:"availability",yAxis:0,colorIndex:"2",step:!0},{data:d,type:"line",name:"seconds",yAxis:1,colorIndex:"0"}]})}function BackLogData(a,b){var c=[],d=[];c.push([new Date(a[0].requestDateTime),0]);for(var e=0;e<a.length;++e)c.push([new Date(a[e].requestDateTime),round(new Date("1970-01-01T"+a[e].databacklog+"Z").getTime()/1e3/60,2)]),d.push([new Date(a[e].requestDateTime),round(new Date("1970-01-01T"+a[e].backlog+"Z").getTime()/1e3/60,2)]);Highcharts.setOptions({time:{timezone:"Europe/Amsterdam"}}),Highcharts.chart("BackLogGraph"+b,{chart:{type:"line",zoomType:"x",styledMode:!0},title:{text:""},xAxis:{type:"datetime",dateTimeLabelFormats:{hour:"%H:00",minute:"%H:%M"},title:{text:""},tickInterval:3600,labels:{autoRotation:[-30,-40]}},yAxis:{labels:{enabled:!0},title:"",tickInterval:1,min:0,max:40},tooltip:{headerFormat:"<span style=\"color:{series.colorIndex}\">{point.x:%Y-%m-%d %H:%M:%S}</span>",pointFormat:"<span style=\"color:{series.colorIndex}\">{series.name} </span> </br> <b> {point.y}</b><small> minutes</small>{series.label}",crosshairs:!0,useHTML:!0,shared:!0},plotOptions:{line:{marker:{enabled:!1}},series:{turboThreshold:1,animation:!0}},credits:{enabled:!1},legend:{enabled:!1},series:[{name:"API-BackLog ",data:d,colorIndex:"0"},{name:"M2M-BackLog ",data:c,colorIndex:"1"}]})}function ShowMonitor(a){$s=void 0===a?"":"?id="+a,$.ajax({type:"GET",dataType:"JSON",url:window.location.origin+"/scripts/GetAPICollectors.php"+$s,success:function(b){BuildMonitor(b,"MonitorBuilder"),LoadMonitorData(a)},error:function(){}})}$(function(){$("#datetimepicker1").datetimepicker({format:"YYYY/MM/DD",icons:{time:"far fa-clock",date:"far fa-calendar-alt",up:"fas fa-chevron-up",down:"fas fa-chevron-down",previous:"fas fa-chevron-left",next:"fas fa-chevron-right",today:"fas fa-calendar-day",clear:"glyphicon glyphicon-trash"}})});function BuildMonitor(a,b){var c=$("#"+b);c.html("");var d="active";if(1<a.length){var e="<div class=\"tab-content card border border-top-0 rounded-0 p-3\">",f="<ul class = \"nav nav-tabs\">";$.each(a,function(a,b){"1"==b.active&&(f+="<li class=\"nav-item\"> <a class=\"nav-link "+d+"\" href=\"#TAB"+b.id+"\" data-toggle=\"tab\">"+b.name+"</a></li>",e+="\t<div class=\"tab-pane show "+d+"\" id=\"TAB"+b.id+"\" role=\"tabpanel\">",e+="\t\t<div class=\"row \" id=\"_tabdata"+b.id+"\">",e+="\t\t</div>",e+="\t</div>",d="")}),e+="</div>",f+="</ul>",c.append(f),c.append(e)}else{var e="<div class=\"p-2 \">";e+="\t\t<div class=\"row \" id=\"_tabdata"+a[0].id+"\">",e+="\t\t</div>",c.append(e)}$.each(a,function(a,b){"1"==b.active&&$.ajax({type:"GET",dataType:"JSON",url:window.location.origin+"/scripts/GetAPIScheduler.php?id="+b.id,success:function(a){var c=$("#_tabdata"+b.id);c.html("");var d="";$.each(a,function(a,b){"1"==b.active&&(d+="\t\t\t<div class=\"col-12 col-xl my-3 apigraph\">",d+="\t\t\t\t<div class=\"card shadow\">",d+="\t\t\t\t\t<div class=\"card-header\">"+b.name_EndPoint+"</div>",d+="\t\t\t\t\t<div class=\"card-body p-0 px-1\">",d+="\t\t\t\t\t\t<div id=\"Stat_"+b.id+"\" class=\"rFMSStats col-12 \">"+b.id+"</div>",d+="\t\t\t\t\t\t<div id=\"Perf_"+b.id+"\" class=\"rFMSGraph col-12 \">"+b.id+"</div>",d+="\t\t\t\t\t</div>",d+="\t\t\t\t</div>",d+="\t\t\t</div>")}),c.append(d)},error:function(){}})})}